<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN"
    "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">
<head>
<meta http-equiv="Content-Type" content="application/xhtml+xml; charset=UTF-8" />
<meta name="generator" content="AsciiDoc 8.6.9" />
<title>Funktionen Schreiben in <strong>R</strong></title>
<style type="text/css">
/* Shared CSS for AsciiDoc xhtml11 and html5 backends */

/* Default font. */
body {
  font-family: Georgia,serif;
}

/* Title font. */
h1, h2, h3, h4, h5, h6,
div.title, caption.title,
thead, p.table.header,
#toctitle,
#author, #revnumber, #revdate, #revremark,
#footer {
  font-family: Arial,Helvetica,sans-serif;
}

body {
  margin: 1em 5% 1em 5%;
}

a {
  color: blue;
  text-decoration: underline;
}
a:visited {
  color: fuchsia;
}

em {
  font-style: italic;
  color: navy;
}

strong {
  font-weight: bold;
  color: #083194;
}

h1, h2, h3, h4, h5, h6 {
  color: #527bbd;
  margin-top: 1.2em;
  margin-bottom: 0.5em;
  line-height: 1.3;
}

h1, h2, h3 {
  border-bottom: 2px solid silver;
}
h2 {
  padding-top: 0.5em;
}
h3 {
  float: left;
}
h3 + * {
  clear: left;
}
h5 {
  font-size: 1.0em;
}

div.sectionbody {
  margin-left: 0;
}

hr {
  border: 1px solid silver;
}

p {
  margin-top: 0.5em;
  margin-bottom: 0.5em;
}

ul, ol, li > p {
  margin-top: 0;
}
ul > li     { color: #aaa; }
ul > li > * { color: black; }

.monospaced, code, pre {
  font-family: "Courier New", Courier, monospace;
  font-size: inherit;
  color: navy;
  padding: 0;
  margin: 0;
}
pre {
  white-space: pre-wrap;
}

#author {
  color: #527bbd;
  font-weight: bold;
  font-size: 1.1em;
}
#email {
}
#revnumber, #revdate, #revremark {
}

#footer {
  font-size: small;
  border-top: 2px solid silver;
  padding-top: 0.5em;
  margin-top: 4.0em;
}
#footer-text {
  float: left;
  padding-bottom: 0.5em;
}
#footer-badges {
  float: right;
  padding-bottom: 0.5em;
}

#preamble {
  margin-top: 1.5em;
  margin-bottom: 1.5em;
}
div.imageblock, div.exampleblock, div.verseblock,
div.quoteblock, div.literalblock, div.listingblock, div.sidebarblock,
div.admonitionblock {
  margin-top: 1.0em;
  margin-bottom: 1.5em;
}
div.admonitionblock {
  margin-top: 2.0em;
  margin-bottom: 2.0em;
  margin-right: 10%;
  color: #606060;
}

div.content { /* Block element content. */
  padding: 0;
}

/* Block element titles. */
div.title, caption.title {
  color: #527bbd;
  font-weight: bold;
  text-align: left;
  margin-top: 1.0em;
  margin-bottom: 0.5em;
}
div.title + * {
  margin-top: 0;
}

td div.title:first-child {
  margin-top: 0.0em;
}
div.content div.title:first-child {
  margin-top: 0.0em;
}
div.content + div.title {
  margin-top: 0.0em;
}

div.sidebarblock > div.content {
  background: #ffffee;
  border: 1px solid #dddddd;
  border-left: 4px solid #f0f0f0;
  padding: 0.5em;
}

div.listingblock > div.content {
  border: 1px solid #dddddd;
  border-left: 5px solid #f0f0f0;
  background: #f8f8f8;
  padding: 0.5em;
}

div.quoteblock, div.verseblock {
  padding-left: 1.0em;
  margin-left: 1.0em;
  margin-right: 10%;
  border-left: 5px solid #f0f0f0;
  color: #888;
}

div.quoteblock > div.attribution {
  padding-top: 0.5em;
  text-align: right;
}

div.verseblock > pre.content {
  font-family: inherit;
  font-size: inherit;
}
div.verseblock > div.attribution {
  padding-top: 0.75em;
  text-align: left;
}
/* DEPRECATED: Pre version 8.2.7 verse style literal block. */
div.verseblock + div.attribution {
  text-align: left;
}

div.admonitionblock .icon {
  vertical-align: top;
  font-size: 1.1em;
  font-weight: bold;
  text-decoration: underline;
  color: #527bbd;
  padding-right: 0.5em;
}
div.admonitionblock td.content {
  padding-left: 0.5em;
  border-left: 3px solid #dddddd;
}

div.exampleblock > div.content {
  border-left: 3px solid #dddddd;
  padding-left: 0.5em;
}

div.imageblock div.content { padding-left: 0; }
span.image img { border-style: none; vertical-align: text-bottom; }
a.image:visited { color: white; }

dl {
  margin-top: 0.8em;
  margin-bottom: 0.8em;
}
dt {
  margin-top: 0.5em;
  margin-bottom: 0;
  font-style: normal;
  color: navy;
}
dd > *:first-child {
  margin-top: 0.1em;
}

ul, ol {
    list-style-position: outside;
}
ol.arabic {
  list-style-type: decimal;
}
ol.loweralpha {
  list-style-type: lower-alpha;
}
ol.upperalpha {
  list-style-type: upper-alpha;
}
ol.lowerroman {
  list-style-type: lower-roman;
}
ol.upperroman {
  list-style-type: upper-roman;
}

div.compact ul, div.compact ol,
div.compact p, div.compact p,
div.compact div, div.compact div {
  margin-top: 0.1em;
  margin-bottom: 0.1em;
}

tfoot {
  font-weight: bold;
}
td > div.verse {
  white-space: pre;
}

div.hdlist {
  margin-top: 0.8em;
  margin-bottom: 0.8em;
}
div.hdlist tr {
  padding-bottom: 15px;
}
dt.hdlist1.strong, td.hdlist1.strong {
  font-weight: bold;
}
td.hdlist1 {
  vertical-align: top;
  font-style: normal;
  padding-right: 0.8em;
  color: navy;
}
td.hdlist2 {
  vertical-align: top;
}
div.hdlist.compact tr {
  margin: 0;
  padding-bottom: 0;
}

.comment {
  background: yellow;
}

.footnote, .footnoteref {
  font-size: 0.8em;
}

span.footnote, span.footnoteref {
  vertical-align: super;
}

#footnotes {
  margin: 20px 0 20px 0;
  padding: 7px 0 0 0;
}

#footnotes div.footnote {
  margin: 0 0 5px 0;
}

#footnotes hr {
  border: none;
  border-top: 1px solid silver;
  height: 1px;
  text-align: left;
  margin-left: 0;
  width: 20%;
  min-width: 100px;
}

div.colist td {
  padding-right: 0.5em;
  padding-bottom: 0.3em;
  vertical-align: top;
}
div.colist td img {
  margin-top: 0.3em;
}

@media print {
  #footer-badges { display: none; }
}

#toc {
  margin-bottom: 2.5em;
}

#toctitle {
  color: #527bbd;
  font-size: 1.1em;
  font-weight: bold;
  margin-top: 1.0em;
  margin-bottom: 0.1em;
}

div.toclevel0, div.toclevel1, div.toclevel2, div.toclevel3, div.toclevel4 {
  margin-top: 0;
  margin-bottom: 0;
}
div.toclevel2 {
  margin-left: 2em;
  font-size: 0.9em;
}
div.toclevel3 {
  margin-left: 4em;
  font-size: 0.9em;
}
div.toclevel4 {
  margin-left: 6em;
  font-size: 0.9em;
}

span.aqua { color: aqua; }
span.black { color: black; }
span.blue { color: blue; }
span.fuchsia { color: fuchsia; }
span.gray { color: gray; }
span.green { color: green; }
span.lime { color: lime; }
span.maroon { color: maroon; }
span.navy { color: navy; }
span.olive { color: olive; }
span.purple { color: purple; }
span.red { color: red; }
span.silver { color: silver; }
span.teal { color: teal; }
span.white { color: white; }
span.yellow { color: yellow; }

span.aqua-background { background: aqua; }
span.black-background { background: black; }
span.blue-background { background: blue; }
span.fuchsia-background { background: fuchsia; }
span.gray-background { background: gray; }
span.green-background { background: green; }
span.lime-background { background: lime; }
span.maroon-background { background: maroon; }
span.navy-background { background: navy; }
span.olive-background { background: olive; }
span.purple-background { background: purple; }
span.red-background { background: red; }
span.silver-background { background: silver; }
span.teal-background { background: teal; }
span.white-background { background: white; }
span.yellow-background { background: yellow; }

span.big { font-size: 2em; }
span.small { font-size: 0.6em; }

span.underline { text-decoration: underline; }
span.overline { text-decoration: overline; }
span.line-through { text-decoration: line-through; }

div.unbreakable { page-break-inside: avoid; }


/*
 * xhtml11 specific
 *
 * */

div.tableblock {
  margin-top: 1.0em;
  margin-bottom: 1.5em;
}
div.tableblock > table {
  border: 3px solid #527bbd;
}
thead, p.table.header {
  font-weight: bold;
  color: #527bbd;
}
p.table {
  margin-top: 0;
}
/* Because the table frame attribute is overriden by CSS in most browsers. */
div.tableblock > table[frame="void"] {
  border-style: none;
}
div.tableblock > table[frame="hsides"] {
  border-left-style: none;
  border-right-style: none;
}
div.tableblock > table[frame="vsides"] {
  border-top-style: none;
  border-bottom-style: none;
}


/*
 * html5 specific
 *
 * */

table.tableblock {
  margin-top: 1.0em;
  margin-bottom: 1.5em;
}
thead, p.tableblock.header {
  font-weight: bold;
  color: #527bbd;
}
p.tableblock {
  margin-top: 0;
}
table.tableblock {
  border-width: 3px;
  border-spacing: 0px;
  border-style: solid;
  border-color: #527bbd;
  border-collapse: collapse;
}
th.tableblock, td.tableblock {
  border-width: 1px;
  padding: 4px;
  border-style: solid;
  border-color: #527bbd;
}

table.tableblock.frame-topbot {
  border-left-style: hidden;
  border-right-style: hidden;
}
table.tableblock.frame-sides {
  border-top-style: hidden;
  border-bottom-style: hidden;
}
table.tableblock.frame-none {
  border-style: hidden;
}

th.tableblock.halign-left, td.tableblock.halign-left {
  text-align: left;
}
th.tableblock.halign-center, td.tableblock.halign-center {
  text-align: center;
}
th.tableblock.halign-right, td.tableblock.halign-right {
  text-align: right;
}

th.tableblock.valign-top, td.tableblock.valign-top {
  vertical-align: top;
}
th.tableblock.valign-middle, td.tableblock.valign-middle {
  vertical-align: middle;
}
th.tableblock.valign-bottom, td.tableblock.valign-bottom {
  vertical-align: bottom;
}


/*
 * manpage specific
 *
 * */

body.manpage h1 {
  padding-top: 0.5em;
  padding-bottom: 0.5em;
  border-top: 2px solid silver;
  border-bottom: 2px solid silver;
}
body.manpage h2 {
  border-style: none;
}
body.manpage div.sectionbody {
  margin-left: 3em;
}

@media print {
  body.manpage div#toc { display: none; }
}


@media screen {
  body {
    max-width: 50em; /* approximately 80 characters wide */
    margin-left: 16em;
  }

  #toc {
    position: fixed;
    top: 0;
    left: 0;
    bottom: 0;
    width: 13em;
    padding: 0.5em;
    padding-bottom: 1.5em;
    margin: 0;
    overflow: auto;
    border-right: 3px solid #f8f8f8;
    background-color: white;
  }

  #toc .toclevel1 {
    margin-top: 0.5em;
  }

  #toc .toclevel2 {
    margin-top: 0.25em;
    display: list-item;
    color: #aaaaaa;
  }

  #toctitle {
    margin-top: 0.5em;
  }
}
</style>
<script type="text/javascript">
/*<![CDATA[*/
var asciidoc = {  // Namespace.

/////////////////////////////////////////////////////////////////////
// Table Of Contents generator
/////////////////////////////////////////////////////////////////////

/* Author: Mihai Bazon, September 2002
 * http://students.infoiasi.ro/~mishoo
 *
 * Table Of Content generator
 * Version: 0.4
 *
 * Feel free to use this script under the terms of the GNU General Public
 * License, as long as you do not remove or alter this notice.
 */

 /* modified by Troy D. Hanson, September 2006. License: GPL */
 /* modified by Stuart Rackham, 2006, 2009. License: GPL */

// toclevels = 1..4.
toc: function (toclevels) {

  function getText(el) {
    var text = "";
    for (var i = el.firstChild; i != null; i = i.nextSibling) {
      if (i.nodeType == 3 /* Node.TEXT_NODE */) // IE doesn't speak constants.
        text += i.data;
      else if (i.firstChild != null)
        text += getText(i);
    }
    return text;
  }

  function TocEntry(el, text, toclevel) {
    this.element = el;
    this.text = text;
    this.toclevel = toclevel;
  }

  function tocEntries(el, toclevels) {
    var result = new Array;
    var re = new RegExp('[hH]([1-'+(toclevels+1)+'])');
    // Function that scans the DOM tree for header elements (the DOM2
    // nodeIterator API would be a better technique but not supported by all
    // browsers).
    var iterate = function (el) {
      for (var i = el.firstChild; i != null; i = i.nextSibling) {
        if (i.nodeType == 1 /* Node.ELEMENT_NODE */) {
          var mo = re.exec(i.tagName);
          if (mo && (i.getAttribute("class") || i.getAttribute("className")) != "float") {
            result[result.length] = new TocEntry(i, getText(i), mo[1]-1);
          }
          iterate(i);
        }
      }
    }
    iterate(el);
    return result;
  }

  var toc = document.getElementById("toc");
  if (!toc) {
    return;
  }

  // Delete existing TOC entries in case we're reloading the TOC.
  var tocEntriesToRemove = [];
  var i;
  for (i = 0; i < toc.childNodes.length; i++) {
    var entry = toc.childNodes[i];
    if (entry.nodeName.toLowerCase() == 'div'
     && entry.getAttribute("class")
     && entry.getAttribute("class").match(/^toclevel/))
      tocEntriesToRemove.push(entry);
  }
  for (i = 0; i < tocEntriesToRemove.length; i++) {
    toc.removeChild(tocEntriesToRemove[i]);
  }

  // Rebuild TOC entries.
  var entries = tocEntries(document.getElementById("content"), toclevels);
  for (var i = 0; i < entries.length; ++i) {
    var entry = entries[i];
    if (entry.element.id == "")
      entry.element.id = "_toc_" + i;
    var a = document.createElement("a");
    a.href = "#" + entry.element.id;
    a.appendChild(document.createTextNode(entry.text));
    var div = document.createElement("div");
    div.appendChild(a);
    div.className = "toclevel" + entry.toclevel;
    toc.appendChild(div);
  }
  if (entries.length == 0)
    toc.parentNode.removeChild(toc);
},


/////////////////////////////////////////////////////////////////////
// Footnotes generator
/////////////////////////////////////////////////////////////////////

/* Based on footnote generation code from:
 * http://www.brandspankingnew.net/archive/2005/07/format_footnote.html
 */

footnotes: function () {
  // Delete existing footnote entries in case we're reloading the footnodes.
  var i;
  var noteholder = document.getElementById("footnotes");
  if (!noteholder) {
    return;
  }
  var entriesToRemove = [];
  for (i = 0; i < noteholder.childNodes.length; i++) {
    var entry = noteholder.childNodes[i];
    if (entry.nodeName.toLowerCase() == 'div' && entry.getAttribute("class") == "footnote")
      entriesToRemove.push(entry);
  }
  for (i = 0; i < entriesToRemove.length; i++) {
    noteholder.removeChild(entriesToRemove[i]);
  }

  // Rebuild footnote entries.
  var cont = document.getElementById("content");
  var spans = cont.getElementsByTagName("span");
  var refs = {};
  var n = 0;
  for (i=0; i<spans.length; i++) {
    if (spans[i].className == "footnote") {
      n++;
      var note = spans[i].getAttribute("data-note");
      if (!note) {
        // Use [\s\S] in place of . so multi-line matches work.
        // Because JavaScript has no s (dotall) regex flag.
        note = spans[i].innerHTML.match(/\s*\[([\s\S]*)]\s*/)[1];
        spans[i].innerHTML =
          "[<a id='_footnoteref_" + n + "' href='#_footnote_" + n +
          "' title='View footnote' class='footnote'>" + n + "</a>]";
        spans[i].setAttribute("data-note", note);
      }
      noteholder.innerHTML +=
        "<div class='footnote' id='_footnote_" + n + "'>" +
        "<a href='#_footnoteref_" + n + "' title='Return to text'>" +
        n + "</a>. " + note + "</div>";
      var id =spans[i].getAttribute("id");
      if (id != null) refs["#"+id] = n;
    }
  }
  if (n == 0)
    noteholder.parentNode.removeChild(noteholder);
  else {
    // Process footnoterefs.
    for (i=0; i<spans.length; i++) {
      if (spans[i].className == "footnoteref") {
        var href = spans[i].getElementsByTagName("a")[0].getAttribute("href");
        href = href.match(/#.*/)[0];  // Because IE return full URL.
        n = refs[href];
        spans[i].innerHTML =
          "[<a href='#_footnote_" + n +
          "' title='View footnote' class='footnote'>" + n + "</a>]";
      }
    }
  }
},

install: function(toclevels) {
  var timerId;

  function reinstall() {
    asciidoc.footnotes();
    if (toclevels) {
      asciidoc.toc(toclevels);
    }
  }

  function reinstallAndRemoveTimer() {
    clearInterval(timerId);
    reinstall();
  }

  timerId = setInterval(reinstall, 500);
  if (document.addEventListener)
    document.addEventListener("DOMContentLoaded", reinstallAndRemoveTimer, false);
  else
    window.onload = reinstallAndRemoveTimer;
}

}
asciidoc.install(5);
/*]]>*/
</script>
</head>
<body class="article">
<div id="header">
<h1>Funktionen Schreiben in <strong>R</strong></h1>
<span id="author">Dominik Cullmann</span><br />
<div id="toc">
  <div id="toctitle">Table of Contents</div>
  <noscript><p><b>JavaScript must be enabled in your browser to display the table of contents.</b></p></noscript>
</div>
</div>
<div id="content">
<div class="sect1">
<h2 id="_worum_geht_es">1. Worum geht es?</h2>
<div class="sectionbody">
<div class="paragraph"><p>Naja, ums Schreiben von Funktionen in der Programmiersprache <strong>R</strong>.</p></div>
<div class="sect2">
<h3 id="_was_sind_funktionen">1.1. Was sind Funktionen?</h3>
<div class="ulist"><ul>
<li>
<p>
Funktionen sind Programmkonstrukte, mit denen Du Teile des von Dir
  geschriebenen Codes wiederverwenden kannst
  (siehe <a href="https://de.wikipedia.org/wiki/Funktion_(Programmierung)">Wikipedia</a>).
</p>
</li>
<li>
<p>
Funktionen sind in den Standardbiliotheken jeder Programmiersprache vorhanden,
  viele R-Funktionen kennst Du wahrscheinlich schon: <code>sum()</code>, <code>mean()</code>
  oder <code>summary()</code>.
</p>
</li>
</ul></div>
</div>
<div class="sect2">
<h3 id="_warum_funktionen">1.2. Warum Funktionen?</h3>
<div class="ulist"><ul>
<li>
<p>
Damit Du Teile des von Dir geschriebenen Codes wiederverwenden kannst.
</p>
</li>
<li>
<p>
Damit Du, wenn Du Fehler im Code entdeckst, diese auch nur an einer
  Stelle korrigieren musst.
</p>
</li>
</ul></div>
</div>
<div class="sect2">
<h3 id="_wann_funktionen">1.3. Wann Funktionen?</h3>
<div class="paragraph"><p>Immer wenn Du merkst, dass Du (alten) Code mehrfach kopierst und an anderer
Stelle einfügst ohne ihn stark zu verändern, solltest Du darüber nachdenken,
eine (oder mehrere) Funktion(en)  aus ihm  zu machen.</p></div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_eine_funktion_schreiben">2. Eine Funktion schreiben</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_eine_neue_summenfunktion">2.1. Eine neue Summenfunktion</h3>
<div class="paragraph"><div class="title">Warum wir diese Funktion nicht schreiben sollten</div><p>Eine Summenfunktion gibt es wahrscheinlich in jeder Programmiersprache, in <strong>R</strong>
heißt sie <code>sum()</code>. Diese Funktion ist besser, stabiler und schneller, als
alles, das wir selbst programmieren können.</p></div>
<div class="paragraph"><div class="title">Warum wir es trotzdem tun</div><p>Nunja, irgendwelchen Code müssen wir ja nehmen.
Ich habe die Summenberechnung ausführlich als Beispiel zur Schleifenprogrammierung in
<a href="https://fvafrcu.github.io/programmieren_in_r/#gute-schleifen">Programmieren in R</a> benutzt,
    und eine Wiederholung schadet sicher nicht.</p></div>
</div>
<div class="sect2">
<h3 id="_vom_code_8230">2.2. Vom Code &#8230;</h3>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.8
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt>a  &lt;- c(2, 3, 4, 10) <span style="font-style: italic"><span style="color: #9A1900"># <b>&lt;1&gt;</b></span></span>
value &lt;- 0 <span style="font-style: italic"><span style="color: #9A1900"># <b>&lt;2&gt;</b></span></span>
<span style="font-weight: bold"><span style="color: #0000FF">for</span></span> (a_i in a) { <span style="font-style: italic"><span style="color: #9A1900"># <b>&lt;3&gt;</b></span></span>
    value &lt;- value + a_i  <span style="font-style: italic"><span style="color: #9A1900"># <b>&lt;4&gt;</b></span></span>
}
print(value) <span style="font-style: italic"><span style="color: #9A1900"># <b>&lt;5&gt;</b></span></span></tt></pre></div></div>
<div class="listingblock">
<div class="content">
<pre><code>## [1] 19</code></pre>
</div></div>
<div class="paragraph"><p>Dabei siehst Du:</p></div>
<div class="colist arabic"><ol>
<li>
<p>
Definition des zu summierenden Vektors
</p>
</li>
<li>
<p>
Definition des zur Addition neutralen Elementes
</p>
</li>
<li>
<p>
Schleife über die Elemente des Vektors
</p>
</li>
<li>
<p>
Addition des aktuellen Vektorelementes zum Ergebnis
</p>
</li>
<li>
<p>
Ausgabe des Ergebnisses
</p>
</li>
</ol></div>
</div>
<div class="sect2">
<h3 id="_8230_zur_funktion">2.3. &#8230; zur Funktion</h3>
<div class="paragraph"><p>Für unsere Summenfunktion soll die Definition des zu summierenden Vektors
der Anwenderin überlassen werden, daher wird der Vektor zu einem Argument
der Funktion. Ich wähle als Namen für das Argument jetzt <code>x</code>, das könnte aber
auch <code>a</code> bleiben, es ist eine Frage der Konvention, und unter <code>x</code> verstehen wir
meist eine Unbekannte. Und als Ausgabe verwenden wir keine Druck- sondern eine
Rückgabefunktion (<code>return()</code> statt <code>print()</code>).
Das Ergebnis sieht dann so aus:</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.8
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt>my_sum &lt;- function(x) {
    value &lt;- 0
    <span style="font-weight: bold"><span style="color: #0000FF">for</span></span> (x_i in x) {
        value &lt;- value + x_i
    }
    return(value)
}</tt></pre></div></div>
</div>
<div class="sect2">
<h3 id="_scoping">2.4. Scoping</h3>
<div class="paragraph"><p>Programmiersprachen kennen für Objekte unterschiedliche Gültigkeitsbereiche
(englisch "scope"), wir sehen uns das am Beispiel an:
==== Schreibzugriffe
.Ausgangszustand
Im Augenblick hat das Objekte <code>value</code> den Wert 19:</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.8
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt>print(value)</tt></pre></div></div>
<div class="listingblock">
<div class="content">
<pre><code>## [1] 19</code></pre>
</div></div>
<div class="paragraph"><div class="title">Funktionsausführung</div><p>Jetzt wenden wir unsere Summenfunktion an und berechnen die Summe eines anderen Vektors:</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.8
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt>print(my_sum(1:3))</tt></pre></div></div>
<div class="listingblock">
<div class="content">
<pre><code>## [1] 6</code></pre>
</div></div>
<div class="paragraph"><p>Das Objekt <code>value</code> behält seinen Wert:</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.8
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt>print(value)</tt></pre></div></div>
<div class="listingblock">
<div class="content">
<pre><code>## [1] 19</code></pre>
</div></div>
<div class="paragraph"><p>Und das, obwohl wir innerhalb der Funktion dem Objekt <code>value</code> in der ersten
Zeile den Wert 0 zuweisen und diesen dann in der Schleife mit den Werten 1, 3
und 6 überschreiben:
<strong>R</strong> verwaltet automatisch die Gültigkeitsbereiche aller Objekte.
Es gibt daher ein Objekt names  <code>value</code> außerhalb der Funktion, das den Wert 19 enthält und unverändert bleibt.
Innerhalb der Funktion legt <strong>R</strong> ein neues lokales Objekt, ebenfalls mit dem Namen
<code>value</code>, an.
Du <em>kannst</em> auch aus einer Funktion in einen <a href="#_arbeiten_mit_gültigkeitsbereichen">anderen Gültigkeitsbereich</a> schreiben, wenn Du das wirklich willst.</p></div>
<div class="sect3">
<h4 id="_lesezugriffe">2.4.1. Lesezugriffe</h4>
<div class="paragraph"><div class="title">Lesen ist unsicher</div><p>Mit dem Namen eines Objektes wird dieses gelesen, innerhalb einer Funktion sucht
<strong>R</strong> zunächst nach einem lokalen Objekt des gesuchten Namens, dann in den der
Funktion übergeordneten Gültigkeitsbereichen, also außerhalb der Funktion.</p></div>
<div class="paragraph"><p>Das kann zu unerwünschten Nebeneffekten führen. Stell Dir vor, Du kommentierst
beim Schreiben der Summenfunktion die Definition des zur Addition neutralen
Elementes aus Versehen aus:</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.8
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt>my_sum_broken &lt;- function(x) {
    <span style="font-style: italic"><span style="color: #9A1900"># FIXME: this is accidentally commented out:</span></span>
    <span style="font-style: italic"><span style="color: #9A1900"># value &lt;- 0</span></span>
    <span style="font-weight: bold"><span style="color: #0000FF">for</span></span> (x_i in x) {
        value &lt;- value + x_i
    }
    return(value)
}</tt></pre></div></div>
<div class="paragraph"><p>Du führst die Funktion aus und erhälst:</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.8
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt>print(my_sum_broken(1:3))</tt></pre></div></div>
<div class="listingblock">
<div class="content">
<pre><code>## [1] 25</code></pre>
</div></div>
<div class="paragraph"><p>Was ist passiert?
Im ersten Durchlauf der Schleife gibt es beim Lesen von
<code>value</code> noch kein lokales Objekt dieses Namens. Daher sucht <strong>R</strong> außerhalb der
Funktion und findet ein Objekt mit dem Wert 19.
Zu diesem Objekt addieren
wir <code>x_i</code>, das im ersten Schleifendurchlauf den Wert <code>1</code> enthält und erschaffen
damit in der Funktion ein lokales Objekt names <code>value</code>, das dann im zweiten
Durchlauf der Schleife auch gelesen werden kann.</p></div>
<div class="paragraph"><p>Wenn Du diese Funktion verwendest, ohne vorher das Objekt <code>value</code> zu definieren,
oder das Objekt <code>value</code> entfernst und dann die Funktion ausführst</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.8
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt>rm(value)
print(my_sum_broken(1:3))</tt></pre></div></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.8
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="font-style: italic"><span style="color: #9A1900">## Error: object 'value' not found</span></span>
</tt></pre></div></div>
<div class="paragraph"><p>erhälst Du einen Fehler, weil <strong>R</strong> auch außerhalb der Funktion kein Objekt
names <code>value</code> finden kann. Und diesen Fehler erwarten wir ja eigentlich, wenn
wir nur die Funktion betrachten: sie ist fehlerhaft.</p></div>
<div class="paragraph"><div class="title">Sicherer Lesen</div><p>Wie wir eine Funktion dazu bringen können, außerhalb ihres Gültigkeitsbereiches
zu schreiben (nein, das <em>wie</em> habe ich Dir noch nicht gezeigt&#8230; ), so können wir
eine Funktion auch zwingen, beim Lesen nur nach lokalen Objekten zu
suchen:</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.8
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt>my_sum_safer &lt;- function(x) {
    <span style="font-weight: bold"><span style="color: #0000FF">for</span></span> (x_i in x) {
        value &lt;- get(<span style="color: #FF0000">"value"</span>, inherits = FALSE) + x_i
    }
    return(value)
}</tt></pre></div></div>
<div class="paragraph"><p>Selbst wenn wir ein Objekt namens <code>value</code> anlegen, gibt die Funktion nun einen
Fehler aus:</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.8
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt>value &lt;- 42
my_sum_safer(1:10)</tt></pre></div></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.8
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="font-style: italic"><span style="color: #9A1900">## Error in get("value", inherits = FALSE): object 'value' not found</span></span>
</tt></pre></div></div>
<div class="paragraph"><p>Ich finde es aber praktiabler, beim Schreiben einer Funktion darauf zu achten,
welche Objekte ich lese.<br />
Und wenn Du Funktionen <a href="#_funktionen_testen">testest</a>, findest Du Fehler, die auf Scoping beruhen,
sehr schnell.</p></div>
</div>
<div class="sect3">
<h4 id="_arbeiten_mit_gültigkeitsbereichen">2.4.2. Arbeiten mit Gültigkeitsbereichen</h4>
<div class="paragraph"><p>Ein Befehl, mit dem Du alle Objekte Deines aktuellen Arbeitsbereiches löschen
kannst (entsprechend dem RStudio-Knopf mit dem Besensymbol <span class="footnote"><br />[Im <a href="https://github.com/rstudio/rstudio/releases/tag/v1.1.426">Code von RStudio v1.1.426</a> findet sich die Funktion hinter dem Knopf  in der Datei src/cpp/session/modules/SessionEnvironment.R, sie besteht im wesentlichen aus der Zeile<br />
rm(list=ls(envir=env, all.names=includeHidden), envir=env)<br />
Sie wird in src/cpp/session/modules/environment/SessionEnvironment.cpp in der C++-Funktion  removeAllObjects aufgerufen.
]<br /></span>) lautet:</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.8
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt>rm(list = ls(all.names = TRUE))</tt></pre></div></div>
<div class="paragraph"><p>Nun  bin ich
vergesslich, weshalb ich mir die Syntax schlecht merken kann und lieber eine
Funktion (aber keinen Knopf) hätte.
Da "der aktuelle Arbeitsbereich" ein Gültigkeitsbereich
(in <strong>R</strong> heissen die Gültigkeitsbereiche "environments", in <strong>S</strong> hießen sie "frames") ist, und die
Funktionen  <code>ls</code> und <code>rm</code> nur in <em>einem</em> Gültigkeitsbereich arbeiten, funktioniert das naheliegende</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.8
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt>wipe_clean &lt;- function() {
    rm(list = ls(all.names = TRUE))
}</tt></pre></div></div>
<div class="paragraph"><p><strong>nicht</strong>.</p></div>
<div class="paragraph"><p>Wenn ich den Gültigkeitsbereich explizit</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.8
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt>wipe_clean &lt;- function() {
    rm(list = ls(name = parent.frame(), all.names = TRUE), envir = parent.frame())
}</tt></pre></div></div>
<div class="paragraph"><p>angebe, tut die Funktion, was ich wollte:</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.8
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt>ls()</tt></pre></div></div>
<div class="listingblock">
<div class="content">
<pre><code>## [1] "a"             "a_i"           "my_sum"        "my_sum_broken"
## [5] "my_sum_safer"  "tmp"           "value"         "wipe_clean"</code></pre>
</div></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.8
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt>wipe_clean()
ls()</tt></pre></div></div>
<div class="listingblock">
<div class="content">
<pre><code>## character(0)</code></pre>
</div></div>
</div>
</div>
<div class="sect2">
<h3 id="_argumente">2.5. Argumente</h3>
<div class="paragraph"><p>Funktionen kennen Argmumente, am besten nicht zu viele (siehe zum Beispiel <a href="#cc">[cc]</a>).
Unsere Summenfunktion kennt beispielsweise eines, nämlich den Vektor, den sie summieren soll. Der ist also ein obligatorisches Element, er sollte keine Voreinstellung haben (und hat auch keine).</p></div>
<div class="paragraph"><p>Eine Funktion, die, wie <code>wipe_clean</code>, kein Argument kennt, ist Folgende:</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.8
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt>memory_hogs &lt;- function() {
    z &lt;- sapply(ls(envir = parent.frame()),
                function(x) object.size(get(x, envir = parent.frame())))
    return(z)
}</tt></pre></div></div>
<div class="paragraph"><p>Diese Funktion gibt mir für jedes Objekt des Gültigkeitsbereiches, in dem ich sie aufrufe, den Speicherverbrauch aus.</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.8
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt>va &lt;- rep(mtcars, 1)
vb &lt;- rep(mtcars, 1000)
vc &lt;- rep(mtcars, 2000)
vd &lt;- rep(mtcars, 100)
memory_hogs()</tt></pre></div></div>
<div class="listingblock">
<div class="content">
<pre><code>## memory_hogs          va          vb          vc          vd
##        7576        4232     3432720     6864720      343920</code></pre>
</div></div>
<div class="paragraph"><p>Bei so wenigen Objekten erkenne ich leicht, dass <code>vc</code> der größte Speicherfresser ist, und ich, falls mir der Speicher platzt und ich <code>vc</code> nicht mehr unbedingt brauche, <code>vc</code> löschen sollte.</p></div>
<div class="paragraph"><p>Aber wenn ich viele Objekte habe, wäre es doch schön, ein optionales Funktionsargument zu haben, dass in seiner Voreinstellung die Ausgabe nach Größe des Speicherbedarfs sortiert:</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.8
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt>memory_hogs &lt;- function(order = TRUE) {
    z &lt;- sapply(ls(envir = parent.frame()),
                function(x) object.size(get(x, envir = parent.frame())))
    <span style="font-weight: bold"><span style="color: #0000FF">if</span></span> (order) z &lt;- z[order(z)]
    return(z)
}</tt></pre></div></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.8
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt>memory_hogs()</tt></pre></div></div>
<div class="listingblock">
<div class="content">
<pre><code>##          va memory_hogs          vd          vb          vc
##        4232        9576      343920     3432720     6864720</code></pre>
</div></div>
<div class="paragraph"><p>Das ist ein klassisches (optionales) Steuerargument, das das Verhalten einer Funktion steuert.
Steuerargumente sollten eine sinnvolle Voreinstellung haben.</p></div>
<div class="paragraph"><p>Da die <code>memory_hogs</code> intern nun die Funktion <code>order</code> aufruft, könnten wir ja auf die Idee kommen, dieser Funktion Argumente weiterreichen zu wollen.
Das können wir entweder explizit tun, oder wir benutzen ein spezielles, <em>Ellipsis</em> genanntes Argument, das durch drei Punkte (<code>...</code>) aufgerufen wird:</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.8
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt>memory_hogs &lt;- function(...) {
    z &lt;- sapply(ls(envir = parent.frame()),
                function(x) object.size(get(x, envir = parent.frame())))
    <span style="font-weight: bold"><span style="color: #0000FF">if</span></span> (! missing(...)) {
      z &lt;- z[order(z, ...)]
    }
    return(z)
}</tt></pre></div></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.8
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt>memory_hogs()</tt></pre></div></div>
<div class="listingblock">
<div class="content">
<pre><code>## memory_hogs          va          vb          vc          vd
##       13080        4232     3432720     6864720      343920</code></pre>
</div></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.8
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt>memory_hogs(decreasing = TRUE)</tt></pre></div></div>
<div class="listingblock">
<div class="content">
<pre><code>##          vc          vb          vd memory_hogs          va
##     6864720     3432720      343920       13080        4232</code></pre>
</div></div>
<div class="paragraph"><p>Jetzt können wir die Rückgabe unserer Funktion nutzen, um die beiden größten Speicherfresser zu löschen:</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.8
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt>rm(list = names(memory_hogs(decreasing = TRUE)[1:2]))
memory_hogs()</tt></pre></div></div>
<div class="listingblock">
<div class="content">
<pre><code>## memory_hogs          va          vd
##       13080        4232      343920</code></pre>
</div></div>
<div class="paragraph"><p>Wir können also, wenn wir wollen, drei Arten von Argumenten unterscheiden:</p></div>
<div class="ulist"><ul>
<li>
<p>
Obligatorische. Sie sollten keine Voreinstellungen kennen und übergeben üblicherweise Objekte, die von der Funktion verarbeitet werden sollen.
</p>
</li>
<li>
<p>
Optionale. Sie sollten Voreinstellungen kennen und dienen üblicherweise der Steuerung der Funktion.
</p>
</li>
<li>
<p>
Die <em>Ellipsis</em>, um Argumente an andere Funktionen weiterzureichen.
</p>
</li>
</ul></div>
</div>
<div class="sect2">
<h3 id="_return_value_und_side_effects">2.6. Return Value und Side Effects</h3>
<div class="paragraph"><p>Jede Funktion in <strong>R</strong> gibt einen Wert zurück, falls sie nicht mit einem Fehler abbricht.
Wenn wir keinen Rückgabewert (return value) explizit angeben, ist er automatisch der Wert des letzten in der Funktion ausgewerteten Ausdrucks, also der letzte Wert, der wie auch immer berechnet oder zurückgegeben wurde.
Es ist daher sicher nicht schlecht, wenn Du versucht, den Rückgabewert explizit anzugeben.
Unsere Summenfunktion könnte auch so aussehen:</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.8
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt>my_sum &lt;- function(x) {
    value &lt;- 0
    <span style="font-weight: bold"><span style="color: #0000FF">for</span></span> (x_i in x) {
        value &lt;- value + x_i
    }
}</tt></pre></div></div>
<div class="paragraph"><p>Das ist zwar (um eine Zeile) kürzer und inhaltsgleich, aber weniger offentsichtlich. Und damit weniger gut lesbar.
Und damit mehr schlechter als eine Zeile kürzer mehr besser ist, capisce?</p></div>
<div class="paragraph"><p>Komplexere Funktionen haben oft Nebenwirkungen (side effects)
Bei vielen dieser Funktionen sind die Nebenwirkungen der eigentliche Zweck der Funktion, manchmal ist Rückgabewert sogar belanglos. Die Funktion <code>rm</code> gibt beispielsweise unsichtbar <code>NULL</code> zurück (und das selbst dann, wenn es gar nichts zu löschen gibt), das erkennen wir, wenn wir ihren Röckgabewert explizit drucken:</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.8
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt>a &lt;- <span style="color: #FF0000">"This is a string"</span>
print(rm(a))</tt></pre></div></div>
<div class="listingblock">
<div class="content">
<pre><code>## NULL</code></pre>
</div></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.8
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt>print(rm())</tt></pre></div></div>
<div class="listingblock">
<div class="content">
<pre><code>## NULL</code></pre>
</div></div>
<div class="paragraph"><p>Das heißt also, dass unsere Funktion <code>wipe_clean</code> den Wert <code>invisible(NULL)</code>, zurückgibt, denn das war der Wert des letzten in ihr ausgewerteten Ausdrucks (der Aufruf der Funktion <code>rm</code>).</p></div>
<div class="paragraph"><p>Das können wir ändern, indem wir einen expliziten Rückgabewert einbauen (bei der Gelegenheit wandeln wir gleich noch den Gütigkeitsbereich, indem die Funktion läscht, in ein Steuerargument mit Voreinstellung um):</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.8
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt>wipe_clean &lt;- function(environment = parent.frame()) {
    objects &lt;- ls(name = environment, all.names = TRUE)
    rm(list = objects, envir = environment)
    return(invisible(objects))
}</tt></pre></div></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.8
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt>print(wipe_clean())</tt></pre></div></div>
<div class="listingblock">
<div class="content">
<pre><code>## [1] "memory_hogs" "my_sum"      "va"          "vd"          "wipe_clean"</code></pre>
</div></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.8
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt>ls()</tt></pre></div></div>
<div class="listingblock">
<div class="content">
<pre><code>## character(0)</code></pre>
</div></div>
<div class="paragraph"><p>Jetzt gibt die Funktion die Namen der von ihr gelöschten Objekte zurück. Wir wissen also, wie hieß, was wir gelöscht haben. Damit können wir zwar nichts mehr anfangen, aber die Funktion hat nun genau einen expliziten Endpunkt. Das ist immerhin schön übersichtlich.</p></div>
</div>
<div class="sect2">
<h3 id="_funktionen_verwalten">2.7. Funktionen verwalten</h3>
<div class="sect3">
<h4 id="_lokal">2.7.1. Lokal</h4>
<div class="paragraph"><p>Mit source</p></div>
</div>
<div class="sect3">
<h4 id="_global">2.7.2. Global</h4>
<div class="paragraph"><p>Mit .Rprofile und einer Schleife</p></div>
</div>
<div class="sect3">
<h4 id="_als_package">2.7.3. Als Package</h4>
<div class="paragraph"><p>Das ist am aufwendigsten, aber auch am elegantesten.</p></div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_weniger_schlecht_programmieren">3. Weniger schlecht programmieren</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_argumententests">3.1. Argumententests</h3>
<div class="paragraph"><p>Wir haben verschiedene Möglichkeiten, die Objekte, die wir den Argumenten einer Funktion übergeben, zu testen.</p></div>
<div class="sect3">
<h4 id="_typentests">3.1.1. Typentests</h4>
<div class="paragraph"><p>Wir können Objekte darauf testen, ob sie einem bestimmten Typ (einer Klasse) angehören;
bei Objekten, die einer Funktion als Argument übergeben werden ist dies besonders ratsam.
Das geht mir reinen <code>base R</code>, ist aber eher umständlich,
die <a href="https://cran.r-project.org/web/packages/checkmate/vignettes/checkmate.html#intro">Vignette zu <code>checkmate</code></a>
bietet ein anschauliches Bespiel.</p></div>
<div class="paragraph"><p>Ich kenne zwei Packages, die Typentest vereinfachen: <code>assertthat</code> und <code>checkmate</code>.</p></div>
<div class="ulist"><ul>
<li>
<p>
<code>checkmate</code> ist hauptsächlich in C geschrieben, sehr schnell,
sehr flexibel mit unterschiedlichen Testarten ("checks", "asserts" und "tests"),
hat aber viele Abhängigkeiten und ist etwas sperrig: sein Manual ist über 100 Seiten lang.
</p>
</li>
<li>
<p>
<code>assertthat</code> ist reines R ohne irgendwelche Abhängigkeiten und recht übersichtlich.
</p>
</li>
</ul></div>
<div class="paragraph"><p><code>assertthat</code> ist sehr einfach:</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.8
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt>x &lt;- 6
assertthat::assert_that(is.numeric(x))</tt></pre></div></div>
<div class="listingblock">
<div class="content">
<pre><code>## [1] TRUE</code></pre>
</div></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.8
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt>x &lt;- <span style="color: #FF0000">"This is a string."</span>
assertthat::assert_that(is.numeric(x))</tt></pre></div></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.8
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="font-style: italic"><span style="color: #9A1900">## Error: x is not a numeric or integer vector</span></span>
</tt></pre></div></div>
<div class="paragraph"><div class="title">Was haben wir davon?</div><p>Wenn wir unserer Summenfunktion</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.8
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt>my_sum &lt;- function(x) {
    value &lt;- 0
    <span style="font-weight: bold"><span style="color: #0000FF">for</span></span> (x_i in x) {
        value &lt;- value + x_i
    }
    return(value)
}</tt></pre></div></div>
<div class="paragraph"><p>ein nicht-numerisches Argument übergeben, erhalten wir eine recht kryptische Fehlermeldung:</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.8
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt>my_sum(c(<span style="color: #FF0000">"a"</span>, <span style="color: #FF0000">"b"</span>))</tt></pre></div></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.8
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="font-style: italic"><span style="color: #9A1900">## Error in value + x_i: non-numeric argument to binary operator</span></span>
</tt></pre></div></div>
<div class="paragraph"><p>Durch den Einbau eines Typentests</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.8
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt>my_sum &lt;- function(x) {
    assertthat::assert_that(is.numeric(x))
    value &lt;- 0
    <span style="font-weight: bold"><span style="color: #0000FF">for</span></span> (x_i in x) {
        value &lt;- value + x_i
    }
    return(value)
}</tt></pre></div></div>
<div class="paragraph"><p>wird die Meldung deutlich verständlicher:</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.8
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt>my_sum(c(<span style="color: #FF0000">"a"</span>, <span style="color: #FF0000">"b"</span>))</tt></pre></div></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.8
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="font-style: italic"><span style="color: #9A1900">## Error: x is not a numeric or integer vector</span></span>
</tt></pre></div></div>
<div class="paragraph"><p>Mit <code>checkmate</code> können wir sogar erzwingen, dass x nicht nur numerisch sein muss,
sondern auch mindestens zwei Elemente haben soll. Eine Summe einer Zahl ist ja etwas albern:</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.8
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt>my_sum &lt;- function(x) {
    checkmate::qassert(x, <span style="color: #FF0000">"n&gt;=2"</span>)
    value &lt;- 0
    <span style="font-weight: bold"><span style="color: #0000FF">for</span></span> (x_i in x) {
        value &lt;- value + x_i
    }
    return(value)
}</tt></pre></div></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.8
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt>my_sum(42)</tt></pre></div></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.8
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="font-style: italic"><span style="color: #9A1900">## Error in rasciidoc::render("index.Rasciidoc"): Assertion on 'x' failed. Must be of length &gt;= 2, but has length 1.</span></span>
</tt></pre></div></div>
<div class="paragraph"><p><em>Ich nutze Typentests oft in Funktionen. Da <code>checkmate</code> deutlich mehr Funktionalität bietet, nutzte ich <code>assert_that</code> eher selten.</em></p></div>
</div>
<div class="sect3">
<h4 id="_auswahllisten">3.1.2. Auswahllisten</h4>
<div class="paragraph"><p>Mit Auswahllisten können wir Objekte darauf testen, ob sie eine von mehreren Möglichkeiten
enthalten. Das ist vor allem für Steuerargumente hilfreich.
<code>base R</code> kennt <code>match.arg</code>, das mit alphanumerischen Vektoren arbeitet und einfach das Objekt zurückgibt, wenn
es in der Auswahlliste enthalten ist:</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.8
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt>noten &lt;-  c(<span style="color: #FF0000">"sehr gut"</span>, <span style="color: #FF0000">"gut"</span>, <span style="color: #FF0000">"nicht soo gut"</span>, <span style="color: #FF0000">"das kann auf jeden Fall noch besser werden"</span>)
note  &lt;- <span style="color: #FF0000">"gut"</span>
match.arg(arg = note, choices = noten)</tt></pre></div></div>
<div class="listingblock">
<div class="content">
<pre><code>## [1] "gut"</code></pre>
</div></div>
<div class="paragraph"><p>Dabei bedient es sich dem "partial matching", das heißt, dass ein eindeutig einer Auswahlmöglichkeit zuzuordnender Anfang einer Zeichenkette ausreicht:</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.8
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt>note  &lt;- <span style="color: #FF0000">"das"</span>
match.arg(arg = note, choices = noten)</tt></pre></div></div>
<div class="listingblock">
<div class="content">
<pre><code>## [1] "das kann auf jeden Fall noch besser werden"</code></pre>
</div></div>
<div class="paragraph"><p>Wird kein Treffer in der Auswahlliste gefunden, erhalten wir einen Fehler:</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.8
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt>note  &lt;- <span style="color: #FF0000">"ausreichend"</span>
match.arg(arg = note, choices = noten)</tt></pre></div></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.8
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="font-style: italic"><span style="color: #9A1900">## Error in match.arg(arg = note, choices = noten): 'arg' should be one of "sehr gut", "gut", "nicht soo gut", "das kann auf jeden Fall noch besser werden"</span></span>
</tt></pre></div></div>
<div class="paragraph"><p><code>match.arg</code> ist genau, was hinter Steuerargumenten vieler Funktionen (z.b.  <code>mgcv::gam(optimizer = &#8230;)</code>) steckt, hier ein Beispiel aus der Hilfe zu <code>match.arg</code>:</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.8
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt>center &lt;- function(x, type = c(<span style="color: #FF0000">"mean"</span>, <span style="color: #FF0000">"median"</span>, <span style="color: #FF0000">"trimmed"</span>)) {
    type &lt;- match.arg(type)
    switch(type,
           mean = mean(x),
           median = median(x),
           trimmed = mean(x, trim = .1))
}
center(rnorm(100), <span style="color: #FF0000">"med"</span>)</tt></pre></div></div>
<div class="listingblock">
<div class="content">
<pre><code>## [1] -0.1310966</code></pre>
</div></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.8
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt>center(rnorm(100), <span style="color: #FF0000">"m"</span>)</tt></pre></div></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.8
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="font-style: italic"><span style="color: #9A1900">## Error in match.arg(type): 'arg' should be one of "mean", "median", "trimmed"</span></span>
</tt></pre></div></div>
<div class="paragraph"><p><code>checkmate</code> kennt auch Auswahllisten, macht aber kein <code>partial matching</code> (was ich ganz gut finde):</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.8
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt>note  &lt;- <span style="color: #FF0000">"das"</span>
checkmate::assertChoice(x = note, choices = noten)</tt></pre></div></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.8
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="font-style: italic"><span style="color: #9A1900">## Error in rasciidoc::render("index.Rasciidoc"): Assertion on 'note' failed: Must be element of set {'sehr gut','gut','nicht soo gut','das kann auf jeden Fall noch besser werden'}, but is 'das'.</span></span>
</tt></pre></div></div>
<div class="paragraph"><p>Außerdem gibt <code>checkmate</code> die gefundene Rückgabe unsichtbar zurück, weshalb ich hier ein explizites <code>print</code> benötige:</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.8
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt>note  &lt;- <span style="color: #FF0000">"gut"</span>
checkmate::assertChoice(x = note, choices = noten)
print(checkmate::assertChoice(x = note, choices = noten))</tt></pre></div></div>
<div class="listingblock">
<div class="content">
<pre><code>## [1] "gut"</code></pre>
</div></div>
<div class="paragraph"><p><code>checkmate</code> kann nicht nur mit alphanumerischen Vektoren umgehen:</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.8
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt>x &lt;- 3
choices &lt;- 1:7
print(checkmate::assertChoice(x = x, choices = choices))</tt></pre></div></div>
<div class="listingblock">
<div class="content">
<pre><code>## [1] 3</code></pre>
</div></div>
<div class="paragraph"><p><em>Ich nutze Auswahllisten eher selten, da ich selten Steuerargumente mit mehreren Auswahlmöglichenkeiten in meinen Funktionen habe.</em></p></div>
</div>
</div>
<div class="sect2">
<h3 id="_funktionen_testen">3.2. Funktionen testen</h3>
<div class="sect3">
<h4 id="_unit_testing">3.2.1. Unit Testing</h4>
<div class="paragraph"><p>Beim Unit Testing wollen wir nicht die einer Funktion übergebenen Argumente, sondern die Funktion selbst testen.
Also im Zweifel ihren Rückgabewert.</p></div>
<div class="paragraph"><p>Ich kenne zwei Packages, die Unit Testing in R formalisieren
(im Prinzip geht es auch ohne spezielle Packages,
 aber seit ich die beiden Packages kenne,
 habe ich nie mehr wie früher "von Hand" getestet):</p></div>
<div class="ulist"><ul>
<li>
<p>
<code>RUnit</code> gibt es schon seit 2004, es ist sehr formal
 und hat wenige Abhängigkeiten (daher bevorzuge ich es).
</p>
</li>
<li>
<p>
<code>testthat</code> finde ich interaktiv einfacher anzuwenden.
</p>
</li>
</ul></div>
<div class="sect4">
<h5 id="_erwartungen">Erwartungen</h5>
<div class="paragraph"><p>Die kleinste Testeinheit ist immer ein Vergleich.</p></div>
<div class="paragraph"><p>Wenn wir die Funktionen</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.8
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt>my_sum &lt;- function(x) {
    value &lt;- 0
    <span style="font-weight: bold"><span style="color: #0000FF">for</span></span> (x_i in x) {
        value &lt;- value + x_i
    }
    return(value)
}</tt></pre></div></div>
<div class="literalblock">
<div class="content">
<pre><code>und</code></pre>
</div></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.8
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt>not_my_sum &lt;- function(x) {
    value &lt;- 0
    <span style="font-weight: bold"><span style="color: #0000FF">for</span></span> (x_i in x) {
        value &lt;- value - x_i
    }
    return(value)
}</tt></pre></div></div>
<div class="paragraph"><p>haben, k&ouml;nnen wir zum Beispiel mit <code>base R</code> prüfen, ob sie tun, was wir erwarten:</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.8
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt>my_sum(c(2, 7)) == 9</tt></pre></div></div>
<div class="listingblock">
<div class="content">
<pre><code>## [1] TRUE</code></pre>
</div></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.8
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="font-style: italic"><span style="color: #9A1900"># better use identical(), see ?Comparison</span></span>
identical(not_my_sum(c(2, 7)), 9)</tt></pre></div></div>
<div class="listingblock">
<div class="content">
<pre><code>## [1] FALSE</code></pre>
</div></div>
<div class="paragraph"><p>Beide Packages formalisieren dies zu Erwartungsfunktionen die haupts&auml;chliche dazu dienen,
Fehler zu beschreiben:</p></div>
<div class="listingblock">
<div class="title"><code>RUnit</code></div>
<div class="content"><!-- Generator: GNU source-highlight 3.1.8
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt>RUnit::checkIdentical(not_my_sum(c(2, 7)), 9)</tt></pre></div></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.8
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="font-style: italic"><span style="color: #9A1900">## Error in RUnit::checkIdentical(not_my_sum(c(2, 7)), 9): FALSE</span></span>
<span style="font-style: italic"><span style="color: #9A1900">##</span></span>
</tt></pre></div></div>
<div class="listingblock">
<div class="title"><code>testthat</code></div>
<div class="content"><!-- Generator: GNU source-highlight 3.1.8
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt>testthat::expect_identical(not_my_sum(c(2, 7)), 9)</tt></pre></div></div>
<div class="listingblock">
<div class="content">
<pre><code>## not_my_sum(c(2, 7)) not identical to 9.
## 1/1 mismatches
## [1] -9 - 9 == -18</code></pre>
</div></div>
</div>
<div class="sect4">
<h5 id="_tests">Tests</h5>
<div class="paragraph"><p>Um Erwartungen bei der Paketentwicklung oder in Bezug auf ihre <a href="#_code_coverage">Coverage</a> auszuwerten,
    werden in beiden Packages Erwartungen zu Tests zusammenfasst
(eigentlich sollten Tests immer nur Erwartungen zu einer Funktion enthalten, aber wir wollen ja auch Fehler sehen):</p></div>
<div class="listingblock">
<div class="title"><code>testthat</code></div>
<div class="content"><!-- Generator: GNU source-highlight 3.1.8
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt>testthat::test_that(<span style="color: #FF0000">"Simple test on summation."</span>, {
                        testthat::expect_identical(not_my_sum(c(2, 7)), 9)
                        testthat::expect_identical(my_sum(c(2, 7)), 9)}
)</tt></pre></div></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.8
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="font-style: italic"><span style="color: #9A1900">## Error: Test failed: 'Simple test on summation.'</span></span>
<span style="font-style: italic"><span style="color: #9A1900">## * not_my_sum(c(2, 7)) not identical to 9.</span></span>
<span style="font-style: italic"><span style="color: #9A1900">## 1/1 mismatches</span></span>
<span style="font-style: italic"><span style="color: #9A1900">## [1] -9 - 9 == -18</span></span>
</tt></pre></div></div>
<div class="paragraph"><div class="title"><code>RUnit</code></div><p><code>RUnit</code> wurde f&uuml;r das Testen von Packages entwickelt, es ist beim einfachen</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.8
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt>test_sum &lt;- function() {
    RUnit::checkIdentical(not_my_sum(c(2, 7)), 9)
    RUnit::checkIdentical(my_sum(c(2, 7)), 9)
}
test_sum()</tt></pre></div></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.8
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="font-style: italic"><span style="color: #9A1900">## Error in RUnit::checkIdentical(not_my_sum(c(2, 7)), 9): FALSE</span></span>
<span style="font-style: italic"><span style="color: #9A1900">##</span></span>
</tt></pre></div></div>
<div class="paragraph"><p>recht spr&ouml;de. Das Package erwartet eine Testdatei</p></div>
<div class="listingblock">
<div class="title">src/runit_my_sum.R</div>
<div class="content"><!-- Generator: GNU source-highlight 3.1.8
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt>test_sum &lt;- function() {
    RUnit::checkIdentical(not_my_sum(c(2, 7)), 9)
    RUnit::checkIdentical(my_sum(c(2, 7)), 9)
}</tt></pre></div></div>
<div class="paragraph"><p>und wird dann gespr&auml;chiger:</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.8
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt>source(file.path(<span style="color: #FF0000">"src"</span>, <span style="color: #FF0000">"my_sum.R"</span>))
source(file.path(<span style="color: #FF0000">"src"</span>, <span style="color: #FF0000">"not_my_sum.R"</span>))
test_file &lt;- normalizePath(file.path(<span style="color: #FF0000">"src"</span>, <span style="color: #FF0000">"runit_my_sum.R"</span>))
runit &lt;- RUnit::runTestFile(test_file)</tt></pre></div></div>
<div class="listingblock">
<div class="content">
<pre><code>##
##
## Executing test function test_sum  ... Timing stopped at: 0 0 0.001
##  done successfully.</code></pre>
</div></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.8
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt>RUnit::printTextProtocol(runit)</tt></pre></div></div>
<div class="listingblock">
<div class="content">
<pre><code>## RUNIT TEST PROTOCOL -- Thu Mar 15 17:13:53 2018
## ***********************************************
## Number of test functions: 1
## Number of errors: 0
## Number of failures: 1
##
##
## 1 Test Suite :
## runit_my_sum - 1 test function, 0 errors, 1 failure
## FAILURE in test_sum: Error in RUnit::checkIdentical(not_my_sum(c(2, 7)), 9) : FALSE
##
##
##
##
## Details
## ***************************
## Test Suite: runit_my_sum
## Test function regexp: ^test.+
## Test file regexp: ^runit_my_sum.R$
## Involved directory:
## /home/nik/git/cs/fvafrcu/funktionen_in_r/src
## ---------------------------
## Test file: /home/nik/git/cs/fvafrcu/funktionen_in_r/src/runit_my_sum.R
## test_sum: FAILURE !! (check number 1)
## Error in RUnit::checkIdentical(not_my_sum(c(2, 7)), 9) : FALSE
##</code></pre>
</div></div>
</div>
</div>
<div class="sect3">
<h4 id="_code_coverage">3.2.2. Code Coverage</h4>
<div class="paragraph"><p>Um zu sehen, ob Deine Unit Tests die Funktion gut testen, kannst Du ihre  (<a href="https://en.wikipedia.org/wiki/Code_coverage">&Uuml;berdeckung</a>) berechnen.
<code>covr</code> ist eines der Packages, die Code Coverage implentieren und das einzige, das ich nutze. Ich wei&szlig; es nicht, glaube aber, dass <code>covr</code> die <a href="https://en.wikipedia.org/wiki/Code_coverage#Coverage_criteria"><em>branch coverage</em></a>
berechnet.
Prinzipiell ist eine hohe &Uuml;berdeckung gut.</p></div>
<div class="paragraph"><p>Wenn Du eine Datei mit einer Funktionsdefinition</p></div>
<div class="listingblock">
<div class="title">src/my_sum_assertion.R</div>
<div class="content"><!-- Generator: GNU source-highlight 3.1.8
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt>my_sum &lt;- function(x) {
    assertthat::assert_that(is.numeric(x))
    value &lt;- 0
    <span style="font-weight: bold"><span style="color: #0000FF">for</span></span> (x_i in x) {
        value &lt;- value + x_i
    }
    return(value)
}</tt></pre></div></div>
<div class="paragraph"><p>und eine mit dem Test</p></div>
<div class="listingblock">
<div class="title">src/test_my_sum_assertion.R</div>
<div class="content"><!-- Generator: GNU source-highlight 3.1.8
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt>testthat::test_that(<span style="color: #FF0000">"Simple test on summation."</span>,
                    testthat::expect_identical(my_sum(c(2, 7)), 9)
                    )</tt></pre></div></div>
<div class="paragraph"><p>hast, kannst Du die &Uuml;berdeckung berechnen.</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.8
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt>cov &lt;- covr::file_coverage(<span style="color: #FF0000">"src/my_sum_assertion.R"</span>, <span style="color: #FF0000">"src/test_my_sum_assertion.R"</span>)
print(cov)</tt></pre></div></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.8
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="font-style: italic"><span style="color: #9A1900">## Coverage: 100.00%</span></span>
</tt></pre></div></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.8
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="font-style: italic"><span style="color: #9A1900">## src/my_sum_assertion.R: 100.00%</span></span>
</tt></pre></div></div>
<div class="paragraph"><p>Wenn Du eine Funktion schreibst, in der eine Zeile eingebaut ist, die der Test nicht
erreicht, weist Dich <code>covr</code> darauf hin:</p></div>
<div class="listingblock">
<div class="title">src/my_sum_assertion.R</div>
<div class="content"><!-- Generator: GNU source-highlight 3.1.8
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt>my_sum &lt;- function(x) {
    assertthat::assert_that(is.numeric(x))
    <span style="font-weight: bold"><span style="color: #0000FF">if</span></span> (! is.numeric(x)) message(<span style="color: #FF0000">"You'll never get here!"</span>)
    value &lt;- 0
    <span style="font-weight: bold"><span style="color: #0000FF">for</span></span> (x_i in x) {
        value &lt;- value + x_i
    }
    return(value)
}</tt></pre></div></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.8
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt>cov &lt;- covr::file_coverage(<span style="color: #FF0000">"src/my_sum_coverage.R"</span>, <span style="color: #FF0000">"src/test_my_sum_assertion.R"</span>)
print(cov)</tt></pre></div></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.8
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="font-style: italic"><span style="color: #9A1900">## Coverage: 83.33%</span></span>
</tt></pre></div></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.8
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="font-style: italic"><span style="color: #9A1900">## src/my_sum_coverage.R: 83.33%</span></span>
</tt></pre></div></div>
<div class="paragraph"><p><code>covr</code> sagt Dir sogar, dass es die dritte Zeile ist:</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.8
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt>covr::zero_coverage(cov)</tt></pre></div></div>
<div class="listingblock">
<div class="content">
<pre><code>##                filename functions line value
## 2 src/my_sum_coverage.R    my_sum    3     0</code></pre>
</div></div>
<div class="sect4">
<h5 id="_nebenwirkungen_testen">Nebenwirkungen testen</h5>
<div class="paragraph"><p>Funktionen sind relativ einfach zu testen, wenn ihr R&uuml;ckgabewert ihr Zweck ist.
Wenn sie aber Nebenwirkungen bezwecken, finde ich Tests schwieriger zu schreiben.</p></div>
<div class="paragraph"><p>Stell Dir vor, Du h&auml;ttest die fehlerhafte L&ouml;schfunktion aus
<a href="#_arbeiten_mit_gültigkeitsbereichen">Arbeiten mit Gültigkeitsbereichen</a>
in eine Datei geschrieben:</p></div>
<div class="listingblock">
<div class="title">src/wipe_clean_broken.R</div>
<div class="content"><!-- Generator: GNU source-highlight 3.1.8
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt>wipe_clean &lt;- function(environment = parent.frame()) {
    objects &lt;- ls(name = environment, all.names = TRUE)
    rm(list = objects)
    return(invisible(objects))
}</tt></pre></div></div>
<div class="paragraph"><p>Nun schreibst Du eine Testdatei:</p></div>
<div class="listingblock">
<div class="title">src/test_wipe_clean_broken.R</div>
<div class="content"><!-- Generator: GNU source-highlight 3.1.8
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt>testthat::test_that(<span style="color: #FF0000">"Test return value."</span>, {
                    a &lt;- 3
                    testthat::expect_identical(wipe_clean(),
                                               c(<span style="color: #FF0000">"a"</span>))}
                    )</tt></pre></div></div>
<div class="paragraph"><p>Und erh&auml;lst vollst&auml;ndige &Uuml;berdeckung:</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.8
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt>cov &lt;- covr::file_coverage(<span style="color: #FF0000">"src/wipe_clean_broken.R"</span>, <span style="color: #FF0000">"src/test_wipe_clean_broken.R"</span>)
print(cov)</tt></pre></div></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.8
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="font-style: italic"><span style="color: #9A1900">## Coverage: 100.00%</span></span>
</tt></pre></div></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.8
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="font-style: italic"><span style="color: #9A1900">## src/wipe_clean_broken.R: 100.00%</span></span>
</tt></pre></div></div>
<div class="paragraph"><p>Alles gut? Nein, die Funktion ist kaputt, und die Testdatei, die dies zeigt m&uuml;sste
auf die Nebenwirkung testen:</p></div>
<div class="listingblock">
<div class="title">src/test_wipe_clean.R</div>
<div class="content"><!-- Generator: GNU source-highlight 3.1.8
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt>testthat::test_that(<span style="color: #FF0000">"Test return value and side effects."</span>, {
                    a &lt;- 3
                    testthat::expect_identical(wipe_clean(), c(<span style="color: #FF0000">"a"</span>))
                    testthat::expect_identical(ls(), character(0))}
                    )</tt></pre></div></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.8
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt>covr::file_coverage(<span style="color: #FF0000">"src/wipe_clean_broken.R"</span>, <span style="color: #FF0000">"src/test_wipe_clean.R"</span>)</tt></pre></div></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.8
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="font-style: italic"><span style="color: #9A1900">## Error: Test failed: 'Test return value and side effects.'</span></span>
<span style="font-style: italic"><span style="color: #9A1900">## * ls() not identical to character(0).</span></span>
<span style="font-style: italic"><span style="color: #9A1900">## Lengths differ: 1 vs 0</span></span>
</tt></pre></div></div>
</div>
</div>
<div class="sect3">
<h4 id="_was_soll_die_ganze_testerei">3.2.3. Was soll die ganze Testerei?</h4>
<div class="paragraph"><p>Ich habe einmal die Funktion</p></div>
<div class="listingblock">
<div class="title">src/golden_ratio.R</div>
<div class="content"><!-- Generator: GNU source-highlight 3.1.8
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt>golden_ratio  &lt;- function(value, quantity = c(<span style="color: #FF0000">"a + b"</span>, <span style="color: #FF0000">"a"</span>, <span style="color: #FF0000">"b"</span>)) {
    quantity &lt;- match.arg(quantity)
    phi &lt;- (1 + sqrt(5)) / 2
    switch(quantity,
           <span style="color: #FF0000">"a"</span> = {
               a  &lt;- value
               b &lt;- a / phi
           },
           <span style="color: #FF0000">"b"</span> = {
               b &lt;- value
               a &lt;- b * phi
           },
           {
               a &lt;- value / phi
               b &lt;- a * phi - a
           }
           )
    return(c(<span style="color: #FF0000">"a"</span> = a, <span style="color: #FF0000">"b"</span> = b, <span style="color: #FF0000">"a + b"</span> = a + b))
}</tt></pre></div></div>
<div class="paragraph"><p>geschrieben, die mir den <a href="https://de.wikipedia.org/wiki/Goldener_Schnitt">Goldenen Schnitt</a> anwendet:</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.8
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt>golden_ratio(6)</tt></pre></div></div>
<div class="listingblock">
<div class="content">
<pre><code>##        a        b    a + b
## 6.000000 3.708204 9.708204</code></pre>
</div></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.8
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt>golden_ratio(6, <span style="color: #FF0000">"b"</span>)</tt></pre></div></div>
<div class="listingblock">
<div class="content">
<pre><code>##         a         b     a + b
##  9.708204  6.000000 15.708204</code></pre>
</div></div>
<div class="paragraph"><p>Und ich habe auch einen Test geschrieben:</p></div>
<div class="listingblock">
<div class="title">src/test_golden_ratio.R</div>
<div class="content"><!-- Generator: GNU source-highlight 3.1.8
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt>testthat::test_that(<span style="color: #FF0000">"Simple test golden ratio"</span>, {
                    expectation &lt;- c(a = 6, b = 3.70820393249937, <span style="color: #FF0000">"a + b"</span> = 9.70820393249937)
                    result &lt;- golden_ratio(6)
                    testthat::expect_equal(result, expectation)
                    result &lt;- golden_ratio(6, <span style="color: #FF0000">"a"</span>)
                    testthat::expect_equal(result, expectation)
                    result &lt;- golden_ratio(3.70820393249937, <span style="color: #FF0000">"b"</span>)
                    testthat::expect_equal(result, expectation)
})</tt></pre></div></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.8
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt>covr::file_coverage(file.path(<span style="color: #FF0000">"src"</span>, <span style="color: #FF0000">"golden_ratio.R"</span>),
                    file.path(<span style="color: #FF0000">"src"</span>, <span style="color: #FF0000">"test_golden_ratio.R"</span>))</tt></pre></div></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.8
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="font-style: italic"><span style="color: #9A1900">## Coverage: 100.00%</span></span>
</tt></pre></div></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.8
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="font-style: italic"><span style="color: #9A1900">## src/golden_ratio.R: 100.00%</span></span>
</tt></pre></div></div>
<div class="listingblock">
<div class="title">src/golden_ratio.R</div>
<div class="content"><!-- Generator: GNU source-highlight 3.1.8
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt>golden_ratio  &lt;- function(value, quantity = c(<span style="color: #FF0000">"a + b"</span>, <span style="color: #FF0000">"a"</span>, <span style="color: #FF0000">"b"</span>)) {
    quantity &lt;- match.arg(quantity)
    phi &lt;- (1 + sqrt(5)) / 2
    switch(quantity,
           <span style="color: #FF0000">"a"</span> = {
               a  &lt;- value
               b &lt;- a / phi
           },
           <span style="color: #FF0000">"b"</span> = {
               b &lt;- value
               a &lt;- b * phi
           },
           {
               a &lt;- value / phi
               b &lt;- a * phi - a
           }
           )
    return(c(<span style="color: #FF0000">"a"</span> = a, <span style="color: #FF0000">"b"</span> = b, <span style="color: #FF0000">"a + b"</span> = a + b))
}</tt></pre></div></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.8
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt>covr::file_coverage(file.path(<span style="color: #FF0000">"src"</span>, <span style="color: #FF0000">"golden_ratio.R"</span>),
                    file.path(<span style="color: #FF0000">"src"</span>, <span style="color: #FF0000">"test_golden_ratio.R"</span>))</tt></pre></div></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.8
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="font-style: italic"><span style="color: #9A1900">## Warning in mapply(FUN = f, ..., SIMPLIFY = FALSE): longer argument not a</span></span>
<span style="font-style: italic"><span style="color: #9A1900">## multiple of length of shorter</span></span>
</tt></pre></div></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.8
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="font-style: italic"><span style="color: #9A1900">## Error: Test failed: 'Simple test golden ratio'</span></span>
<span style="font-style: italic"><span style="color: #9A1900">## * `result` not equal to `expectation`.</span></span>
<span style="font-style: italic"><span style="color: #9A1900">## 3/3 mismatches (average diff: 2.47)</span></span>
<span style="font-style: italic"><span style="color: #9A1900">## [1] 3.71 - 6.00 == -2.29</span></span>
<span style="font-style: italic"><span style="color: #9A1900">## [2] 2.29 - 3.71 == -1.42</span></span>
<span style="font-style: italic"><span style="color: #9A1900">## [3] 6.00 - 9.71 == -3.71</span></span>
</tt></pre></div></div>
<div class="paragraph"><p><em>Ich teste fast alle meine Funktion spätestens, wenn ich sie in ein Package verpacke.</em></p></div>
</div>
</div>
<div class="sect2">
<h3 id="_schöner_programmieren">3.3. Schöner Programmieren</h3>
<div class="paragraph"><p>Ich möchte Dir gerne noch drei Funktionen aus drei verschiedenen Packages vorstellen,
die Dir helfen können, gut lesbare Funktionen zu schreiben. <em>Ich nutze alle drei standardmäßig bei der Entwicklung von Packages.</em>
Aber vorweg stelle ich Dir noch <code>codetools</code> vor, es gehört zur Gruppe der <em>recommended</em> Packages von <strong>R</strong> und kann Programmfehler finden, die drei anderen Packages gibt es nur, weil <code>codetools</code> schon da war.</p></div>
<div class="paragraph"><p>Stell Dir vor, Du hättest in der Datei "src/code.R" folgende unschöne
und kaputte Funktion geschrieben:</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.8
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt>foo &lt;- function(this, func, has, way, too, many,args) {
    <span style="font-weight: bold"><span style="color: #0000FF">if</span></span> (TRUE) { <span style="font-weight: bold"><span style="color: #0000FF">if</span></span> (TRUE) {
            <span style="font-weight: bold"><span style="color: #0000FF">if</span></span> (TRUE) {
                <span style="font-weight: bold"><span style="color: #0000FF">if</span></span> (TRUE) {
                    <span style="font-weight: bold"><span style="color: #0000FF">if</span></span> (TRUE) {
                        print(this_is_not_defined)
                    } <span style="font-weight: bold"><span style="color: #0000FF">else</span></span> {
                        stop(<span style="color: #FF0000">"Foobar!"</span>)
                    }
                } <span style="font-weight: bold"><span style="color: #0000FF">else</span></span> {
                    stop(<span style="color: #FF0000">"Foobar!"</span>)
                }
            } <span style="font-weight: bold"><span style="color: #0000FF">else</span></span> {
                stop(<span style="color: #FF0000">"Foobar!"</span>)
            }
        } <span style="font-weight: bold"><span style="color: #0000FF">else</span></span> {
            stop(<span style="color: #FF0000">"Foobar!"</span>)
        }
    } <span style="font-weight: bold"><span style="color: #0000FF">else</span></span> {
        stop(<span style="color: #FF0000">"Foobar!"</span>)
    }
    return(invisible(NULL))
}</tt></pre></div></div>
<div class="sect3">
<h4 id="_code_prüfen_mit_codetools">3.3.1. Code prüfen mit Codetools</h4>
<div class="paragraph"><p>In Deiner Funktion findet <code>codetools</code> die nicht benutzten Funktionsargumente und das nicht definierte Objekt <code>this_is_not_defined</code>:</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.8
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt>source(<span style="color: #FF0000">"src/code.R"</span>)
codetools::checkUsage(foo, all = TRUE)</tt></pre></div></div>
<div class="listingblock">
<div class="content">
<pre><code>## &lt;anonymous&gt;: no visible binding for global variable 'this_is_not_defined'
## &lt;anonymous&gt;: parameter 'args' may not be used
## &lt;anonymous&gt;: parameter 'func' may not be used
## &lt;anonymous&gt;: parameter 'has' may not be used
## &lt;anonymous&gt;: parameter 'many' may not be used
## &lt;anonymous&gt;: parameter 'this' may not be used
## &lt;anonymous&gt;: parameter 'too' may not be used
## &lt;anonymous&gt;: parameter 'way' may not be used</code></pre>
</div></div>
</div>
<div class="sect3">
<h4 id="_entflusen_mit_lintr">3.3.2. Entflusen mit lintr</h4>
<div class="paragraph"><p>Das Package <code>lintr</code> prüft Code auf Fussel, das sind Abweichungen des Codes von Richtlinien
zur übersichtlichen Formatierung.
Die Richtlinien (gegen die <code>lintr</code> prüft, und die sind gut, halte Dich an sie;
                 zu mehr über Progammierrichtlinien findest Du im <a href="https://fvafrcu.github.io/programmierleitfaden.ps">Programmierleitfaden an der Forstlichen Versuchs- und Forschungsanstalt Baden-Württemberg</a>)
sehen unter anderem vor,
dass auf Kommas immer ein Leerzeichen folgen sollte,
dass auf öffnende geschweifte Klammern immer ein Zeilenumbruch folgen sollte und
dass eine Datei keine Leerzeilen am Ende enthalten sollte:</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.8
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt>lintr::lint(<span style="color: #FF0000">"src/code.R"</span>)</tt></pre></div></div>
<div class="listingblock">
<div class="content">
<pre><code>## src/code.R:1:49: style: Commas should always have a space after.
## foo &lt;- function(this, func, has, way, too, many,args) {
##                                                 ^
## src/code.R:2:15: style: Opening curly braces should never go on their own line and should always be followed by a new line.
##     if (TRUE) { if (TRUE) {
##               ^
## src/code.R:6:31: warning: no visible binding for global variable 'this_is_not_defined'
##                         print(this_is_not_defined)
##                               ^~~~~~~~~~~~~~~~~~~
## src/code.R:24:1: style: Trailing blank lines are superfluous.
##
## ^</code></pre>
</div></div>
<div class="paragraph"><p>Das Package kennt viele Optionen, lies Dir die Hilfe durch!</p></div>
</div>
<div class="sect3">
<h4 id="_code_säubern_mit_cleanr">3.3.3. Code säubern mit cleanr</h4>
<div class="paragraph"><p>Das Package <code>cleanr</code> prüft die Länge und (Zeilen-) Breite von Funktionen und Codedateien und
die Verschachtelungstiefe von Funktionen, ihre Argumentenanzahl und ob sie einen expliziten
Rückgabewert haben.</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.8
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt>print(suppressWarnings(cleanr::check_file(<span style="color: #FF0000">"src/code.R"</span>)))</tt></pre></div></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.8
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="font-style: italic"><span style="color: #9A1900">## Error in cleanr::check_file("src/code.R"):  src/code.R  foo  found 7 arguments, max_num_arguments was 5</span></span>
<span style="font-style: italic"><span style="color: #9A1900">## foo  found nesting depth 4, max_nesting_depth was 3</span></span>
</tt></pre></div></div>
<div class="paragraph"><p>Auch dieses Package kennt viele Optionen, lies Dir die Hilfe durch!</p></div>
</div>
<div class="sect3">
<h4 id="_cyclomatic_complexity_prüfen_mit_cyclocomp">3.3.4. Cyclomatic Complexity prüfen mit cyclocomp</h4>
<div class="paragraph"><p>McCabes "cyclomatic complexity" (<a href="#cyc">[cyc]</a>) mißt die
Komplexität von Programmcode.
Mit ihr kannst Du prüfen, ob Deine Funktionen einfach genug sind.</p></div>
<div class="paragraph"><p>Insbesondere gibt Dir die "cyclomatic complexity" eine Idee davon, wie viele Testfälle Du
für eine Funktion schreiben solltest
(genau genommen ist sie eine obere Grenze für die Anzahl der für vollständige <a href="https://en.wikipedia.org/wiki/Code_coverage">branch coverage</a> benötigten Testfälle).
Für Deine häßliche Funktion bräuchtest Du also
6 Testfälle:</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.8
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt>cyclocomp::cyclocomp(parse(text = readLines(<span style="color: #FF0000">"src/code.R"</span>)))</tt></pre></div></div>
<div class="listingblock">
<div class="content">
<pre><code>## [1] 6</code></pre>
</div></div>
<div class="paragraph"><p>Allgemein gilt: je höher die "cyclomatic complexity", desto unverständlicher der Code.
McCabe empfiehlt eine "cyclomatic complexity" von nicht mehr als 10 für eine Funktion. Und der war professioneller Programmierer des Departement of Defense der National Security Agency. Bei einer "cyclomatic complexity"  von 20 dürfte es selbst für professionelle Programmiererinnen langsam schwierig werden, die Absicht hinter Deinem Code zu verstehen. Wenn Du eine "cyclomatic complexity" von mehr als 40 schaffst, hast Du vielleicht eine Funktion geschrieben, die tut, was sie soll, aber ziemlich sicher eine, die kaum ein Mensch mehr versteht.</p></div>
<div class="paragraph"><p>Natürlich gibt es immer Ausnahmen von der Regel. Die Funktion <code>devtools::release</code> beispielsweise
hat eine ganze Reihe von interaktiven Abfragen des Typs</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.8
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="font-weight: bold"><span style="color: #0000FF">if</span></span> (yesno(<span style="color: #FF0000">"Were devtool's checks successful?"</span>))
  return(invisible())</tt></pre></div></div>
<div class="paragraph"><p>Diese treiben die "cyclomatic complexity" in die Höhe (weil die <code>return</code>-Anweisungen
                                                        viele verschiedene mögliche Endpunkte der Funktion definieren. Eine gut strukturierte Funktion hat <em>genau einen</em> "exit node"):</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.8
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt>source(<span style="color: #FF0000">"src/release.R"</span>)
cyclocomp::cyclocomp(release)</tt></pre></div></div>
<div class="listingblock">
<div class="content">
<pre><code>## [1] 44</code></pre>
</div></div>
<div class="paragraph"><p>Dabei ist die Funktion nur schwer verdaulich und nicht völlig unlesbar.
Dennoch sollte Hadley Wickham die Funktion dringend entrümpeln:</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.8
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt>linters &lt;- lintr::default_linters[names(lintr::default_linters )!= <span style="color: #FF0000">"object_usage_linter"</span>]
lintr::lint(<span style="color: #FF0000">"src/release.R"</span>, linters = linters)</tt></pre></div></div>
<div class="listingblock">
<div class="content">
<pre><code>## src/release.R:70:1: style: lines should not be more than 80 characters.
##     if (yesno("Is documentation free of spelling errors? (you can ignore false positives)"))
## ^~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
## src/release.R:87:40: warning: Do not use absolute paths.
##     cran_url &lt;- paste0(cran_mirror(), "/web/checks/check_results_",
##                                        ^~~~
## src/release.R:100:49: style: Commas should never have a space before.
##     msg &lt;- paste0("Have you checked the ", deps ," packages that depend on ",
##                                                ~^
## src/release.R:100:50: style: Commas should always have a space after.
##     msg &lt;- paste0("Have you checked the ", deps ," packages that depend on ",
##                                                  ^
## src/release.R:166:1: style: lines should not be more than 80 characters.
##   yeses &lt;- c("Yes", "Definitely", "For sure", "Yup", "Yeah", "I agree", "Absolutely")
## ^~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
## src/release.R:187:53: style: Closing curly-braces should always be on their own line, unless it's followed by an else.
##     utils::browseURL(url, browser = email_browser())},
##                                                     ^
## src/release.R:301:17: style: Variable and function names should be all lowercase.
##   new_url$query$strErr
##                 ^~~~~~</code></pre>
</div></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.8
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt>suppressWarnings(cleanr::check_file(<span style="color: #FF0000">"src/release.R"</span>))</tt></pre></div></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.8
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="font-style: italic"><span style="color: #9A1900">## Error in cleanr::check_file("src/release.R"):  src/release.R: line 70 counts 92 characters.</span></span>
<span style="font-style: italic"><span style="color: #9A1900">## src/release.R: line 166 counts 85 characters.</span></span>
<span style="font-style: italic"><span style="color: #9A1900">## src/release.R: 325 lines in file.</span></span>
<span style="font-style: italic"><span style="color: #9A1900">##  src/release.R  as.object_size  found no return() statement at all.</span></span>
<span style="font-style: italic"><span style="color: #9A1900">## src/release.R  build_cran  found no return() statement at all.</span></span>
<span style="font-style: italic"><span style="color: #9A1900">## src/release.R  cran_comments  found no return() statement at all.</span></span>
<span style="font-style: italic"><span style="color: #9A1900">## src/release.R  email  found no return() statement at all.</span></span>
<span style="font-style: italic"><span style="color: #9A1900">## src/release.R  email_browser  found no return() statement at all.</span></span>
<span style="font-style: italic"><span style="color: #9A1900">## src/release.R  maintainer  found no return() statement at all.</span></span>
<span style="font-style: italic"><span style="color: #9A1900">## src/release.R  release  line 24: found width 92 max_line_width was 80</span></span>
<span style="font-style: italic"><span style="color: #9A1900">## release  found 98 lines, max_lines was 65</span></span>
<span style="font-style: italic"><span style="color: #9A1900">## release  found 97 lines of code, max_lines_of_code was 50</span></span>
<span style="font-style: italic"><span style="color: #9A1900">## release  found no return() statement at all.</span></span>
<span style="font-style: italic"><span style="color: #9A1900">## src/release.R  release_email  found no return() statement at all.</span></span>
<span style="font-style: italic"><span style="color: #9A1900">## src/release.R  submit_cran  found no return() statement at all.</span></span>
<span style="font-style: italic"><span style="color: #9A1900">## src/release.R  upload_cran  found no return() statement at all.</span></span>
<span style="font-style: italic"><span style="color: #9A1900">## src/release.R  yesno  line 1: found width 85 max_line_width was 80</span></span>
<span style="font-style: italic"><span style="color: #9A1900">## yesno  found no return() statement at all.</span></span>
</tt></pre></div></div>
</div>
</div>
<div class="sect2">
<h3 id="_funktionen_dokumentieren">3.4. Funktionen dokumentieren</h3>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.8
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="font-style: italic"><span style="color: #9A1900">#' Remove All Objects From an Environment</span></span>
<span style="font-style: italic"><span style="color: #9A1900">#'</span></span>
<span style="font-style: italic"><span style="color: #9A1900">#' @param environment The environment to be wiped.</span></span>
<span style="font-style: italic"><span style="color: #9A1900">#' @return A character vector containing the names of objects removed.</span></span>
<span style="font-style: italic"><span style="color: #9A1900">#' @export</span></span>
wipe_clean &lt;- function(environment = parent.frame()) {
    objects &lt;- ls(name = environment, all.names = TRUE)
    rm(list = objects, envir = environment)
    return(invisible(objects))
}</tt></pre></div></div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_bibliographie">4. Bibliographie</h2>
<div class="sectionbody">
<div class="ulist bibliography"><ul>
<li>
<p>
<a id="cc"></a>[cc] R.C. Martin. 2008. <em>Clean Code: A Handbook of Agile Software Craftsmanship</em>.
    Pearson Education.
</p>
</li>
<li>
<p>
<a id="cyc"></a>[cyc]  T. J. McCabe, 1976. <em>A Complexity Measure</em>
   IEEE Transactions on Software Engineering archive.
   Volume 2, Issue 4, Pages 308-320
</p>
</li>
</ul></div>
</div>
</div>
</div>
<div id="footnotes"><hr /></div>
<div id="footer">
<div id="footer-text">
Last updated
 2018-03-15 17:13:55 CET
</div>
</div>
</body>
</html>
