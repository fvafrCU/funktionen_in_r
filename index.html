<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN"
    "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">
<head>
<meta http-equiv="Content-Type" content="application/xhtml+xml; charset=UTF-8" />
<meta name="generator" content="AsciiDoc 8.6.9" />
<title>Funktionen Schreiben in <strong>R</strong></title>
<style type="text/css">
/* Shared CSS for AsciiDoc xhtml11 and html5 backends */

/* Default font. */
body {
  font-family: Georgia,serif;
}

/* Title font. */
h1, h2, h3, h4, h5, h6,
div.title, caption.title,
thead, p.table.header,
#toctitle,
#author, #revnumber, #revdate, #revremark,
#footer {
  font-family: Arial,Helvetica,sans-serif;
}

body {
  margin: 1em 5% 1em 5%;
}

a {
  color: blue;
  text-decoration: underline;
}
a:visited {
  color: fuchsia;
}

em {
  font-style: italic;
  color: navy;
}

strong {
  font-weight: bold;
  color: #083194;
}

h1, h2, h3, h4, h5, h6 {
  color: #527bbd;
  margin-top: 1.2em;
  margin-bottom: 0.5em;
  line-height: 1.3;
}

h1, h2, h3 {
  border-bottom: 2px solid silver;
}
h2 {
  padding-top: 0.5em;
}
h3 {
  float: left;
}
h3 + * {
  clear: left;
}
h5 {
  font-size: 1.0em;
}

div.sectionbody {
  margin-left: 0;
}

hr {
  border: 1px solid silver;
}

p {
  margin-top: 0.5em;
  margin-bottom: 0.5em;
}

ul, ol, li > p {
  margin-top: 0;
}
ul > li     { color: #aaa; }
ul > li > * { color: black; }

.monospaced, code, pre {
  font-family: "Courier New", Courier, monospace;
  font-size: inherit;
  color: navy;
  padding: 0;
  margin: 0;
}
pre {
  white-space: pre-wrap;
}

#author {
  color: #527bbd;
  font-weight: bold;
  font-size: 1.1em;
}
#email {
}
#revnumber, #revdate, #revremark {
}

#footer {
  font-size: small;
  border-top: 2px solid silver;
  padding-top: 0.5em;
  margin-top: 4.0em;
}
#footer-text {
  float: left;
  padding-bottom: 0.5em;
}
#footer-badges {
  float: right;
  padding-bottom: 0.5em;
}

#preamble {
  margin-top: 1.5em;
  margin-bottom: 1.5em;
}
div.imageblock, div.exampleblock, div.verseblock,
div.quoteblock, div.literalblock, div.listingblock, div.sidebarblock,
div.admonitionblock {
  margin-top: 1.0em;
  margin-bottom: 1.5em;
}
div.admonitionblock {
  margin-top: 2.0em;
  margin-bottom: 2.0em;
  margin-right: 10%;
  color: #606060;
}

div.content { /* Block element content. */
  padding: 0;
}

/* Block element titles. */
div.title, caption.title {
  color: #527bbd;
  font-weight: bold;
  text-align: left;
  margin-top: 1.0em;
  margin-bottom: 0.5em;
}
div.title + * {
  margin-top: 0;
}

td div.title:first-child {
  margin-top: 0.0em;
}
div.content div.title:first-child {
  margin-top: 0.0em;
}
div.content + div.title {
  margin-top: 0.0em;
}

div.sidebarblock > div.content {
  background: #ffffee;
  border: 1px solid #dddddd;
  border-left: 4px solid #f0f0f0;
  padding: 0.5em;
}

div.listingblock > div.content {
  border: 1px solid #dddddd;
  border-left: 5px solid #f0f0f0;
  background: #f8f8f8;
  padding: 0.5em;
}

div.quoteblock, div.verseblock {
  padding-left: 1.0em;
  margin-left: 1.0em;
  margin-right: 10%;
  border-left: 5px solid #f0f0f0;
  color: #888;
}

div.quoteblock > div.attribution {
  padding-top: 0.5em;
  text-align: right;
}

div.verseblock > pre.content {
  font-family: inherit;
  font-size: inherit;
}
div.verseblock > div.attribution {
  padding-top: 0.75em;
  text-align: left;
}
/* DEPRECATED: Pre version 8.2.7 verse style literal block. */
div.verseblock + div.attribution {
  text-align: left;
}

div.admonitionblock .icon {
  vertical-align: top;
  font-size: 1.1em;
  font-weight: bold;
  text-decoration: underline;
  color: #527bbd;
  padding-right: 0.5em;
}
div.admonitionblock td.content {
  padding-left: 0.5em;
  border-left: 3px solid #dddddd;
}

div.exampleblock > div.content {
  border-left: 3px solid #dddddd;
  padding-left: 0.5em;
}

div.imageblock div.content { padding-left: 0; }
span.image img { border-style: none; vertical-align: text-bottom; }
a.image:visited { color: white; }

dl {
  margin-top: 0.8em;
  margin-bottom: 0.8em;
}
dt {
  margin-top: 0.5em;
  margin-bottom: 0;
  font-style: normal;
  color: navy;
}
dd > *:first-child {
  margin-top: 0.1em;
}

ul, ol {
    list-style-position: outside;
}
ol.arabic {
  list-style-type: decimal;
}
ol.loweralpha {
  list-style-type: lower-alpha;
}
ol.upperalpha {
  list-style-type: upper-alpha;
}
ol.lowerroman {
  list-style-type: lower-roman;
}
ol.upperroman {
  list-style-type: upper-roman;
}

div.compact ul, div.compact ol,
div.compact p, div.compact p,
div.compact div, div.compact div {
  margin-top: 0.1em;
  margin-bottom: 0.1em;
}

tfoot {
  font-weight: bold;
}
td > div.verse {
  white-space: pre;
}

div.hdlist {
  margin-top: 0.8em;
  margin-bottom: 0.8em;
}
div.hdlist tr {
  padding-bottom: 15px;
}
dt.hdlist1.strong, td.hdlist1.strong {
  font-weight: bold;
}
td.hdlist1 {
  vertical-align: top;
  font-style: normal;
  padding-right: 0.8em;
  color: navy;
}
td.hdlist2 {
  vertical-align: top;
}
div.hdlist.compact tr {
  margin: 0;
  padding-bottom: 0;
}

.comment {
  background: yellow;
}

.footnote, .footnoteref {
  font-size: 0.8em;
}

span.footnote, span.footnoteref {
  vertical-align: super;
}

#footnotes {
  margin: 20px 0 20px 0;
  padding: 7px 0 0 0;
}

#footnotes div.footnote {
  margin: 0 0 5px 0;
}

#footnotes hr {
  border: none;
  border-top: 1px solid silver;
  height: 1px;
  text-align: left;
  margin-left: 0;
  width: 20%;
  min-width: 100px;
}

div.colist td {
  padding-right: 0.5em;
  padding-bottom: 0.3em;
  vertical-align: top;
}
div.colist td img {
  margin-top: 0.3em;
}

@media print {
  #footer-badges { display: none; }
}

#toc {
  margin-bottom: 2.5em;
}

#toctitle {
  color: #527bbd;
  font-size: 1.1em;
  font-weight: bold;
  margin-top: 1.0em;
  margin-bottom: 0.1em;
}

div.toclevel0, div.toclevel1, div.toclevel2, div.toclevel3, div.toclevel4 {
  margin-top: 0;
  margin-bottom: 0;
}
div.toclevel2 {
  margin-left: 2em;
  font-size: 0.9em;
}
div.toclevel3 {
  margin-left: 4em;
  font-size: 0.9em;
}
div.toclevel4 {
  margin-left: 6em;
  font-size: 0.9em;
}

span.aqua { color: aqua; }
span.black { color: black; }
span.blue { color: blue; }
span.fuchsia { color: fuchsia; }
span.gray { color: gray; }
span.green { color: green; }
span.lime { color: lime; }
span.maroon { color: maroon; }
span.navy { color: navy; }
span.olive { color: olive; }
span.purple { color: purple; }
span.red { color: red; }
span.silver { color: silver; }
span.teal { color: teal; }
span.white { color: white; }
span.yellow { color: yellow; }

span.aqua-background { background: aqua; }
span.black-background { background: black; }
span.blue-background { background: blue; }
span.fuchsia-background { background: fuchsia; }
span.gray-background { background: gray; }
span.green-background { background: green; }
span.lime-background { background: lime; }
span.maroon-background { background: maroon; }
span.navy-background { background: navy; }
span.olive-background { background: olive; }
span.purple-background { background: purple; }
span.red-background { background: red; }
span.silver-background { background: silver; }
span.teal-background { background: teal; }
span.white-background { background: white; }
span.yellow-background { background: yellow; }

span.big { font-size: 2em; }
span.small { font-size: 0.6em; }

span.underline { text-decoration: underline; }
span.overline { text-decoration: overline; }
span.line-through { text-decoration: line-through; }

div.unbreakable { page-break-inside: avoid; }


/*
 * xhtml11 specific
 *
 * */

div.tableblock {
  margin-top: 1.0em;
  margin-bottom: 1.5em;
}
div.tableblock > table {
  border: 3px solid #527bbd;
}
thead, p.table.header {
  font-weight: bold;
  color: #527bbd;
}
p.table {
  margin-top: 0;
}
/* Because the table frame attribute is overriden by CSS in most browsers. */
div.tableblock > table[frame="void"] {
  border-style: none;
}
div.tableblock > table[frame="hsides"] {
  border-left-style: none;
  border-right-style: none;
}
div.tableblock > table[frame="vsides"] {
  border-top-style: none;
  border-bottom-style: none;
}


/*
 * html5 specific
 *
 * */

table.tableblock {
  margin-top: 1.0em;
  margin-bottom: 1.5em;
}
thead, p.tableblock.header {
  font-weight: bold;
  color: #527bbd;
}
p.tableblock {
  margin-top: 0;
}
table.tableblock {
  border-width: 3px;
  border-spacing: 0px;
  border-style: solid;
  border-color: #527bbd;
  border-collapse: collapse;
}
th.tableblock, td.tableblock {
  border-width: 1px;
  padding: 4px;
  border-style: solid;
  border-color: #527bbd;
}

table.tableblock.frame-topbot {
  border-left-style: hidden;
  border-right-style: hidden;
}
table.tableblock.frame-sides {
  border-top-style: hidden;
  border-bottom-style: hidden;
}
table.tableblock.frame-none {
  border-style: hidden;
}

th.tableblock.halign-left, td.tableblock.halign-left {
  text-align: left;
}
th.tableblock.halign-center, td.tableblock.halign-center {
  text-align: center;
}
th.tableblock.halign-right, td.tableblock.halign-right {
  text-align: right;
}

th.tableblock.valign-top, td.tableblock.valign-top {
  vertical-align: top;
}
th.tableblock.valign-middle, td.tableblock.valign-middle {
  vertical-align: middle;
}
th.tableblock.valign-bottom, td.tableblock.valign-bottom {
  vertical-align: bottom;
}


/*
 * manpage specific
 *
 * */

body.manpage h1 {
  padding-top: 0.5em;
  padding-bottom: 0.5em;
  border-top: 2px solid silver;
  border-bottom: 2px solid silver;
}
body.manpage h2 {
  border-style: none;
}
body.manpage div.sectionbody {
  margin-left: 3em;
}

@media print {
  body.manpage div#toc { display: none; }
}


@media screen {
  body {
    max-width: 50em; /* approximately 80 characters wide */
    margin-left: 16em;
  }

  #toc {
    position: fixed;
    top: 0;
    left: 0;
    bottom: 0;
    width: 13em;
    padding: 0.5em;
    padding-bottom: 1.5em;
    margin: 0;
    overflow: auto;
    border-right: 3px solid #f8f8f8;
    background-color: white;
  }

  #toc .toclevel1 {
    margin-top: 0.5em;
  }

  #toc .toclevel2 {
    margin-top: 0.25em;
    display: list-item;
    color: #aaaaaa;
  }

  #toctitle {
    margin-top: 0.5em;
  }
}
</style>
<script type="text/javascript">
/*<![CDATA[*/
var asciidoc = {  // Namespace.

/////////////////////////////////////////////////////////////////////
// Table Of Contents generator
/////////////////////////////////////////////////////////////////////

/* Author: Mihai Bazon, September 2002
 * http://students.infoiasi.ro/~mishoo
 *
 * Table Of Content generator
 * Version: 0.4
 *
 * Feel free to use this script under the terms of the GNU General Public
 * License, as long as you do not remove or alter this notice.
 */

 /* modified by Troy D. Hanson, September 2006. License: GPL */
 /* modified by Stuart Rackham, 2006, 2009. License: GPL */

// toclevels = 1..4.
toc: function (toclevels) {

  function getText(el) {
    var text = "";
    for (var i = el.firstChild; i != null; i = i.nextSibling) {
      if (i.nodeType == 3 /* Node.TEXT_NODE */) // IE doesn't speak constants.
        text += i.data;
      else if (i.firstChild != null)
        text += getText(i);
    }
    return text;
  }

  function TocEntry(el, text, toclevel) {
    this.element = el;
    this.text = text;
    this.toclevel = toclevel;
  }

  function tocEntries(el, toclevels) {
    var result = new Array;
    var re = new RegExp('[hH]([1-'+(toclevels+1)+'])');
    // Function that scans the DOM tree for header elements (the DOM2
    // nodeIterator API would be a better technique but not supported by all
    // browsers).
    var iterate = function (el) {
      for (var i = el.firstChild; i != null; i = i.nextSibling) {
        if (i.nodeType == 1 /* Node.ELEMENT_NODE */) {
          var mo = re.exec(i.tagName);
          if (mo && (i.getAttribute("class") || i.getAttribute("className")) != "float") {
            result[result.length] = new TocEntry(i, getText(i), mo[1]-1);
          }
          iterate(i);
        }
      }
    }
    iterate(el);
    return result;
  }

  var toc = document.getElementById("toc");
  if (!toc) {
    return;
  }

  // Delete existing TOC entries in case we're reloading the TOC.
  var tocEntriesToRemove = [];
  var i;
  for (i = 0; i < toc.childNodes.length; i++) {
    var entry = toc.childNodes[i];
    if (entry.nodeName.toLowerCase() == 'div'
     && entry.getAttribute("class")
     && entry.getAttribute("class").match(/^toclevel/))
      tocEntriesToRemove.push(entry);
  }
  for (i = 0; i < tocEntriesToRemove.length; i++) {
    toc.removeChild(tocEntriesToRemove[i]);
  }

  // Rebuild TOC entries.
  var entries = tocEntries(document.getElementById("content"), toclevels);
  for (var i = 0; i < entries.length; ++i) {
    var entry = entries[i];
    if (entry.element.id == "")
      entry.element.id = "_toc_" + i;
    var a = document.createElement("a");
    a.href = "#" + entry.element.id;
    a.appendChild(document.createTextNode(entry.text));
    var div = document.createElement("div");
    div.appendChild(a);
    div.className = "toclevel" + entry.toclevel;
    toc.appendChild(div);
  }
  if (entries.length == 0)
    toc.parentNode.removeChild(toc);
},


/////////////////////////////////////////////////////////////////////
// Footnotes generator
/////////////////////////////////////////////////////////////////////

/* Based on footnote generation code from:
 * http://www.brandspankingnew.net/archive/2005/07/format_footnote.html
 */

footnotes: function () {
  // Delete existing footnote entries in case we're reloading the footnodes.
  var i;
  var noteholder = document.getElementById("footnotes");
  if (!noteholder) {
    return;
  }
  var entriesToRemove = [];
  for (i = 0; i < noteholder.childNodes.length; i++) {
    var entry = noteholder.childNodes[i];
    if (entry.nodeName.toLowerCase() == 'div' && entry.getAttribute("class") == "footnote")
      entriesToRemove.push(entry);
  }
  for (i = 0; i < entriesToRemove.length; i++) {
    noteholder.removeChild(entriesToRemove[i]);
  }

  // Rebuild footnote entries.
  var cont = document.getElementById("content");
  var spans = cont.getElementsByTagName("span");
  var refs = {};
  var n = 0;
  for (i=0; i<spans.length; i++) {
    if (spans[i].className == "footnote") {
      n++;
      var note = spans[i].getAttribute("data-note");
      if (!note) {
        // Use [\s\S] in place of . so multi-line matches work.
        // Because JavaScript has no s (dotall) regex flag.
        note = spans[i].innerHTML.match(/\s*\[([\s\S]*)]\s*/)[1];
        spans[i].innerHTML =
          "[<a id='_footnoteref_" + n + "' href='#_footnote_" + n +
          "' title='View footnote' class='footnote'>" + n + "</a>]";
        spans[i].setAttribute("data-note", note);
      }
      noteholder.innerHTML +=
        "<div class='footnote' id='_footnote_" + n + "'>" +
        "<a href='#_footnoteref_" + n + "' title='Return to text'>" +
        n + "</a>. " + note + "</div>";
      var id =spans[i].getAttribute("id");
      if (id != null) refs["#"+id] = n;
    }
  }
  if (n == 0)
    noteholder.parentNode.removeChild(noteholder);
  else {
    // Process footnoterefs.
    for (i=0; i<spans.length; i++) {
      if (spans[i].className == "footnoteref") {
        var href = spans[i].getElementsByTagName("a")[0].getAttribute("href");
        href = href.match(/#.*/)[0];  // Because IE return full URL.
        n = refs[href];
        spans[i].innerHTML =
          "[<a href='#_footnote_" + n +
          "' title='View footnote' class='footnote'>" + n + "</a>]";
      }
    }
  }
},

install: function(toclevels) {
  var timerId;

  function reinstall() {
    asciidoc.footnotes();
    if (toclevels) {
      asciidoc.toc(toclevels);
    }
  }

  function reinstallAndRemoveTimer() {
    clearInterval(timerId);
    reinstall();
  }

  timerId = setInterval(reinstall, 500);
  if (document.addEventListener)
    document.addEventListener("DOMContentLoaded", reinstallAndRemoveTimer, false);
  else
    window.onload = reinstallAndRemoveTimer;
}

}
asciidoc.install(5);
/*]]>*/
</script>
</head>
<body class="article">
<div id="header">
<h1>Funktionen Schreiben in <strong>R</strong></h1>
<span id="author">Anne-Sophie Stelzer, Dominik Cullmann</span><br />
<div id="toc">
  <div id="toctitle">Table of Contents</div>
  <noscript><p><b>JavaScript must be enabled in your browser to display the table of contents.</b></p></noscript>
</div>
</div>
<div id="content">
<div class="sect1">
<h2 id="_worum_geht_es">1. Worum geht es?</h2>
<div class="sectionbody">
<div class="paragraph"><p>Naja, ums Schreiben von Funktionen in der Programmiersprache <strong>R</strong>.</p></div>
<div class="sect2">
<h3 id="_was_sind_funktionen">1.1. Was sind Funktionen?</h3>
<div class="ulist"><ul>
<li>
<p>
Funktionen sind Programmkonstrukte, mit denen Du Teile des von Dir
  geschriebenen Codes wiederverwenden kannst
  (siehe <a href="https://de.wikipedia.org/wiki/Funktion_(Programmierung)">Wikipedia</a>).
</p>
</li>
<li>
<p>
Funktionen sind in den Standardbibliotheken jeder Programmiersprache vorhanden,
  viele <strong>R</strong>-Funktionen kennst Du wahrscheinlich schon: <code>sum()</code>, <code>mean()</code>
  oder <code>summary()</code>.
</p>
</li>
</ul></div>
</div>
<div class="sect2">
<h3 id="_warum_funktionen">1.2. Warum Funktionen?</h3>
<div class="ulist"><ul>
<li>
<p>
Damit Du Teile des von Dir geschriebenen Codes wiederverwenden kannst.
</p>
</li>
<li>
<p>
Damit Du, wenn Du Fehler im Code entdeckst, diese auch nur an einer
  Stelle korrigieren musst.
</p>
</li>
</ul></div>
</div>
<div class="sect2">
<h3 id="_wann_funktionen">1.3. Wann Funktionen?</h3>
<div class="paragraph"><p>Immer wenn Du merkst, dass Du (alten) Code mehrfach kopierst und an anderer
Stelle einfügst ohne ihn stark zu verändern, solltest Du darüber nachdenken,
eine (oder mehrere) Funktion(en)  aus ihm  zu machen.</p></div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_eine_funktion_schreiben">2. Eine Funktion schreiben</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_eine_neue_summenfunktion">2.1. Eine neue Summenfunktion</h3>
<div class="paragraph"><div class="title">Warum wir diese Funktion nicht schreiben sollten</div><p>Eine Summenfunktion gibt es wahrscheinlich in jeder Programmiersprache, in <strong>R</strong>
heißt sie <code>sum()</code>. Diese Funktion ist besser, stabiler und schneller, als
alles, das wir selbst programmieren können.</p></div>
<div class="paragraph"><div class="title">Warum wir es trotzdem tun</div><p>Nunja, irgendwelchen Code müssen wir ja nehmen.
Ich habe die Summenberechnung ausführlich als Beispiel zur Schleifenprogrammierung in
<a href="https://fvafrcu.github.io/programmieren_in_r/#gute-schleifen">Programmieren in R</a> benutzt,
    und eine Wiederholung schadet sicher nicht.</p></div>
<div class="sect3">
<h4 id="_vom_code_8230">2.1.1. Vom Code &#8230;</h4>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.7
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt>a  <span style="color: #990000">&lt;-</span> c<span style="color: #990000">(</span><span style="color: #993399">2</span><span style="color: #990000">,</span> <span style="color: #993399">3</span><span style="color: #990000">,</span> <span style="color: #993399">4</span><span style="color: #990000">,</span> <span style="color: #993399">10</span><span style="color: #990000">)</span> # <span style="color: #990000">&lt;</span><span style="color: #993399">1</span><span style="color: #990000">&gt;</span>
value <span style="color: #990000">&lt;-</span> <span style="color: #993399">0</span> # <span style="color: #990000">&lt;</span><span style="color: #993399">2</span><span style="color: #990000">&gt;</span>
for <span style="color: #990000">(</span>a_i <span style="font-weight: bold"><span style="color: #0000FF">in</span></span> a<span style="color: #990000">)</span> { # <span style="color: #990000">&lt;</span><span style="color: #993399">3</span><span style="color: #990000">&gt;</span>
    value <span style="color: #990000">&lt;-</span> value <span style="color: #990000">+</span> a_i  # <span style="color: #990000">&lt;</span><span style="color: #993399">4</span><span style="color: #990000">&gt;</span>
}
print<span style="color: #990000">(</span>value<span style="color: #990000">)</span> # <span style="color: #990000">&lt;</span><span style="color: #993399">5</span><span style="color: #990000">&gt;</span></tt></pre></div></div>
<div class="listingblock">
<div class="content">
<pre><code>## [1] 19</code></pre>
</div></div>
<div class="paragraph"><p>Dabei siehst Du:</p></div>
<div class="colist arabic"><ol>
<li>
<p>
Definition des zu summierenden Vektors
</p>
</li>
<li>
<p>
Definition des zur Addition neutralen Elementes
</p>
</li>
<li>
<p>
Schleife über die Elemente des Vektors
</p>
</li>
<li>
<p>
Addition des aktuellen Vektorelementes zum Ergebnis
</p>
</li>
<li>
<p>
Ausgabe des Ergebnisses
</p>
</li>
</ol></div>
</div>
<div class="sect3">
<h4 id="_8230_zur_funktion">2.1.2. &#8230; zur Funktion</h4>
<div class="paragraph"><p>Für meine Summenfunktion will die Definition des zu summierenden Vektors
der Anwenderin überlassen (alles andere wäre auch sehr seltsam, wer braucht eine Funktion,
                            die immer die Summe von 19 berechnet?),
daher wird der Vektor zu einem Argument der Funktion.
Ich wähle als Namen für das Argument jetzt <code>x</code> (das könnte aber
auch <code>a</code> bleiben, das ist eine Frage der Konvention, und unter <code>x</code> verstehen wir
meist eine Unbekannte). Und als Ausgabe verwende ich keine Druck- sondern eine
Rückgabefunktion (<code>return()</code> statt <code>print()</code>).
Das Ergebnis sieht dann so aus:</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.7
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt>my_sum <span style="color: #990000">&lt;-</span> function<span style="color: #990000">(</span>x<span style="color: #990000">)</span> {
    value <span style="color: #990000">&lt;-</span> <span style="color: #993399">0</span>
    for <span style="color: #990000">(</span>x_i <span style="font-weight: bold"><span style="color: #0000FF">in</span></span> x<span style="color: #990000">)</span> {
        value <span style="color: #990000">&lt;-</span> value <span style="color: #990000">+</span> x_i
    }
    return<span style="color: #990000">(</span>value<span style="color: #990000">)</span>
}</tt></pre></div></div>
<div class="paragraph"><p>Dabei habe ich mehrere Dinge getan, beispielsweise einen ziemlich miesen Namen für meine Funktion gewählt.
Im Wesentlichen aber habe ich:</p></div>
<div class="ulist"><ul>
<li>
<p>
entschieden, welchen Code die Funktion <a href="#_scoping">enthält</a>,
</p>
</li>
<li>
<p>
welche Zuweisung zu einem <a href="#_argumente">Funktionsargument</a> wird und
</p>
</li>
<li>
<p>
was die Funktion <a href="#_return_value_und_side_effects">zurückgibt</a>.
</p>
</li>
</ul></div>
</div>
</div>
<div class="sect2">
<h3 id="_scoping">2.2. Scoping</h3>
<div class="paragraph"><p>Programmiersprachen kennen für Objekte unterschiedliche Gültigkeitsbereiche
(englisch "scope"), wir sehen uns das am Beispiel an:</p></div>
<div class="sect3">
<h4 id="_schreibzugriffe">2.2.1. Schreibzugriffe</h4>
<div class="paragraph"><div class="title">Ausgangszustand</div><p>Im Augenblick hat das Objekte <code>value</code> den Wert 19:</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.7
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt>print<span style="color: #990000">(</span>value<span style="color: #990000">)</span></tt></pre></div></div>
<div class="listingblock">
<div class="content">
<pre><code>## [1] 19</code></pre>
</div></div>
<div class="paragraph"><div class="title">Funktionsausführung</div><p>Jetzt wenden wir unsere Summenfunktion an und berechnen die Summe eines anderen Vektors:</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.7
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt>print<span style="color: #990000">(</span>my_sum<span style="color: #990000">(</span><span style="color: #993399">1</span><span style="color: #990000">:</span><span style="color: #993399">3</span><span style="color: #990000">))</span></tt></pre></div></div>
<div class="listingblock">
<div class="content">
<pre><code>## [1] 6</code></pre>
</div></div>
<div class="paragraph"><p>Das Objekt <code>value</code> behält seinen Wert:</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.7
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt>print<span style="color: #990000">(</span>value<span style="color: #990000">)</span></tt></pre></div></div>
<div class="listingblock">
<div class="content">
<pre><code>## [1] 19</code></pre>
</div></div>
<div class="paragraph"><p>Und das, obwohl wir innerhalb der Funktion dem Objekt <code>value</code> in der ersten
Zeile den Wert 0 zuweisen und diesen dann in der Schleife mit den Werten 1, 3
und 6 überschreiben:
<strong>R</strong> verwaltet automatisch die Gültigkeitsbereiche aller Objekte.
Es gibt daher ein Objekt names  <code>value</code> außerhalb der Funktion, das den Wert 19 enthält und unverändert bleibt.
Innerhalb der Funktion legt <strong>R</strong> ein neues lokales Objekt, ebenfalls mit dem Namen
<code>value</code>, an.
Du <em>kannst</em> auch aus einer Funktion in einen <a href="#_arbeiten_mit_gültigkeitsbereichen">anderen Gültigkeitsbereich</a> schreiben, wenn Du das wirklich willst.</p></div>
</div>
<div class="sect3">
<h4 id="_lesezugriffe">2.2.2. Lesezugriffe</h4>
<div class="paragraph"><div class="title">Lesen ist unsicher</div><p>Mit dem Namen eines Objektes wird dieses gelesen. Innerhalb einer Funktion sucht
<strong>R</strong> zunächst nach einem lokalen Objekt des gesuchten Namens, dann in den der
Funktion übergeordneten Gültigkeitsbereichen, also außerhalb der Funktion.</p></div>
<div class="paragraph"><p>Das kann zu unerwünschten Nebeneffekten führen. Stell Dir vor, Du kommentierst
beim Schreiben der Summenfunktion die Definition des zur Addition neutralen
Elementes aus Versehen aus:</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.7
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt>my_sum_broken <span style="color: #990000">&lt;-</span> function<span style="color: #990000">(</span>x<span style="color: #990000">)</span> {
    # FIXME<span style="color: #990000">:</span> <span style="font-weight: bold"><span style="color: #0000FF">this</span></span> is accidentally commented <span style="font-weight: bold"><span style="color: #0000FF">out</span></span><span style="color: #990000">:</span>
    # value <span style="color: #990000">&lt;-</span> <span style="color: #993399">0</span>
    for <span style="color: #990000">(</span>x_i <span style="font-weight: bold"><span style="color: #0000FF">in</span></span> x<span style="color: #990000">)</span> {
        value <span style="color: #990000">&lt;-</span> value <span style="color: #990000">+</span> x_i
    }
    return<span style="color: #990000">(</span>value<span style="color: #990000">)</span>
}</tt></pre></div></div>
<div class="paragraph"><p>Du führst die Funktion aus und erhältst:</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.7
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt>print<span style="color: #990000">(</span>my_sum_broken<span style="color: #990000">(</span><span style="color: #993399">1</span><span style="color: #990000">:</span><span style="color: #993399">3</span><span style="color: #990000">))</span></tt></pre></div></div>
<div class="listingblock">
<div class="content">
<pre><code>## [1] 25</code></pre>
</div></div>
<div class="paragraph"><p>Was ist passiert?
Im ersten Durchlauf der Schleife gibt es beim Lesen von
<code>value</code> noch kein lokales Objekt dieses Namens. Daher sucht <strong>R</strong> außerhalb der
Funktion und findet ein Objekt mit dem Wert 19.
Zu diesem Objekt addieren
wir <code>x_i</code>, das im ersten Schleifendurchlauf den Wert <code>1</code> enthält und erschaffen
damit in der Funktion ein lokales Objekt names <code>value</code>, das dann im zweiten
Durchlauf der Schleife auch gelesen werden kann.</p></div>
<div class="paragraph"><p>Wenn Du diese Funktion verwendest, ohne vorher das Objekt <code>value</code> zu definieren,
oder das Objekt <code>value</code> entfernst und dann die Funktion ausführst</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.7
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt>rm<span style="color: #990000">(</span>value<span style="color: #990000">)</span>
print<span style="color: #990000">(</span>my_sum_broken<span style="color: #990000">(</span><span style="color: #993399">1</span><span style="color: #990000">:</span><span style="color: #993399">3</span><span style="color: #990000">))</span></tt></pre></div></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.7
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt>## Error <span style="font-weight: bold"><span style="color: #0000FF">in</span></span> my_sum_broken<span style="color: #990000">(</span><span style="color: #993399">1</span><span style="color: #990000">:</span><span style="color: #993399">3</span><span style="color: #990000">):</span> object <span style="color: #FF0000">'value'</span> <span style="font-weight: bold"><span style="color: #0000FF">not</span></span> found
</tt></pre></div></div>
<div class="paragraph"><p>erhälst Du einen Fehler, weil <strong>R</strong> auch außerhalb der Funktion kein Objekt
names <code>value</code> finden kann. Und diesen Fehler erwarten wir ja eigentlich, wenn
wir nur die Funktion betrachten: sie ist fehlerhaft.</p></div>
<div class="paragraph"><div class="title">Sicherer Lesen</div><p>Wie wir eine Funktion dazu bringen können, außerhalb ihres Gültigkeitsbereiches
zu schreiben (nein, das <em>wie</em> habe ich Dir noch nicht gezeigt), so können wir
eine Funktion auch zwingen, beim Lesen nur nach lokalen Objekten zu
suchen:</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.7
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt>my_sum_safer <span style="color: #990000">&lt;-</span> function<span style="color: #990000">(</span>x<span style="color: #990000">)</span> {
    for <span style="color: #990000">(</span>x_i <span style="font-weight: bold"><span style="color: #0000FF">in</span></span> x<span style="color: #990000">)</span> {
        value <span style="color: #990000">&lt;-</span> get<span style="color: #990000">(</span><span style="color: #FF0000">"value"</span><span style="color: #990000">,</span> inherits <span style="color: #990000">=</span> FALSE<span style="color: #990000">)</span> <span style="color: #990000">+</span> x_i
    }
    return<span style="color: #990000">(</span>value<span style="color: #990000">)</span>
}</tt></pre></div></div>
<div class="paragraph"><p>Selbst wenn wir ein Objekt namens <code>value</code> anlegen, gibt die Funktion nun einen
Fehler aus:</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.7
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt>value <span style="color: #990000">&lt;-</span> <span style="color: #993399">42</span>
my_sum_safer<span style="color: #990000">(</span><span style="color: #993399">1</span><span style="color: #990000">:</span><span style="color: #993399">10</span><span style="color: #990000">)</span></tt></pre></div></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.7
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt>## Error <span style="font-weight: bold"><span style="color: #0000FF">in</span></span> get<span style="color: #990000">(</span><span style="color: #FF0000">"value"</span><span style="color: #990000">,</span> inherits <span style="color: #990000">=</span> FALSE<span style="color: #990000">):</span> object <span style="color: #FF0000">'value'</span> <span style="font-weight: bold"><span style="color: #0000FF">not</span></span> found
</tt></pre></div></div>
<div class="paragraph"><p>Ich finde es aber praktikabler, beim Schreiben einer Funktion darauf zu achten,
welche Objekte ich lese.<br />
Und wenn Du Funktionen <a href="#_funktionen_testen">testest</a>, findest Du Fehler, die auf Scoping beruhen,
sehr schnell.</p></div>
</div>
<div class="sect3">
<h4 id="_arbeiten_mit_gültigkeitsbereichen">2.2.3. Arbeiten mit Gültigkeitsbereichen</h4>
<div class="paragraph"><p>Ein Befehl, mit dem Du alle Objekte Deines aktuellen Arbeitsbereiches löschen
kannst (entsprechend dem RStudio-Knopf mit dem Besensymbol <span class="footnote"><br />[Im <a href="https://github.com/rstudio/rstudio/releases/tag/v1.1.426">Code von RStudio v1.1.426</a> findet sich die Funktion hinter dem Knopf  in der Datei src/cpp/session/modules/SessionEnvironment.R, sie besteht im wesentlichen aus der Zeile<br />
rm(list=ls(envir=env, all.names=includeHidden), envir=env)<br />
Sie wird in src/cpp/session/modules/environment/SessionEnvironment.cpp in der C++-Funktion  removeAllObjects aufgerufen.
]<br /></span>), lautet:</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.7
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt>rm<span style="color: #990000">(</span>list <span style="color: #990000">=</span> ls<span style="color: #990000">(</span>all<span style="color: #990000">.</span>names <span style="color: #990000">=</span> TRUE<span style="color: #990000">))</span></tt></pre></div></div>
<div class="paragraph"><p>Nun  bin ich
vergesslich, weshalb ich mir die Syntax schlecht merken kann und lieber eine
Funktion (aber keinen Knopf) hätte.
Da "der aktuelle Arbeitsbereich" ein Gültigkeitsbereich
(in <strong>R</strong> heißen die Gültigkeitsbereiche "environments", in <strong>S</strong> hießen sie "frames") ist und die
Funktionen  <code>ls</code> und <code>rm</code> nur in <em>einem</em> Gültigkeitsbereich arbeiten, funktioniert das naheliegende</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.7
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt>wipe_clean <span style="color: #990000">&lt;-</span> function<span style="color: #990000">()</span> {
    rm<span style="color: #990000">(</span>list <span style="color: #990000">=</span> ls<span style="color: #990000">(</span>all<span style="color: #990000">.</span>names <span style="color: #990000">=</span> TRUE<span style="color: #990000">))</span>
}</tt></pre></div></div>
<div class="paragraph"><p><strong>nicht</strong>.</p></div>
<div class="paragraph"><p>Wenn ich den Gültigkeitsbereich explizit</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.7
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt>wipe_clean <span style="color: #990000">&lt;-</span> function<span style="color: #990000">()</span> {
    rm<span style="color: #990000">(</span>list <span style="color: #990000">=</span> ls<span style="color: #990000">(</span><span style="font-weight: bold"><span style="color: #0000FF">name</span></span> <span style="color: #990000">=</span> parent<span style="color: #990000">.</span>frame<span style="color: #990000">(),</span> all<span style="color: #990000">.</span>names <span style="color: #990000">=</span> TRUE<span style="color: #990000">),</span> envir <span style="color: #990000">=</span> parent<span style="color: #990000">.</span>frame<span style="color: #990000">())</span>
}</tt></pre></div></div>
<div class="paragraph"><p>angebe, tut die Funktion, was ich wollte:</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.7
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt>ls<span style="color: #990000">()</span></tt></pre></div></div>
<div class="listingblock">
<div class="content">
<pre><code>## [1] "a"             "a_i"           "my_sum"        "my_sum_broken"
## [5] "my_sum_safer"  "value"         "wipe_clean"</code></pre>
</div></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.7
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt>wipe_clean<span style="color: #990000">()</span>
ls<span style="color: #990000">()</span></tt></pre></div></div>
<div class="listingblock">
<div class="content">
<pre><code>## character(0)</code></pre>
</div></div>
</div>
</div>
<div class="sect2">
<h3 id="_argumente">2.3. Argumente</h3>
<div class="paragraph"><p>Funktionen kennen Argumente, am besten nicht zu viele (siehe zum Beispiel <a href="#cc">[cc]</a>).
Unsere Summenfunktion kennt beispielsweise eines, nämlich den Vektor, den sie summieren soll. Der ist also ein obligatorisches Element, er sollte keine Voreinstellung haben (und hat auch keine).</p></div>
<div class="paragraph"><p>Eine Funktion, die, wie <code>wipe_clean</code>, kein Argument kennt, ist Folgende:</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.7
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt>memory_hogs <span style="color: #990000">&lt;-</span> function<span style="color: #990000">()</span> {
    z <span style="color: #990000">&lt;-</span> sapply<span style="color: #990000">(</span>ls<span style="color: #990000">(</span>envir <span style="color: #990000">=</span> parent<span style="color: #990000">.</span>frame<span style="color: #990000">()),</span>
                function<span style="color: #990000">(</span>x<span style="color: #990000">)</span> object<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #0000FF">size</span></span><span style="color: #990000">(</span>get<span style="color: #990000">(</span>x<span style="color: #990000">,</span> envir <span style="color: #990000">=</span> parent<span style="color: #990000">.</span>frame<span style="color: #990000">())))</span>
    return<span style="color: #990000">(</span>z<span style="color: #990000">)</span>
}</tt></pre></div></div>
<div class="paragraph"><p>Diese Funktion gibt mir für jedes Objekt des Gültigkeitsbereiches, in dem ich sie aufrufe, den Speicherverbrauch aus.</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.7
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt>va <span style="color: #990000">&lt;-</span> <span style="font-weight: bold"><span style="color: #0000FF">rep</span></span><span style="color: #990000">(</span>mtcars<span style="color: #990000">,</span> <span style="color: #993399">1</span><span style="color: #990000">)</span>
vb <span style="color: #990000">&lt;-</span> <span style="font-weight: bold"><span style="color: #0000FF">rep</span></span><span style="color: #990000">(</span>mtcars<span style="color: #990000">,</span> <span style="color: #993399">1000</span><span style="color: #990000">)</span>
vc <span style="color: #990000">&lt;-</span> <span style="font-weight: bold"><span style="color: #0000FF">rep</span></span><span style="color: #990000">(</span>mtcars<span style="color: #990000">,</span> <span style="color: #993399">2000</span><span style="color: #990000">)</span>
vd <span style="color: #990000">&lt;-</span> <span style="font-weight: bold"><span style="color: #0000FF">rep</span></span><span style="color: #990000">(</span>mtcars<span style="color: #990000">,</span> <span style="color: #993399">100</span><span style="color: #990000">)</span>
memory_hogs<span style="color: #990000">()</span></tt></pre></div></div>
<div class="listingblock">
<div class="content">
<pre><code>## memory_hogs          va          vb          vc          vd
##        7896        4424     3520824     7040824      352824</code></pre>
</div></div>
<div class="paragraph"><p>Bei so wenigen Objekten erkenne ich leicht, dass <code>vc</code> der größte Speicherfresser ist und ich, falls mir der Speicher platzt und ich <code>vc</code> nicht mehr unbedingt brauche, <code>vc</code> löschen sollte.</p></div>
<div class="paragraph"><p>Aber wenn ich viele Objekte habe, wäre es doch schön, ein optionales Funktionsargument zu haben, das in seiner Voreinstellung die Ausgabe nach Größe des Speicherbedarfs sortiert:</p></div>
<div class="listingblock">
<div class="title">Ein Steuerargument</div>
<div class="content"><!-- Generator: GNU source-highlight 3.1.7
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt>memory_hogs <span style="color: #990000">&lt;-</span> function<span style="color: #990000">(</span>order <span style="color: #990000">=</span> TRUE<span style="color: #990000">)</span> {
    z <span style="color: #990000">&lt;-</span> sapply<span style="color: #990000">(</span>ls<span style="color: #990000">(</span>envir <span style="color: #990000">=</span> parent<span style="color: #990000">.</span>frame<span style="color: #990000">()),</span>
                function<span style="color: #990000">(</span>x<span style="color: #990000">)</span> object<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #0000FF">size</span></span><span style="color: #990000">(</span>get<span style="color: #990000">(</span>x<span style="color: #990000">,</span> envir <span style="color: #990000">=</span> parent<span style="color: #990000">.</span>frame<span style="color: #990000">())))</span>
    if <span style="color: #990000">(</span>isTRUE<span style="color: #990000">(</span>order<span style="color: #990000">))</span> z <span style="color: #990000">&lt;-</span> z<span style="color: #990000">[</span>order<span style="color: #990000">(</span>z<span style="color: #990000">)]</span>
    return<span style="color: #990000">(</span>z<span style="color: #990000">)</span>
}</tt></pre></div></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.7
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt>memory_hogs<span style="color: #990000">()</span></tt></pre></div></div>
<div class="listingblock">
<div class="content">
<pre><code>##          va memory_hogs          vd          vb          vc
##        4424       10120      352824     3520824     7040824</code></pre>
</div></div>
<div class="paragraph"><p>Das ist ein klassisches (optionales) Steuerargument, das das Verhalten einer Funktion steuert.
Steuerargumente sollten eine sinnvolle Voreinstellung haben.</p></div>
<div class="paragraph"><p>Da die <code>memory_hogs</code> intern nun die Funktion <code>order</code> aufruft, könnten wir ja auf die Idee kommen, dieser Funktion Argumente weiterreichen zu wollen.
Das können wir entweder explizit tun, oder wir benutzen ein spezielles, <em>Ellipsis</em> genanntes Argument, das durch drei Punkte (<code>...</code>) aufgerufen wird:</p></div>
<div class="listingblock">
<div class="title">Ellipsis I</div>
<div class="content"><!-- Generator: GNU source-highlight 3.1.7
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt>memory_hogs <span style="color: #990000">&lt;-</span> function<span style="color: #990000">(...)</span> {
    z <span style="color: #990000">&lt;-</span> sapply<span style="color: #990000">(</span>ls<span style="color: #990000">(</span>envir <span style="color: #990000">=</span> parent<span style="color: #990000">.</span>frame<span style="color: #990000">()),</span>
                function<span style="color: #990000">(</span>x<span style="color: #990000">)</span> object<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #0000FF">size</span></span><span style="color: #990000">(</span>get<span style="color: #990000">(</span>x<span style="color: #990000">,</span> envir <span style="color: #990000">=</span> parent<span style="color: #990000">.</span>frame<span style="color: #990000">())))</span>
    if <span style="color: #990000">(!</span> missing<span style="color: #990000">(...))</span> {
      z <span style="color: #990000">&lt;-</span> z<span style="color: #990000">[</span>order<span style="color: #990000">(</span>z<span style="color: #990000">,</span> <span style="color: #990000">...)]</span>
    }
    return<span style="color: #990000">(</span>z<span style="color: #990000">)</span>
}</tt></pre></div></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.7
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt>memory_hogs<span style="color: #990000">()</span></tt></pre></div></div>
<div class="listingblock">
<div class="content">
<pre><code>## memory_hogs          va          vb          vc          vd
##       13624        4424     3520824     7040824      352824</code></pre>
</div></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.7
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt>memory_hogs<span style="color: #990000">(</span>decreasing <span style="color: #990000">=</span> TRUE<span style="color: #990000">)</span></tt></pre></div></div>
<div class="listingblock">
<div class="content">
<pre><code>##          vc          vb          vd memory_hogs          va
##     7040824     3520824      352824       50120        4424</code></pre>
</div></div>
<div class="paragraph"><p>Jetzt können wir die Rückgabe unserer Funktion nutzen, um die beiden größten Speicherfresser zu löschen:</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.7
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt>rm<span style="color: #990000">(</span>list <span style="color: #990000">=</span> names<span style="color: #990000">(</span>memory_hogs<span style="color: #990000">(</span>decreasing <span style="color: #990000">=</span> TRUE<span style="color: #990000">)[</span><span style="color: #993399">1</span><span style="color: #990000">:</span><span style="color: #993399">2</span><span style="color: #990000">]))</span>
memory_hogs<span style="color: #990000">()</span></tt></pre></div></div>
<div class="listingblock">
<div class="content">
<pre><code>## memory_hogs          va          vd
##       50120        4424      352824</code></pre>
</div></div>
<div class="paragraph"><p>Wir können also, wenn wir wollen, drei Arten von Argumenten unterscheiden:</p></div>
<div class="ulist"><ul>
<li>
<p>
Obligatorische. Sie kennen keine Voreinstellungen und übergeben üblicherweise Objekte, die von der Funktion verarbeitet werden sollen. Der zu summierende Vektor <code>x</code> in <code>my_sum</code> ist ein klassisches Beispiel: ein Voreinstellung für die zu summiernden Zahlen (etwa <code>x = c(40, 2)</code>) ist unsinnig.
</p>
</li>
<li>
<p>
Optionale. Sie haben Voreinstellungen und dienen üblicherweise der Steuerung der Funktion. Das Argument <code>order</code> in <code>memory_hogs</code> ist ein klassisches Beispiel: in der Voreinstellung wird die Ausgabe nach Speicherverbrauch sortiert.
</p>
</li>
<li>
<p>
Die <em>Ellipsis</em>, um Argumente an andere Funktionen weiterzureichen.
</p>
</li>
</ul></div>
</div>
<div class="sect2">
<h3 id="_return_value_und_side_effects">2.4. Return Value und Side Effects</h3>
<div class="paragraph"><p>Jede Funktion in <strong>R</strong> gibt einen Wert zurück, falls sie nicht mit einem Fehler abbricht.
Wenn wir keinen Rückgabewert (return value) explizit angeben, ist er automatisch der Wert des letzten in der Funktion ausgewerteten Ausdrucks (siehe <code>?expression</code>), oder, falls die Funktion keinen Ausdruck hat, <code>NULL</code> (siehe <code>?return</code>), compris?
Es ist daher sicher nicht schlecht, wenn Du versucht, den Rückgabewert jeder Funktion explizit anzugeben.
Wenn Du die auf die explizite Rückgabe verzichtest ist Deine Funktion zwar (um eine Zeile) kürzer und inhaltsgleich, aber weniger sprechend. Und damit weniger gut lesbar.
Und damit mehr schlechter als eine Zeile kürzer mehr besser ist, capisce?</p></div>
<div class="paragraph"><p>Komplexere Funktionen haben oft Nebenwirkungen (<a href="https://en.wikipedia.org/wiki/Side_effect_(computer_science)">side effects</a>).
Bei vielen dieser Funktionen sind die Nebenwirkungen der eigentliche Zweck der Funktion,
manchmal ist der Rückgabewert sogar belanglos.
Die Funktion <code>rm</code> gibt beispielsweise unsichtbar <code>NULL</code> zurück (und das selbst dann, wenn es gar nichts zu löschen gibt).
Das erkennen wir, wenn wir ihren Rückgabewert explizit drucken:</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.7
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt>a <span style="color: #990000">&lt;-</span> <span style="color: #FF0000">"This is a string"</span>
print<span style="color: #990000">(</span>rm<span style="color: #990000">(</span>a<span style="color: #990000">))</span></tt></pre></div></div>
<div class="listingblock">
<div class="content">
<pre><code>## NULL</code></pre>
</div></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.7
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt>print<span style="color: #990000">(</span>rm<span style="color: #990000">())</span></tt></pre></div></div>
<div class="listingblock">
<div class="content">
<pre><code>## NULL</code></pre>
</div></div>
<div class="paragraph"><p>Das heißt also, dass unsere Funktion <code>wipe_clean</code> den Wert <code>invisible(NULL)</code>, zurückgibt, denn das war der Wert des letzten in ihr ausgewerteten Ausdrucks (der Aufruf der Funktion <code>rm</code>).</p></div>
<div class="paragraph"><p>Das können wir ändern, indem wir einen expliziten Rückgabewert einbauen (bei der Gelegenheit wandeln wir gleich noch den Gültigkeitsbereich, indem die Funktion löscht, in ein Steuerargument mit Voreinstellung um):</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.7
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt>wipe_clean <span style="color: #990000">&lt;-</span> function<span style="color: #990000">(</span>environment <span style="color: #990000">=</span> parent<span style="color: #990000">.</span>frame<span style="color: #990000">())</span> {
    objects <span style="color: #990000">&lt;-</span> ls<span style="color: #990000">(</span><span style="font-weight: bold"><span style="color: #0000FF">name</span></span> <span style="color: #990000">=</span> environment<span style="color: #990000">,</span> all<span style="color: #990000">.</span>names <span style="color: #990000">=</span> TRUE<span style="color: #990000">)</span>
    rm<span style="color: #990000">(</span>list <span style="color: #990000">=</span> objects<span style="color: #990000">,</span> envir <span style="color: #990000">=</span> environment<span style="color: #990000">)</span>
    return<span style="color: #990000">(</span>invisible<span style="color: #990000">(</span>objects<span style="color: #990000">))</span>
}</tt></pre></div></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.7
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt>print<span style="color: #990000">(</span>wipe_clean<span style="color: #990000">())</span></tt></pre></div></div>
<div class="listingblock">
<div class="content">
<pre><code>## [1] "memory_hogs" "va"          "vd"          "wipe_clean"</code></pre>
</div></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.7
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt>ls<span style="color: #990000">()</span></tt></pre></div></div>
<div class="listingblock">
<div class="content">
<pre><code>## character(0)</code></pre>
</div></div>
<div class="paragraph"><p>Jetzt gibt die Funktion die Namen der von ihr gelöschten Objekte zurück. Wir wissen also, wie hieß, was wir gelöscht haben. Damit können wir zwar nichts mehr anfangen, aber die Funktion hat nun genau einen expliziten Endpunkt. Das ist immerhin schön übersichtlich.</p></div>
<div class="sidebarblock">
<div class="content">
<div class="title">Exkurs: Komplexe Rückgabewerte</div>
<div class="literalblock">
<div class="content">
<pre><code>Rückgabewerte können auch komplex sein. Stell Dir vor, Du wolltest für einen Vektor verschiedene statistische Kennwerte berechen. Eine Funktion könnte so aussehen:</code></pre>
</div></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.7
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt>stats <span style="color: #990000">&lt;-</span> function<span style="color: #990000">(</span>x<span style="color: #990000">)</span> {
    m <span style="color: #990000">&lt;-</span> mean<span style="color: #990000">(</span>x<span style="color: #990000">)</span>
    v <span style="color: #990000">&lt;-</span> var<span style="color: #990000">(</span>x<span style="color: #990000">)</span>
    r <span style="color: #990000">&lt;-</span> range<span style="color: #990000">(</span>x<span style="color: #990000">)</span>
    value <span style="color: #990000">&lt;-</span> list<span style="color: #990000">(</span>date <span style="color: #990000">=</span> Sys<span style="color: #990000">.</span>time<span style="color: #990000">(),</span> data <span style="color: #990000">=</span> x<span style="color: #990000">,</span> mean <span style="color: #990000">=</span> m<span style="color: #990000">,</span> variance <span style="color: #990000">=</span> v<span style="color: #990000">,</span> range <span style="color: #990000">=</span> r<span style="color: #990000">)</span>
    return<span style="color: #990000">(</span>value<span style="color: #990000">)</span>
}
stats<span style="color: #990000">(</span>rnorm<span style="color: #990000">(</span><span style="color: #993399">100</span><span style="color: #990000">))</span></tt></pre></div></div>
<div class="listingblock">
<div class="content">
<pre><code>## $date
## [1] "2018-06-08 10:44:33 CEST"
##
## $data
##   [1]  0.7613775996  1.2250766052 -1.3560674435  1.2523164670 -0.1446887714
##   [6] -0.3979083081  0.7067074268  0.1647888661 -0.8925270016 -0.1006126053
##  [11]  1.2094554483 -0.5943678574 -1.1072789440  1.3248394011 -2.1504494621
##  [16] -0.3746691116 -0.5723045903  2.0861706556  1.8303015191  0.1434567001
##  [21]  0.6282352502  0.5067572599  0.3379817366 -0.3818597278 -0.4064909507
##  [26] -1.1368279205  0.3522724343 -0.7072669760  2.1844011907  0.0865196590
##  [31]  0.2888241988  0.4234723958  0.5797503758 -0.3879205709 -0.2858731558
##  [36]  0.8510483515  0.5211755797  0.7475138025  2.3767156640  0.9350580085
##  [41]  1.9777856509 -0.1160078911  0.9766809637 -1.0742806424  0.7105977581
##  [46] -0.6912509351 -1.3675775860 -0.0013090814 -1.9000057530 -1.2013841043
##  [51]  1.0767191803  0.2287927204  0.2827782972 -0.4396774537 -0.8564706833
##  [56] -0.8191363702 -1.2025872783 -1.7274547501  0.6784288247  0.7285468636
##  [61]  0.2002479125  0.3320648139 -0.1734260031 -0.7256872225  1.4446742901
##  [66] -0.2873310275 -0.1651173883 -0.7326439608 -0.0004257707 -0.3402369549
##  [71] -1.0514854281  0.2810012079 -0.6771773687  0.6181987336  0.4276865472
##  [76]  0.0655715049 -0.4261634936  0.6961525730 -0.0478840640  0.3497077913
##  [81]  1.0486895297 -0.5571386002  0.9062822432  0.0485768264  0.0618243235
##  [86] -1.2403586490 -0.3198267099  1.5170620256  0.4928148498 -1.1608974385
##  [91] -0.7263393127  0.7204545808  0.5511823328 -0.4332479714  0.3214493282
##  [96]  0.0956798332  0.9798968498 -1.1669823887  0.3489635855  1.0647817938
##
## $mean
## [1] 0.08130885
##
## $variance
## [1] 0.8327458
##
## $range
## [1] -2.150449  2.376716</code></pre>
</div></div>
<div class="paragraph"><p>Die Rückgabe einer Liste ist unter statistischen Funktionen (<code>stats::lm</code>, <code>stats::glm</code>, <code>mgcv::gam</code>, &#8230;)
verbreitet.</p></div>
</div></div>
</div>
<div class="sect2">
<h3 id="_funktionen_verwalten">2.5. Funktionen verwalten</h3>
<div class="sect3">
<h4 id="_im_jeweiligen_skript">2.5.1. Im jeweiligen Skript</h4>
<div class="paragraph"><p>Ich schreibe viele Funktionen während Datenauswertungen, sie landen dann erstmal
im jeweiligen Auswertungsskript. Manchmal sammele ich sie an dessen Beginn, meist lege ich
sie aber gleich <a href="#_lokal">lokal</a> ab.</p></div>
</div>
<div class="sect3">
<h4 id="_lokal">2.5.2. Lokal</h4>
<div class="paragraph"><p>Viele meiner wissenschaftlichen Projekte haben im <strong>R</strong>-Skript-Verzeichnis ein Unterverzeichnis mit dem Namen <code>./functions</code>.
Darin lege ich die Funktionen, die ich <a href="#_im_jeweiligen_skript">in den Skripten des Projektes</a> schreibe, ab.
Wichtige Funktionen kommen in eigene Dateien, die nach ihnen benannt sind, andere sammele ich, beispielsweise in
<code>./functions/utils.R</code> oder <code>./functions/misc.R</code>.</p></div>
<div class="paragraph"><p>Jedes Auswertungsskript hat dann am Beginn die Zeilen</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.7
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt>for <span style="color: #990000">(</span>f <span style="font-weight: bold"><span style="color: #0000FF">in</span></span> dir<span style="color: #990000">(</span><span style="color: #FF0000">"./functions/"</span><span style="color: #990000">,</span> full<span style="color: #990000">.</span>names <span style="color: #990000">=</span> TRUE<span style="color: #990000">,</span> pattern <span style="color: #990000">=</span> <span style="color: #FF0000">".*</span><span style="color: #CC33CC">\\</span><span style="color: #FF0000">.[rR]$"</span><span style="color: #990000">))</span> {
    source<span style="color: #990000">(</span>f<span style="color: #990000">)</span>
}</tt></pre></div></div>
</div>
<div class="sect3">
<h4 id="_global">2.5.3. Global</h4>
<div class="paragraph"><p>Funktionen, die Du nicht nur in einem Projekt nutzen willst,
kannst Du zentral verwalten,
in dem Du Dateien wie im Abschnitt <a href="#_lokal">lokal</a> beschrieben ablegst,
nur mit dem Unterschied, dass Du ein zentrales Verzeichnis benutzt.
Dann fügst Du in eine Deiner <strong>R</strong>-Startup-Dateien die Anweisung</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.7
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt>for <span style="color: #990000">(</span>f <span style="font-weight: bold"><span style="color: #0000FF">in</span></span> dir<span style="color: #990000">(</span><span style="color: #FF0000">"/full/path/to/functions_directory/"</span><span style="color: #990000">,</span>
              full<span style="color: #990000">.</span>names <span style="color: #990000">=</span> TRUE<span style="color: #990000">,</span> pattern <span style="color: #990000">=</span> <span style="color: #FF0000">".*</span><span style="color: #CC33CC">\\</span><span style="color: #FF0000">.[rR]$"</span><span style="color: #990000">))</span> {
    source<span style="color: #990000">(</span>f<span style="color: #990000">)</span>
}</tt></pre></div></div>
<div class="paragraph"><p>ein und den  passt "/full/path/to/functions_directory/" an.
Geeignte <strong>R</strong>-Startup-Dateien verrät Dir die <strong>R</strong>-Hilfe <code>?Startup</code> oder der Code:</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.7
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt>candidates <span style="color: #990000">&lt;-</span> c<span style="color: #990000">(</span> Sys<span style="color: #990000">.</span>getenv<span style="color: #990000">(</span><span style="color: #FF0000">"R_PROFILE"</span><span style="color: #990000">),</span>
                 Sys<span style="color: #990000">.</span>getenv<span style="color: #990000">(</span><span style="color: #FF0000">"R_PROFILE_USER"</span><span style="color: #990000">),</span>
                 file<span style="color: #990000">.</span>path<span style="color: #990000">(</span>Sys<span style="color: #990000">.</span>getenv<span style="color: #990000">(</span><span style="color: #FF0000">"R_HOME"</span><span style="color: #990000">),</span> <span style="color: #FF0000">"etc"</span><span style="color: #990000">,</span> <span style="color: #FF0000">"Rprofile.site"</span><span style="color: #990000">),</span>
                 file<span style="color: #990000">.</span>path<span style="color: #990000">(</span>Sys<span style="color: #990000">.</span>getenv<span style="color: #990000">(</span><span style="color: #FF0000">"HOME"</span><span style="color: #990000">),</span> <span style="color: #FF0000">".Rprofile"</span><span style="color: #990000">),</span>
                 file<span style="color: #990000">.</span>path<span style="color: #990000">(</span>getwd<span style="color: #990000">(),</span> <span style="color: #FF0000">".Rprofile"</span><span style="color: #990000">)</span> <span style="color: #990000">)</span>

Filter<span style="color: #990000">(</span>file<span style="color: #990000">.</span>exists<span style="color: #990000">,</span> candidates<span style="color: #990000">)</span></tt></pre></div></div>
</div>
<div class="sect3">
<h4 id="_als_paket">2.5.4. Als Paket</h4>
<div class="paragraph"><p>Wenn Du Dir die Mühe machst, Deine Funktionen zu <a href="#_funktionen_dokumentieren">dokumentieren</a>, kannst
Du sie eigentlich auch gleich in einem oder mehreren Paketen verwalten.
Das ist am elegantesten.</p></div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_schöner_programmieren">3. Schöner Programmieren</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_argumententests">3.1. Argumententests</h3>
<div class="paragraph"><p>Wir haben verschiedene Möglichkeiten, die Objekte, die wir den Argumenten einer Funktion übergeben, zu testen.</p></div>
<div class="sect3">
<h4 id="_typentests">3.1.1. Typentests</h4>
<div class="paragraph"><p>Wir können Objekte darauf testen, ob sie einem bestimmten Typ (einer Klasse) angehören;
bei Objekten, die einer Funktion als Argument übergeben werden ist dies besonders ratsam.
Das geht in reinen <code>base R</code>, ist aber eher umständlich,
die <a href="https://cran.r-project.org/web/packages/checkmate/vignettes/checkmate.html#intro">Vignette zu <code>checkmate</code></a>
bietet ein anschauliches Bespiel.</p></div>
<div class="paragraph"><p>Ich kenne zwei Pakete, die Typentest vereinfachen:
<a href="https://CRAN.R-project.org/package=assertthat">assertthat</a> und
<a href="https://CRAN.R-project.org/package=checkmate">checkmate</a></p></div>
<div class="ulist"><ul>
<li>
<p>
<a href="https://CRAN.R-project.org/package=checkmate">checkmate</a> ist hauptsächlich in C geschrieben, sehr schnell,
sehr flexibel mit unterschiedlichen Testarten ("checks", "asserts" und "tests"),
hat aber viele Abhängigkeiten und ist etwas sperrig: sein Manual ist über 100 Seiten lang.
</p>
</li>
<li>
<p>
<a href="https://CRAN.R-project.org/package=assertthat">assertthat</a> ist reines R ohne irgendwelche Abhängigkeiten und recht übersichtlich.
</p>
</li>
</ul></div>
<div class="paragraph"><p><a href="https://CRAN.R-project.org/package=assertthat">assertthat</a> ist sehr einfach:</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.7
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt>x <span style="color: #990000">&lt;-</span> <span style="color: #993399">6</span>
<span style="font-weight: bold"><span style="color: #000080">assertthat:</span></span><span style="color: #990000">:</span>assert_that<span style="color: #990000">(</span>is<span style="color: #990000">.</span>numeric<span style="color: #990000">(</span>x<span style="color: #990000">))</span></tt></pre></div></div>
<div class="listingblock">
<div class="content">
<pre><code>## [1] TRUE</code></pre>
</div></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.7
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt>x <span style="color: #990000">&lt;-</span> <span style="color: #FF0000">"This is a string."</span>
<span style="font-weight: bold"><span style="color: #000080">assertthat:</span></span><span style="color: #990000">:</span>assert_that<span style="color: #990000">(</span>is<span style="color: #990000">.</span>numeric<span style="color: #990000">(</span>x<span style="color: #990000">))</span></tt></pre></div></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.7
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt>## Error<span style="color: #990000">:</span> x is <span style="font-weight: bold"><span style="color: #0000FF">not</span></span> a numeric <span style="font-weight: bold"><span style="color: #0000FF">or</span></span> integer vector
</tt></pre></div></div>
<div class="paragraph"><div class="title">Was haben wir davon?</div><p>Wenn wir unserer Summenfunktion</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.7
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt>my_sum <span style="color: #990000">&lt;-</span> function<span style="color: #990000">(</span>x<span style="color: #990000">)</span> {
    value <span style="color: #990000">&lt;-</span> <span style="color: #993399">0</span>
    for <span style="color: #990000">(</span>x_i <span style="font-weight: bold"><span style="color: #0000FF">in</span></span> x<span style="color: #990000">)</span> {
        value <span style="color: #990000">&lt;-</span> value <span style="color: #990000">+</span> x_i
    }
    return<span style="color: #990000">(</span>value<span style="color: #990000">)</span>
}</tt></pre></div></div>
<div class="paragraph"><p>ein nicht-numerisches Argument übergeben, erhalten wir eine recht kryptische Fehlermeldung:</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.7
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt>my_sum<span style="color: #990000">(</span>c<span style="color: #990000">(</span><span style="color: #FF0000">"a"</span><span style="color: #990000">,</span> <span style="color: #FF0000">"b"</span><span style="color: #990000">))</span></tt></pre></div></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.7
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt>## Error <span style="font-weight: bold"><span style="color: #0000FF">in</span></span> value <span style="color: #990000">+</span> x_i<span style="color: #990000">:</span> non<span style="color: #990000">-</span>numeric argument to binary operator
</tt></pre></div></div>
<div class="paragraph"><p>Durch den Einbau eines Typentests</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.7
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt>my_sum <span style="color: #990000">&lt;-</span> function<span style="color: #990000">(</span>x<span style="color: #990000">)</span> {
<span style="font-weight: bold"><span style="color: #000080">    assertthat:</span></span><span style="color: #990000">:</span>assert_that<span style="color: #990000">(</span>is<span style="color: #990000">.</span>numeric<span style="color: #990000">(</span>x<span style="color: #990000">))</span>
    value <span style="color: #990000">&lt;-</span> <span style="color: #993399">0</span>
    for <span style="color: #990000">(</span>x_i <span style="font-weight: bold"><span style="color: #0000FF">in</span></span> x<span style="color: #990000">)</span> {
        value <span style="color: #990000">&lt;-</span> value <span style="color: #990000">+</span> x_i
    }
    return<span style="color: #990000">(</span>value<span style="color: #990000">)</span>
}</tt></pre></div></div>
<div class="paragraph"><p>wird die Meldung deutlich verständlicher:</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.7
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt>my_sum<span style="color: #990000">(</span>c<span style="color: #990000">(</span><span style="color: #FF0000">"a"</span><span style="color: #990000">,</span> <span style="color: #FF0000">"b"</span><span style="color: #990000">))</span></tt></pre></div></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.7
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt>## Error<span style="color: #990000">:</span> x is <span style="font-weight: bold"><span style="color: #0000FF">not</span></span> a numeric <span style="font-weight: bold"><span style="color: #0000FF">or</span></span> integer vector
</tt></pre></div></div>
<div class="paragraph"><p>Mit <a href="https://CRAN.R-project.org/package=checkmate">checkmate</a> können wir sogar erzwingen, dass x nicht nur numerisch sein muss,
sondern auch mindestens zwei Elemente haben soll. Eine Summe einer Zahl ist ja etwas albern:</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.7
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt>my_sum <span style="color: #990000">&lt;-</span> function<span style="color: #990000">(</span>x<span style="color: #990000">)</span> {
<span style="font-weight: bold"><span style="color: #000080">    checkmate:</span></span><span style="color: #990000">:</span>qassert<span style="color: #990000">(</span>x<span style="color: #990000">,</span> <span style="color: #FF0000">"n&gt;=2"</span><span style="color: #990000">)</span>
    value <span style="color: #990000">&lt;-</span> <span style="color: #993399">0</span>
    for <span style="color: #990000">(</span>x_i <span style="font-weight: bold"><span style="color: #0000FF">in</span></span> x<span style="color: #990000">)</span> {
        value <span style="color: #990000">&lt;-</span> value <span style="color: #990000">+</span> x_i
    }
    return<span style="color: #990000">(</span>value<span style="color: #990000">)</span>
}</tt></pre></div></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.7
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt>my_sum<span style="color: #990000">(</span><span style="color: #993399">42</span><span style="color: #990000">)</span></tt></pre></div></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.7
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt>## Error <span style="font-weight: bold"><span style="color: #0000FF">in</span></span> rasciidoc<span style="color: #990000">::</span>render_slides<span style="color: #990000">(</span><span style="color: #FF0000">"index.Rasciidoc"</span><span style="color: #990000">,</span> clean <span style="color: #990000">=</span> TRUE<span style="color: #990000">):</span> Assertion on <span style="color: #FF0000">'x'</span> failed<span style="color: #990000">.</span> Must be of <span style="font-weight: bold"><span style="color: #0000FF">length</span></span> <span style="color: #990000">&gt;=</span> <span style="color: #993399">2</span><span style="color: #990000">,</span> but has <span style="font-weight: bold"><span style="color: #0000FF">length</span></span> <span style="color: #993399">1</span><span style="color: #990000">.</span>
</tt></pre></div></div>
<div class="paragraph"><p><em>Ich nutze Typentests oft in Funktionen. Da <a href="https://CRAN.R-project.org/package=checkmate">checkmate</a> deutlich mehr Funktionalität bietet, nutzte ich <a href="https://CRAN.R-project.org/package=assertthat">assertthat</a> eher selten.</em></p></div>
</div>
<div class="sect3">
<h4 id="_auswahllisten">3.1.2. Auswahllisten</h4>
<div class="paragraph"><p>Mit Auswahllisten können wir Objekte darauf testen, ob sie eine von mehreren Möglichkeiten
enthalten. Das ist vor allem für Steuerargumente hilfreich.
<code>base R</code> kennt <code>match.arg</code>, das mit alphanumerischen Vektoren arbeitet und einfach das Objekt zurückgibt, wenn
es in der Auswahlliste enthalten ist:</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.7
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt>noten <span style="color: #990000">&lt;-</span>  c<span style="color: #990000">(</span><span style="color: #FF0000">"sehr gut"</span><span style="color: #990000">,</span> <span style="color: #FF0000">"gut"</span><span style="color: #990000">,</span> <span style="color: #FF0000">"nicht soo gut"</span><span style="color: #990000">,</span> <span style="color: #FF0000">"das kann auf jeden Fall noch besser werden"</span><span style="color: #990000">)</span>
note  <span style="color: #990000">&lt;-</span> <span style="color: #FF0000">"gut"</span>
match<span style="color: #990000">.</span>arg<span style="color: #990000">(</span>arg <span style="color: #990000">=</span> note<span style="color: #990000">,</span> choices <span style="color: #990000">=</span> noten<span style="color: #990000">)</span></tt></pre></div></div>
<div class="listingblock">
<div class="content">
<pre><code>## [1] "gut"</code></pre>
</div></div>
<div class="paragraph"><p>Dabei bedient es sich dem "partial matching", das heißt, dass ein eindeutig einer Auswahlmöglichkeit zuzuordnender Anfang einer Zeichenkette ausreicht:</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.7
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt>note  <span style="color: #990000">&lt;-</span> <span style="color: #FF0000">"das"</span>
match<span style="color: #990000">.</span>arg<span style="color: #990000">(</span>arg <span style="color: #990000">=</span> note<span style="color: #990000">,</span> choices <span style="color: #990000">=</span> noten<span style="color: #990000">)</span></tt></pre></div></div>
<div class="listingblock">
<div class="content">
<pre><code>## [1] "das kann auf jeden Fall noch besser werden"</code></pre>
</div></div>
<div class="paragraph"><p>Wird kein Treffer in der Auswahlliste gefunden, erhalten wir einen Fehler:</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.7
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt>note  <span style="color: #990000">&lt;-</span> <span style="color: #FF0000">"ausreichend"</span>
match<span style="color: #990000">.</span>arg<span style="color: #990000">(</span>arg <span style="color: #990000">=</span> note<span style="color: #990000">,</span> choices <span style="color: #990000">=</span> noten<span style="color: #990000">)</span></tt></pre></div></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.7
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt>## Error <span style="font-weight: bold"><span style="color: #0000FF">in</span></span> match<span style="color: #990000">.</span>arg<span style="color: #990000">(</span>arg <span style="color: #990000">=</span> note<span style="color: #990000">,</span> choices <span style="color: #990000">=</span> noten<span style="color: #990000">):</span> <span style="color: #FF0000">'arg'</span> should be one of <span style="color: #FF0000">"sehr gut"</span><span style="color: #990000">,</span> <span style="color: #FF0000">"gut"</span><span style="color: #990000">,</span> <span style="color: #FF0000">"nicht soo gut"</span><span style="color: #990000">,</span> <span style="color: #FF0000">"das kann auf jeden Fall noch besser werden"</span>
</tt></pre></div></div>
<div class="paragraph"><p><code>match.arg</code> ist genau, was hinter Steuerargumenten vieler Funktionen (z.b.  <code>mgcv::gam(optimizer = &#8230;)</code>) steckt, hier ein Beispiel aus der Hilfe zu <code>match.arg</code>:</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.7
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt>center <span style="color: #990000">&lt;-</span> function<span style="color: #990000">(</span>x<span style="color: #990000">,</span> <span style="font-weight: bold"><span style="color: #0000FF">type</span></span> <span style="color: #990000">=</span> c<span style="color: #990000">(</span><span style="color: #FF0000">"mean"</span><span style="color: #990000">,</span> <span style="color: #FF0000">"median"</span><span style="color: #990000">,</span> <span style="color: #FF0000">"trimmed"</span><span style="color: #990000">))</span> {
    <span style="font-weight: bold"><span style="color: #0000FF">type</span></span> <span style="color: #990000">&lt;-</span> match<span style="color: #990000">.</span>arg<span style="color: #990000">(</span><span style="font-weight: bold"><span style="color: #0000FF">type</span></span><span style="color: #990000">)</span>
    switch<span style="color: #990000">(</span><span style="font-weight: bold"><span style="color: #0000FF">type</span></span><span style="color: #990000">,</span>
           mean <span style="color: #990000">=</span> mean<span style="color: #990000">(</span>x<span style="color: #990000">),</span>
           median <span style="color: #990000">=</span> median<span style="color: #990000">(</span>x<span style="color: #990000">),</span>
           trimmed <span style="color: #990000">=</span> mean<span style="color: #990000">(</span>x<span style="color: #990000">,</span> trim <span style="color: #990000">=</span> <span style="color: #993399">.1</span><span style="color: #990000">))</span>
}
center<span style="color: #990000">(</span>rnorm<span style="color: #990000">(</span><span style="color: #993399">100</span><span style="color: #990000">),</span> <span style="color: #FF0000">"med"</span><span style="color: #990000">)</span></tt></pre></div></div>
<div class="listingblock">
<div class="content">
<pre><code>## [1] -0.1455272</code></pre>
</div></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.7
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt>center<span style="color: #990000">(</span>rnorm<span style="color: #990000">(</span><span style="color: #993399">100</span><span style="color: #990000">),</span> <span style="color: #FF0000">"m"</span><span style="color: #990000">)</span></tt></pre></div></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.7
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt>## Error <span style="font-weight: bold"><span style="color: #0000FF">in</span></span> match<span style="color: #990000">.</span>arg<span style="color: #990000">(</span><span style="font-weight: bold"><span style="color: #0000FF">type</span></span><span style="color: #990000">):</span> <span style="color: #FF0000">'arg'</span> should be one of <span style="color: #FF0000">"mean"</span><span style="color: #990000">,</span> <span style="color: #FF0000">"median"</span><span style="color: #990000">,</span> <span style="color: #FF0000">"trimmed"</span>
</tt></pre></div></div>
<div class="paragraph"><p><a href="https://CRAN.R-project.org/package=checkmate">checkmate</a> kennt auch Auswahllisten, macht aber kein <code>partial matching</code> (was ich ganz gut finde):</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.7
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt>note  <span style="color: #990000">&lt;-</span> <span style="color: #FF0000">"das"</span>
<span style="font-weight: bold"><span style="color: #000080">checkmate:</span></span><span style="color: #990000">:</span>assertChoice<span style="color: #990000">(</span>x <span style="color: #990000">=</span> note<span style="color: #990000">,</span> choices <span style="color: #990000">=</span> noten<span style="color: #990000">)</span></tt></pre></div></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.7
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt>## Error <span style="font-weight: bold"><span style="color: #0000FF">in</span></span> rasciidoc<span style="color: #990000">::</span>render_slides<span style="color: #990000">(</span><span style="color: #FF0000">"index.Rasciidoc"</span><span style="color: #990000">,</span> clean <span style="color: #990000">=</span> TRUE<span style="color: #990000">):</span> Assertion on <span style="color: #FF0000">'note'</span> failed<span style="color: #990000">:</span> Must be element of set {<span style="color: #FF0000">'sehr gut'</span><span style="color: #990000">,</span><span style="color: #FF0000">'gut'</span><span style="color: #990000">,</span><span style="color: #FF0000">'nicht soo gut'</span><span style="color: #990000">,</span><span style="color: #FF0000">'das kann auf jeden Fall noch besser werden'</span>}<span style="color: #990000">,</span> but is <span style="color: #FF0000">'das'</span><span style="color: #990000">.</span>
</tt></pre></div></div>
<div class="paragraph"><p>Außerdem gibt <a href="https://CRAN.R-project.org/package=checkmate">checkmate</a> die gefundene Rückgabe unsichtbar zurück, weshalb ich hier ein explizites <code>print</code> benötige:</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.7
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt>note  <span style="color: #990000">&lt;-</span> <span style="color: #FF0000">"gut"</span>
<span style="font-weight: bold"><span style="color: #000080">checkmate:</span></span><span style="color: #990000">:</span>assertChoice<span style="color: #990000">(</span>x <span style="color: #990000">=</span> note<span style="color: #990000">,</span> choices <span style="color: #990000">=</span> noten<span style="color: #990000">)</span>
print<span style="color: #990000">(</span>checkmate<span style="color: #990000">::</span>assertChoice<span style="color: #990000">(</span>x <span style="color: #990000">=</span> note<span style="color: #990000">,</span> choices <span style="color: #990000">=</span> noten<span style="color: #990000">))</span></tt></pre></div></div>
<div class="listingblock">
<div class="content">
<pre><code>## [1] "gut"</code></pre>
</div></div>
<div class="paragraph"><p><a href="https://CRAN.R-project.org/package=checkmate">checkmate</a> kann nicht nur mit alphanumerischen Vektoren umgehen:</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.7
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt>x <span style="color: #990000">&lt;-</span> <span style="color: #993399">3</span>
choices <span style="color: #990000">&lt;-</span> <span style="color: #993399">1</span><span style="color: #990000">:</span><span style="color: #993399">7</span>
print<span style="color: #990000">(</span>checkmate<span style="color: #990000">::</span>assertChoice<span style="color: #990000">(</span>x <span style="color: #990000">=</span> x<span style="color: #990000">,</span> choices <span style="color: #990000">=</span> choices<span style="color: #990000">))</span></tt></pre></div></div>
<div class="listingblock">
<div class="content">
<pre><code>## [1] 3</code></pre>
</div></div>
<div class="paragraph"><p><em>Ich nutze Auswahllisten eher selten, da ich selten Steuerargumente mit mehreren Auswahlmöglichenkeiten in meinen Funktionen habe.</em></p></div>
</div>
</div>
<div class="sect2">
<h3 id="_funktionen_testen">3.2. Funktionen testen</h3>
<div class="sect3">
<h4 id="_unit_testing">3.2.1. Unit Testing</h4>
<div class="paragraph"><p>Beim Unit Testing wollen wir nicht die einer Funktion übergebenen Argumente, sondern die Funktion selbst testen.
Also im Zweifel ihren Rückgabewert.</p></div>
<div class="paragraph"><p>Ich kenne zwei Pakete, die Unit Testing in R formalisieren
(im Prinzip geht es auch ohne spezielle Pakete,
 aber seit ich die beiden Pakete kenne,
 habe ich nie mehr wie früher "von Hand" getestet):</p></div>
<div class="ulist"><ul>
<li>
<p>
<a href="https://CRAN.R-project.org/package=RUnit">RUnit</a> gibt es schon seit 2004, es ist sehr formal
 und hat wenige Abhängigkeiten (daher bevorzuge ich es beim Testen von Paketen).
</p>
</li>
<li>
<p>
<a href="https://CRAN.R-project.org/package=testthat">testthat</a> finde ich interaktiv einfacher anzuwenden.
</p>
</li>
</ul></div>
<div class="sect4">
<h5 id="_erwartungen">Erwartungen</h5>
<div class="paragraph"><p>Die kleinste Testeinheit ist immer ein Vergleich.</p></div>
<div class="paragraph"><p>Wenn wir die Funktionen</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.7
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt>my_sum <span style="color: #990000">&lt;-</span> function<span style="color: #990000">(</span>x<span style="color: #990000">)</span> {
    value <span style="color: #990000">&lt;-</span> <span style="color: #993399">0</span>
    for <span style="color: #990000">(</span>x_i <span style="font-weight: bold"><span style="color: #0000FF">in</span></span> x<span style="color: #990000">)</span> {
        value <span style="color: #990000">&lt;-</span> value <span style="color: #990000">+</span> x_i
    }
    return<span style="color: #990000">(</span>value<span style="color: #990000">)</span>
}</tt></pre></div></div>
<div class="literalblock">
<div class="content">
<pre><code>und</code></pre>
</div></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.7
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt>not_my_sum <span style="color: #990000">&lt;-</span> function<span style="color: #990000">(</span>x<span style="color: #990000">)</span> {
    value <span style="color: #990000">&lt;-</span> <span style="color: #993399">0</span>
    for <span style="color: #990000">(</span>x_i <span style="font-weight: bold"><span style="color: #0000FF">in</span></span> x<span style="color: #990000">)</span> {
        value <span style="color: #990000">&lt;-</span> value <span style="color: #990000">-</span> x_i
    }
    return<span style="color: #990000">(</span>value<span style="color: #990000">)</span>
}</tt></pre></div></div>
<div class="paragraph"><p>haben, können wir zum Beispiel mit <code>base R</code> prüfen, ob sie tun, was wir erwarten:</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.7
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt>my_sum<span style="color: #990000">(</span>c<span style="color: #990000">(</span><span style="color: #993399">2</span><span style="color: #990000">,</span> <span style="color: #993399">7</span><span style="color: #990000">))</span> <span style="color: #990000">==</span> <span style="color: #993399">9</span></tt></pre></div></div>
<div class="listingblock">
<div class="content">
<pre><code>## [1] TRUE</code></pre>
</div></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.7
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt># better use identical<span style="color: #990000">(),</span> see <span style="color: #990000">?</span>Comparison
identical<span style="color: #990000">(</span>not_my_sum<span style="color: #990000">(</span>c<span style="color: #990000">(</span><span style="color: #993399">2</span><span style="color: #990000">,</span> <span style="color: #993399">7</span><span style="color: #990000">)),</span> <span style="color: #993399">9</span><span style="color: #990000">)</span></tt></pre></div></div>
<div class="listingblock">
<div class="content">
<pre><code>## [1] FALSE</code></pre>
</div></div>
<div class="paragraph"><p>Beide Pakete formalisieren dies zu Erwartungsfunktionen die hauptsächlich dazu dienen,
Fehler zu beschreiben:</p></div>
<div class="listingblock">
<div class="title"><a href="https://CRAN.R-project.org/package=RUnit">RUnit</a></div>
<div class="content"><!-- Generator: GNU source-highlight 3.1.7
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="font-weight: bold"><span style="color: #000080">RUnit:</span></span><span style="color: #990000">:</span>checkIdentical<span style="color: #990000">(</span>not_my_sum<span style="color: #990000">(</span>c<span style="color: #990000">(</span><span style="color: #993399">2</span><span style="color: #990000">,</span> <span style="color: #993399">7</span><span style="color: #990000">)),</span> <span style="color: #993399">9</span><span style="color: #990000">)</span></tt></pre></div></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.7
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt>## Error <span style="font-weight: bold"><span style="color: #0000FF">in</span></span> RUnit<span style="color: #990000">::</span>checkIdentical<span style="color: #990000">(</span>not_my_sum<span style="color: #990000">(</span>c<span style="color: #990000">(</span><span style="color: #993399">2</span><span style="color: #990000">,</span> <span style="color: #993399">7</span><span style="color: #990000">)),</span> <span style="color: #993399">9</span><span style="color: #990000">):</span> FALSE
##
</tt></pre></div></div>
<div class="listingblock">
<div class="title"><a href="https://CRAN.R-project.org/package=testthat">testthat</a></div>
<div class="content"><!-- Generator: GNU source-highlight 3.1.7
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="font-weight: bold"><span style="color: #000080">testthat:</span></span><span style="color: #990000">:</span>expect_identical<span style="color: #990000">(</span>not_my_sum<span style="color: #990000">(</span>c<span style="color: #990000">(</span><span style="color: #993399">2</span><span style="color: #990000">,</span> <span style="color: #993399">7</span><span style="color: #990000">)),</span> <span style="color: #993399">9</span><span style="color: #990000">)</span></tt></pre></div></div>
<div class="listingblock">
<div class="content">
<pre><code>## not_my_sum(c(2, 7)) not identical to 9.
## 1/1 mismatches
## [1] -9 - 9 == -18</code></pre>
</div></div>
</div>
<div class="sect4">
<h5 id="_tests">Tests</h5>
<div class="paragraph"><p>Um Erwartungen bei der Paketentwicklung oder in Bezug auf ihre <a href="#_code_coverage">Coverage</a> auszuwerten,
    werden in beiden Paketen Erwartungen zu Tests zusammenfasst
(eigentlich sollten Tests immer nur Erwartungen zu einer Funktion enthalten, aber wir wollen ja auch Fehler sehen):</p></div>
<div class="paragraph"><div class="title"><a href="https://CRAN.R-project.org/package=testthat">testthat</a></div><p>Du kannst einen Test entweder einzeln laufen lassen</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.7
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="font-weight: bold"><span style="color: #000080">testthat:</span></span><span style="color: #990000">:</span>context<span style="color: #990000">(</span><span style="color: #FF0000">"My first test."</span><span style="color: #990000">)</span>
<span style="font-weight: bold"><span style="color: #000080">testthat:</span></span><span style="color: #990000">:</span>test_that<span style="color: #990000">(</span><span style="color: #FF0000">"Simple test on summation."</span><span style="color: #990000">,</span> {
<span style="font-weight: bold"><span style="color: #000080">                        testthat:</span></span><span style="color: #990000">:</span>expect_identical<span style="color: #990000">(</span>not_my_sum<span style="color: #990000">(</span>c<span style="color: #990000">(</span><span style="color: #993399">2</span><span style="color: #990000">,</span> <span style="color: #993399">7</span><span style="color: #990000">)),</span> <span style="color: #993399">9</span><span style="color: #990000">,</span>
                                                   info <span style="color: #990000">=</span> <span style="color: #FF0000">"Not my sum."</span><span style="color: #990000">)</span>
<span style="font-weight: bold"><span style="color: #000080">                        testthat:</span></span><span style="color: #990000">:</span>expect_identical<span style="color: #990000">(</span>my_sum<span style="color: #990000">(</span>c<span style="color: #990000">(</span><span style="color: #993399">2</span><span style="color: #990000">,</span> <span style="color: #993399">7</span><span style="color: #990000">)),</span> <span style="color: #993399">9</span><span style="color: #990000">,</span>
                                                   info <span style="color: #990000">=</span> <span style="color: #FF0000">"My sum."</span><span style="color: #990000">)</span>
}<span style="color: #990000">)</span></tt></pre></div></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.7
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt>## Error<span style="color: #990000">:</span> <span style="font-weight: bold"><span style="color: #0000FF">Test</span></span> failed<span style="color: #990000">:</span> <span style="color: #FF0000">'Simple test on summation.'</span>
## <span style="color: #990000">*</span> not_my_sum<span style="color: #990000">(</span>c<span style="color: #990000">(</span><span style="color: #993399">2</span><span style="color: #990000">,</span> <span style="color: #993399">7</span><span style="color: #990000">))</span> <span style="font-weight: bold"><span style="color: #0000FF">not</span></span> identical to <span style="color: #993399">9</span><span style="color: #990000">.</span>
## <span style="color: #993399">1</span><span style="color: #990000">/</span><span style="color: #993399">1</span> mismatches
## <span style="color: #990000">[</span><span style="color: #993399">1</span><span style="color: #990000">]</span> <span style="color: #990000">-</span><span style="color: #993399">9</span> <span style="color: #990000">-</span> <span style="color: #993399">9</span> <span style="color: #990000">==</span> <span style="color: #990000">-</span><span style="color: #993399">18</span>
## <span style="font-weight: bold"><span style="color: #0000FF">Not</span></span> my sum<span style="color: #990000">.</span>
</tt></pre></div></div>
<div class="paragraph"><p>oder den Test in einer  Testdatei</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.7
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="font-weight: bold"><span style="color: #000080">testthat:</span></span><span style="color: #990000">:</span>context<span style="color: #990000">(</span><span style="color: #FF0000">"My first test."</span><span style="color: #990000">)</span>
<span style="font-weight: bold"><span style="color: #000080">testthat:</span></span><span style="color: #990000">:</span>test_that<span style="color: #990000">(</span><span style="color: #FF0000">"Simple test on summation."</span><span style="color: #990000">,</span> {
<span style="font-weight: bold"><span style="color: #000080">                        testthat:</span></span><span style="color: #990000">:</span>expect_identical<span style="color: #990000">(</span>not_my_sum<span style="color: #990000">(</span>c<span style="color: #990000">(</span><span style="color: #993399">2</span><span style="color: #990000">,</span> <span style="color: #993399">7</span><span style="color: #990000">)),</span> <span style="color: #993399">9</span><span style="color: #990000">,</span>
                                                   info <span style="color: #990000">=</span> <span style="color: #FF0000">"Not my sum."</span><span style="color: #990000">)</span>
<span style="font-weight: bold"><span style="color: #000080">                        testthat:</span></span><span style="color: #990000">:</span>expect_identical<span style="color: #990000">(</span>my_sum<span style="color: #990000">(</span>c<span style="color: #990000">(</span><span style="color: #993399">2</span><span style="color: #990000">,</span> <span style="color: #993399">7</span><span style="color: #990000">)),</span> <span style="color: #993399">9</span><span style="color: #990000">,</span>
                                                   info <span style="color: #990000">=</span> <span style="color: #FF0000">"My sum."</span><span style="color: #990000">)</span>
}<span style="color: #990000">)</span></tt></pre></div></div>
<div class="paragraph"><p>mit einer Funktion auswerten, bei <a href="https://CRAN.R-project.org/package=testthat">testthat</a> ändert sich
relativ wenig:</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.7
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="font-weight: bold"><span style="color: #000080">testthat:</span></span><span style="color: #990000">:</span>test_file<span style="color: #990000">(</span>file<span style="color: #990000">.</span>path<span style="color: #990000">(</span><span style="color: #FF0000">"src"</span><span style="color: #990000">,</span> <span style="color: #FF0000">"test_my_sum.R"</span><span style="color: #990000">))</span></tt></pre></div></div>
<div class="listingblock">
<div class="content">
<pre><code>## ✔ | OK F W S | Context
##
⠏ |  0       | My first test.
⠋ |  0 1     | My first test.
⠙ |  1 1     | My first test.
✖ |  1 1     | My first test.
## ───────────────────────────────────────────────────────────────────────────
## test_my_sum.R:3: failure: Simple test on summation.
## not_my_sum(c(2, 7)) not identical to 9.
## 1/1 mismatches
## [1] -9 - 9 == -18
## Not my sum.
## ───────────────────────────────────────────────────────────────────────────
##
## ══ Results ════════════════════════════════════════════════════════════════
## Duration: 0.2 s
##
## OK:       1
## Failed:   1
## Warnings: 0
## Skipped:  0</code></pre>
</div></div>
<div class="paragraph"><p>Du erhälst aber die Information, dass der Fehler im ersten Test in Zeile 3 auftrat.</p></div>
<div class="paragraph"><div class="title"><a href="https://CRAN.R-project.org/package=RUnit">RUnit</a></div><p>Größer sind die Unterschiede bei <a href="https://CRAN.R-project.org/package=RUnit">RUnit</a>,
das primär für das Testen von Paketen entwickelt wurde:
Es ist beim einfachen</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.7
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt>test_sum <span style="color: #990000">&lt;-</span> function<span style="color: #990000">()</span> {
<span style="font-weight: bold"><span style="color: #000080">    RUnit:</span></span><span style="color: #990000">:</span>checkIdentical<span style="color: #990000">(</span>not_my_sum<span style="color: #990000">(</span>c<span style="color: #990000">(</span><span style="color: #993399">2</span><span style="color: #990000">,</span> <span style="color: #993399">7</span><span style="color: #990000">)),</span> <span style="color: #993399">9</span><span style="color: #990000">)</span>
<span style="font-weight: bold"><span style="color: #000080">    RUnit:</span></span><span style="color: #990000">:</span>checkIdentical<span style="color: #990000">(</span>my_sum<span style="color: #990000">(</span>c<span style="color: #990000">(</span><span style="color: #993399">2</span><span style="color: #990000">,</span> <span style="color: #993399">7</span><span style="color: #990000">)),</span> <span style="color: #993399">9</span><span style="color: #990000">)</span>
}
test_sum<span style="color: #990000">()</span></tt></pre></div></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.7
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt>## Error <span style="font-weight: bold"><span style="color: #0000FF">in</span></span> RUnit<span style="color: #990000">::</span>checkIdentical<span style="color: #990000">(</span>not_my_sum<span style="color: #990000">(</span>c<span style="color: #990000">(</span><span style="color: #993399">2</span><span style="color: #990000">,</span> <span style="color: #993399">7</span><span style="color: #990000">)),</span> <span style="color: #993399">9</span><span style="color: #990000">):</span> FALSE
##
</tt></pre></div></div>
<div class="paragraph"><p>recht spröde, mit einer Testdatei</p></div>
<div class="listingblock">
<div class="title">src/runit_my_sum.R</div>
<div class="content"><!-- Generator: GNU source-highlight 3.1.7
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt>test_sum <span style="color: #990000">&lt;-</span> function<span style="color: #990000">()</span> {
<span style="font-weight: bold"><span style="color: #000080">    RUnit:</span></span><span style="color: #990000">:</span>checkIdentical<span style="color: #990000">(</span>not_my_sum<span style="color: #990000">(</span>c<span style="color: #990000">(</span><span style="color: #993399">2</span><span style="color: #990000">,</span> <span style="color: #993399">7</span><span style="color: #990000">)),</span> <span style="color: #993399">9</span><span style="color: #990000">)</span>
<span style="font-weight: bold"><span style="color: #000080">    RUnit:</span></span><span style="color: #990000">:</span>checkIdentical<span style="color: #990000">(</span>my_sum<span style="color: #990000">(</span>c<span style="color: #990000">(</span><span style="color: #993399">2</span><span style="color: #990000">,</span> <span style="color: #993399">7</span><span style="color: #990000">)),</span> <span style="color: #993399">9</span><span style="color: #990000">)</span>
}</tt></pre></div></div>
<div class="paragraph"><p>allerdings gesprächiger:</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.7
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt>test_file <span style="color: #990000">&lt;-</span> normalizePath<span style="color: #990000">(</span>file<span style="color: #990000">.</span>path<span style="color: #990000">(</span><span style="color: #FF0000">"src"</span><span style="color: #990000">,</span> <span style="color: #FF0000">"runit_my_sum.R"</span><span style="color: #990000">))</span>
runit <span style="color: #990000">&lt;-</span> RUnit<span style="color: #990000">::</span>runTestFile<span style="color: #990000">(</span>test_file<span style="color: #990000">)</span></tt></pre></div></div>
<div class="listingblock">
<div class="content">
<pre><code>##
##
## Executing test function test_sum  ...</code></pre>
</div></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.7
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt>## Timing stopped at<span style="color: #990000">:</span> <span style="color: #993399">0</span> <span style="color: #993399">0</span> <span style="color: #993399">0.001</span>
</tt></pre></div></div>
<div class="listingblock">
<div class="content">
<pre><code>##  done successfully.</code></pre>
</div></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.7
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="font-weight: bold"><span style="color: #000080">RUnit:</span></span><span style="color: #990000">:</span>printTextProtocol<span style="color: #990000">(</span>runit<span style="color: #990000">)</span></tt></pre></div></div>
<div class="listingblock">
<div class="content">
<pre><code>## RUNIT TEST PROTOCOL -- Fri Jun  8 10:44:34 2018
## ***********************************************
## Number of test functions: 1
## Number of errors: 0
## Number of failures: 1
##
##
## 1 Test Suite :
## runit_my_sum - 1 test function, 0 errors, 1 failure
## FAILURE in test_sum: Error in RUnit::checkIdentical(not_my_sum(c(2, 7)), 9) : FALSE
##
##
##
##
## Details
## ***************************
## Test Suite: runit_my_sum
## Test function regexp: ^test.+
## Test file regexp: ^runit_my_sum.R$
## Involved directory:
## /home/qwer/git/cyclops/fvafrcu/funktionen_in_r/src
## ---------------------------
## Test file: /home/qwer/git/cyclops/fvafrcu/funktionen_in_r/src/runit_my_sum.R
## test_sum: FAILURE !! (check number 1)
## Error in RUnit::checkIdentical(not_my_sum(c(2, 7)), 9) : FALSE
##</code></pre>
</div></div>
</div>
</div>
<div class="sect3">
<h4 id="_code_coverage">3.2.2. Code Coverage</h4>
<div class="paragraph"><p>Um zu sehen, ob Deine Unit Tests die Funktion gut testen,
kannst Du ihre  <a href="https://en.wikipedia.org/wiki/Code_coverage">Überdeckung</a> berechnen.
<a href="https://CRAN.R-project.org/package=covr">covr</a> ist eines der Pakete, die Code Coverage implentieren und das einzige, das ich nutze. Ich weiß es nicht, glaube aber, dass <a href="https://CRAN.R-project.org/package=covr">covr</a> die <a href="https://en.wikipedia.org/wiki/Code_coverage#Coverage_criteria"><em>branch coverage</em></a>
berechnet.
Prinzipiell ist eine hohe Überdeckung gut.</p></div>
<div class="paragraph"><p>Wenn Du eine Datei mit einer Funktionsdefinition</p></div>
<div class="listingblock">
<div class="title">src/my_sum_assertion.R</div>
<div class="content"><!-- Generator: GNU source-highlight 3.1.7
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt>my_sum <span style="color: #990000">&lt;-</span> function<span style="color: #990000">(</span>x<span style="color: #990000">)</span> {
<span style="font-weight: bold"><span style="color: #000080">    assertthat:</span></span><span style="color: #990000">:</span>assert_that<span style="color: #990000">(</span>is<span style="color: #990000">.</span>numeric<span style="color: #990000">(</span>x<span style="color: #990000">))</span>
    value <span style="color: #990000">&lt;-</span> <span style="color: #993399">0</span>
    for <span style="color: #990000">(</span>x_i <span style="font-weight: bold"><span style="color: #0000FF">in</span></span> x<span style="color: #990000">)</span> {
        value <span style="color: #990000">&lt;-</span> value <span style="color: #990000">+</span> x_i
    }
    return<span style="color: #990000">(</span>value<span style="color: #990000">)</span>
}</tt></pre></div></div>
<div class="paragraph"><p>und eine mit dem Test</p></div>
<div class="listingblock">
<div class="title">src/test_my_sum_assertion.R</div>
<div class="content"><!-- Generator: GNU source-highlight 3.1.7
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="font-weight: bold"><span style="color: #000080">testthat:</span></span><span style="color: #990000">:</span>context<span style="color: #990000">(</span><span style="color: #FF0000">"Tests for summation with argument assertion."</span><span style="color: #990000">)</span>
<span style="font-weight: bold"><span style="color: #000080">testthat:</span></span><span style="color: #990000">:</span>test_that<span style="color: #990000">(</span><span style="color: #FF0000">"Testing summation"</span><span style="color: #990000">,</span> {
<span style="font-weight: bold"><span style="color: #000080">                    testthat:</span></span><span style="color: #990000">:</span>expect_identical<span style="color: #990000">(</span>my_sum<span style="color: #990000">(</span>c<span style="color: #990000">(</span><span style="color: #993399">2</span><span style="color: #990000">,</span> <span style="color: #993399">7</span><span style="color: #990000">)),</span> <span style="color: #993399">9</span><span style="color: #990000">)</span>
<span style="font-weight: bold"><span style="color: #000080">                    testthat:</span></span><span style="color: #990000">:</span>expect_error<span style="color: #990000">(</span>my_sum<span style="color: #990000">(</span>c<span style="color: #990000">(</span><span style="color: #FF0000">"2"</span> <span style="color: #990000">+</span> <span style="color: #FF0000">"7"</span><span style="color: #990000">)))</span>
}<span style="color: #990000">)</span></tt></pre></div></div>
<div class="paragraph"><p>hast, kannst Du die Überdeckung berechnen.</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.7
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt>cov <span style="color: #990000">&lt;-</span> covr<span style="color: #990000">::</span>file_coverage<span style="color: #990000">(</span>file<span style="color: #990000">.</span>path<span style="color: #990000">(</span><span style="color: #FF0000">"src"</span><span style="color: #990000">,</span> <span style="color: #FF0000">"my_sum_assertion.R"</span><span style="color: #990000">),</span>
                           file<span style="color: #990000">.</span>path<span style="color: #990000">(</span><span style="color: #FF0000">"src"</span><span style="color: #990000">,</span> <span style="color: #FF0000">"test_my_sum_assertion.R"</span><span style="color: #990000">))</span>
print<span style="color: #990000">(</span>cov<span style="color: #990000">)</span></tt></pre></div></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.7
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt>## Coverage<span style="color: #990000">:</span> <span style="color: #993399">100.00</span><span style="color: #990000">%</span>
</tt></pre></div></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.7
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt>## src<span style="color: #990000">/</span>my_sum_assertion<span style="color: #990000">.</span>R<span style="color: #990000">:</span> <span style="color: #993399">100.00</span><span style="color: #990000">%</span>
</tt></pre></div></div>
<div class="paragraph"><p>Wenn Du eine Funktion schreibst, in der eine Zeile eingebaut ist, die der Test nicht
erreicht, weist Dich <a href="https://CRAN.R-project.org/package=covr">covr</a> darauf hin:</p></div>
<div class="listingblock">
<div class="title">src/my_sum_coverage.R</div>
<div class="content"><!-- Generator: GNU source-highlight 3.1.7
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt>my_sum <span style="color: #990000">&lt;-</span> function<span style="color: #990000">(</span>x<span style="color: #990000">)</span> {
<span style="font-weight: bold"><span style="color: #000080">    assertthat:</span></span><span style="color: #990000">:</span>assert_that<span style="color: #990000">(</span>is<span style="color: #990000">.</span>numeric<span style="color: #990000">(</span>x<span style="color: #990000">))</span>
    if <span style="color: #990000">(!</span> is<span style="color: #990000">.</span>numeric<span style="color: #990000">(</span>x<span style="color: #990000">))</span> message<span style="color: #990000">(</span><span style="color: #FF0000">"You'll never get here!"</span><span style="color: #990000">)</span>
    value <span style="color: #990000">&lt;-</span> <span style="color: #993399">0</span>
    for <span style="color: #990000">(</span>x_i <span style="font-weight: bold"><span style="color: #0000FF">in</span></span> x<span style="color: #990000">)</span> {
        value <span style="color: #990000">&lt;-</span> value <span style="color: #990000">+</span> x_i
    }
    return<span style="color: #990000">(</span>value<span style="color: #990000">)</span>
}</tt></pre></div></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.7
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt>cov <span style="color: #990000">&lt;-</span> covr<span style="color: #990000">::</span>file_coverage<span style="color: #990000">(</span>file<span style="color: #990000">.</span>path<span style="color: #990000">(</span><span style="color: #FF0000">"src"</span><span style="color: #990000">,</span> <span style="color: #FF0000">"my_sum_coverage.R"</span><span style="color: #990000">),</span>
                           file<span style="color: #990000">.</span>path<span style="color: #990000">(</span><span style="color: #FF0000">"src"</span><span style="color: #990000">,</span> <span style="color: #FF0000">"test_my_sum_assertion.R"</span><span style="color: #990000">))</span>
print<span style="color: #990000">(</span>cov<span style="color: #990000">)</span></tt></pre></div></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.7
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt>## Coverage<span style="color: #990000">:</span> <span style="color: #993399">83.33</span><span style="color: #990000">%</span>
</tt></pre></div></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.7
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt>## src<span style="color: #990000">/</span>my_sum_coverage<span style="color: #990000">.</span>R<span style="color: #990000">:</span> <span style="color: #993399">83.33</span><span style="color: #990000">%</span>
</tt></pre></div></div>
<div class="paragraph"><p><a href="https://CRAN.R-project.org/package=covr">covr</a> sagt Dir sogar, dass es die dritte Zeile ist:</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.7
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="font-weight: bold"><span style="color: #000080">covr:</span></span><span style="color: #990000">:</span>zero_coverage<span style="color: #990000">(</span>cov<span style="color: #990000">)</span></tt></pre></div></div>
<div class="listingblock">
<div class="content">
<pre><code>##                filename functions line value
## 2 src/my_sum_coverage.R    my_sum    3     0</code></pre>
</div></div>
</div>
<div class="sect3">
<h4 id="_nebenwirkungen_testen">3.2.3. Nebenwirkungen testen</h4>
<div class="paragraph"><p>Funktionen sind relativ einfach zu testen, wenn ihr Rückgabewert ihr Zweck ist.
Wenn sie aber Nebenwirkungen bezwecken, finde ich Tests schwieriger zu schreiben.</p></div>
<div class="paragraph"><p>Stell Dir vor, Du hättest die fehlerhafte Löschfunktion aus
<a href="#_arbeiten_mit_gültigkeitsbereichen">Arbeiten mit Gültigkeitsbereichen</a>
in eine Datei geschrieben:</p></div>
<div class="listingblock">
<div class="title">src/wipe_clean_broken.R</div>
<div class="content"><!-- Generator: GNU source-highlight 3.1.7
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt>wipe_clean <span style="color: #990000">&lt;-</span> function<span style="color: #990000">(</span>environment <span style="color: #990000">=</span> parent<span style="color: #990000">.</span>frame<span style="color: #990000">())</span> {
    objects <span style="color: #990000">&lt;-</span> ls<span style="color: #990000">(</span><span style="font-weight: bold"><span style="color: #0000FF">name</span></span> <span style="color: #990000">=</span> environment<span style="color: #990000">,</span> all<span style="color: #990000">.</span>names <span style="color: #990000">=</span> TRUE<span style="color: #990000">)</span>
    # FIXME<span style="color: #990000">:</span> rm<span style="color: #990000">()</span> by default removes objects from
    # the current frame<span style="color: #990000">,</span> which is <span style="font-weight: bold"><span style="color: #0000FF">this</span></span> function<span style="color: #990000">,</span> <span style="font-weight: bold"><span style="color: #0000FF">not</span></span> the parent frame<span style="color: #990000">!</span>
    rm<span style="color: #990000">(</span>list <span style="color: #990000">=</span> objects<span style="color: #990000">)</span>
    return<span style="color: #990000">(</span>invisible<span style="color: #990000">(</span>objects<span style="color: #990000">))</span>
}</tt></pre></div></div>
<div class="paragraph"><p>Nun schreibst Du eine Testdatei:</p></div>
<div class="listingblock">
<div class="title">src/test_wipe_clean_broken.R</div>
<div class="content"><!-- Generator: GNU source-highlight 3.1.7
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="font-weight: bold"><span style="color: #000080">testthat:</span></span><span style="color: #990000">:</span>test_that<span style="color: #990000">(</span><span style="color: #FF0000">"Test return value."</span><span style="color: #990000">,</span> {
                    a <span style="color: #990000">&lt;-</span> <span style="color: #993399">3</span>
<span style="font-weight: bold"><span style="color: #000080">                    testthat:</span></span><span style="color: #990000">:</span>expect_identical<span style="color: #990000">(</span>wipe_clean<span style="color: #990000">(),</span>
                                               c<span style="color: #990000">(</span><span style="color: #FF0000">"a"</span><span style="color: #990000">))</span>}
                    <span style="color: #990000">)</span></tt></pre></div></div>
<div class="paragraph"><p>Und erhälst vollständige Überdeckung:</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.7
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt>cov <span style="color: #990000">&lt;-</span> covr<span style="color: #990000">::</span>file_coverage<span style="color: #990000">(</span>file<span style="color: #990000">.</span>path<span style="color: #990000">(</span><span style="color: #FF0000">"src"</span><span style="color: #990000">,</span> <span style="color: #FF0000">"wipe_clean_broken.R"</span><span style="color: #990000">),</span>
                           file<span style="color: #990000">.</span>path<span style="color: #990000">(</span><span style="color: #FF0000">"src"</span><span style="color: #990000">,</span> <span style="color: #FF0000">"test_wipe_clean_broken.R"</span><span style="color: #990000">))</span>
print<span style="color: #990000">(</span>cov<span style="color: #990000">)</span></tt></pre></div></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.7
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt>## Coverage<span style="color: #990000">:</span> <span style="color: #993399">100.00</span><span style="color: #990000">%</span>
</tt></pre></div></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.7
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt>## src<span style="color: #990000">/</span>wipe_clean_broken<span style="color: #990000">.</span>R<span style="color: #990000">:</span> <span style="color: #993399">100.00</span><span style="color: #990000">%</span>
</tt></pre></div></div>
<div class="paragraph"><p>Alles gut? Nein, die Funktion ist kaputt und die Testdatei, die dies zeigt müsste
auf die Nebenwirkung testen:</p></div>
<div class="listingblock">
<div class="title">src/test_wipe_clean.R</div>
<div class="content"><!-- Generator: GNU source-highlight 3.1.7
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="font-weight: bold"><span style="color: #000080">testthat:</span></span><span style="color: #990000">:</span>test_that<span style="color: #990000">(</span><span style="color: #FF0000">"Test return value and side effects."</span><span style="color: #990000">,</span> {
                    a <span style="color: #990000">&lt;-</span> <span style="color: #993399">3</span>
<span style="font-weight: bold"><span style="color: #000080">                    testthat:</span></span><span style="color: #990000">:</span>expect_identical<span style="color: #990000">(</span>wipe_clean<span style="color: #990000">(),</span> c<span style="color: #990000">(</span><span style="color: #FF0000">"a"</span><span style="color: #990000">))</span>
<span style="font-weight: bold"><span style="color: #000080">                    testthat:</span></span><span style="color: #990000">:</span>expect_identical<span style="color: #990000">(</span>ls<span style="color: #990000">(),</span> character<span style="color: #990000">(</span><span style="color: #993399">0</span><span style="color: #990000">))</span>}
                    <span style="color: #990000">)</span></tt></pre></div></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.7
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="font-weight: bold"><span style="color: #000080">covr:</span></span><span style="color: #990000">:</span>file_coverage<span style="color: #990000">(</span>file<span style="color: #990000">.</span>path<span style="color: #990000">(</span><span style="color: #FF0000">"src"</span><span style="color: #990000">,</span> <span style="color: #FF0000">"wipe_clean_broken.R"</span><span style="color: #990000">),</span>
                    file<span style="color: #990000">.</span>path<span style="color: #990000">(</span><span style="color: #FF0000">"src"</span><span style="color: #990000">,</span> <span style="color: #FF0000">"test_wipe_clean.R"</span><span style="color: #990000">))</span></tt></pre></div></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.7
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt>## Error<span style="color: #990000">:</span> <span style="font-weight: bold"><span style="color: #0000FF">Test</span></span> failed<span style="color: #990000">:</span> <span style="color: #FF0000">'Test return value and side effects.'</span>
## <span style="color: #990000">*</span> ls<span style="color: #990000">()</span> <span style="font-weight: bold"><span style="color: #0000FF">not</span></span> identical to character<span style="color: #990000">(</span><span style="color: #993399">0</span><span style="color: #990000">).</span>
## Lengths differ<span style="color: #990000">:</span> <span style="color: #993399">1</span> is <span style="font-weight: bold"><span style="color: #0000FF">not</span></span> <span style="color: #993399">0</span>
</tt></pre></div></div>
</div>
<div class="sect3">
<h4 id="_was_soll_die_ganze_testerei">3.2.4. Was soll die ganze Testerei?</h4>
<div class="paragraph"><p>Stell Dir vor, Du erstelltest öfter Abbildungen.
Jetzt bist Du ein Mensch mit einem Gefühl für Harmonien,
daher willst Du gerne, wenn möglich, den
<a href="https://de.wikipedia.org/wiki/Goldener_Schnitt">Goldenen Schnitt</a> bei der
Wahl der Zuschnitte berücksichtigen.</p></div>
<div class="paragraph"><p>Da Du Dir den Goldenen Schnitt nicht gut merken kannst, schreibst Du folgende Funktion:</p></div>
<div class="listingblock">
<div class="title">src/golden_ratio.R</div>
<div class="content"><!-- Generator: GNU source-highlight 3.1.7
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt>golden_ratio  <span style="color: #990000">&lt;-</span> function<span style="color: #990000">()</span> {
    phi <span style="color: #990000">&lt;-</span> <span style="color: #990000">(</span><span style="color: #993399">1</span> <span style="color: #990000">+</span> sqrt<span style="color: #990000">(</span><span style="color: #993399">5</span><span style="color: #990000">))</span> <span style="color: #990000">/</span> <span style="color: #993399">2</span>
    return<span style="color: #990000">(</span>phi<span style="color: #990000">)</span>
}</tt></pre></div></div>
<div class="paragraph"><p>Das ginge auch als Einzeiler:</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.7
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt>golden_ratio  <span style="color: #990000">&lt;-</span> function<span style="color: #990000">()</span> return<span style="color: #990000">((</span><span style="color: #993399">1</span> <span style="color: #990000">+</span> sqrt<span style="color: #990000">(</span><span style="color: #993399">5</span><span style="color: #990000">))</span> <span style="color: #990000">/</span> <span style="color: #993399">2</span><span style="color: #990000">)</span></tt></pre></div></div>
<div class="paragraph"><p>aber den findest Du auch nicht viel eleganter, dafür aber schlechter lesbar.</p></div>
<div class="paragraph"><p>Du schreibst auch einen Test, obwohl der ziemlich trivial ist:</p></div>
<div class="listingblock">
<div class="title">src/test_golden_ratio.R</div>
<div class="content"><!-- Generator: GNU source-highlight 3.1.7
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="font-weight: bold"><span style="color: #000080">testthat:</span></span><span style="color: #990000">:</span>test_that<span style="color: #990000">(</span><span style="color: #FF0000">"Test on Golden Ratio"</span><span style="color: #990000">,</span> {
                        expectation <span style="color: #990000">&lt;-</span> <span style="color: #990000">(</span><span style="color: #993399">1</span> <span style="color: #990000">+</span> sqrt<span style="color: #990000">(</span><span style="color: #993399">5</span><span style="color: #990000">))</span> <span style="color: #990000">/</span> <span style="color: #993399">2</span>
                        result <span style="color: #990000">&lt;-</span> golden_ratio<span style="color: #990000">()</span>
<span style="font-weight: bold"><span style="color: #000080">                        testthat:</span></span><span style="color: #990000">:</span>expect_identical<span style="color: #990000">(</span>result<span style="color: #990000">,</span> expectation<span style="color: #990000">)</span>
}<span style="color: #990000">)</span></tt></pre></div></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.7
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="font-weight: bold"><span style="color: #000080">covr:</span></span><span style="color: #990000">:</span>file_coverage<span style="color: #990000">(</span>file<span style="color: #990000">.</span>path<span style="color: #990000">(</span><span style="color: #FF0000">"src"</span><span style="color: #990000">,</span> <span style="color: #FF0000">"golden_ratio.R"</span><span style="color: #990000">),</span>
                    file<span style="color: #990000">.</span>path<span style="color: #990000">(</span><span style="color: #FF0000">"src"</span><span style="color: #990000">,</span> <span style="color: #FF0000">"test_golden_ratio.R"</span><span style="color: #990000">))</span></tt></pre></div></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.7
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt>## Coverage<span style="color: #990000">:</span> <span style="color: #993399">100.00</span><span style="color: #990000">%</span>
</tt></pre></div></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.7
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt>## src<span style="color: #990000">/</span>golden_ratio<span style="color: #990000">.</span>R<span style="color: #990000">:</span> <span style="color: #993399">100.00</span><span style="color: #990000">%</span>
</tt></pre></div></div>
<div class="paragraph"><p>Wenn Du Graphiken nach dem Goldenen Schnitt proportionieren willst, musst Du bei
gegebener Länge der kurzen Seite diese mit dem Goldenen Schnitt multipizieren
um die Länge der langen Seite zu erhalten.</p></div>
<div class="paragraph"><p>Das ist eigentlich nicht allzu kompliziert, dennoch kommst Du manchmal durcheinander,
also schreibst Du die folgende Funktion:</p></div>
<div class="listingblock">
<div class="title">src/golden_rectangle.R</div>
<div class="content"><!-- Generator: GNU source-highlight 3.1.7
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt>golden_rectangle  <span style="color: #990000">&lt;-</span> function<span style="color: #990000">(</span>b<span style="color: #990000">)</span> {
    a <span style="color: #990000">&lt;-</span> b <span style="color: #990000">*</span> golden_ratio<span style="color: #990000">()</span>
    return<span style="color: #990000">(</span>c<span style="color: #990000">(</span><span style="color: #FF0000">"a"</span> <span style="color: #990000">=</span> a<span style="color: #990000">,</span> <span style="color: #FF0000">"b"</span> <span style="color: #990000">=</span> b<span style="color: #990000">))</span>
}</tt></pre></div></div>
<div class="paragraph"><p>Auch für diese Funktion schreibst Du einen Test:</p></div>
<div class="listingblock">
<div class="title">src/test_golden_rectangle.R</div>
<div class="content"><!-- Generator: GNU source-highlight 3.1.7
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="font-weight: bold"><span style="color: #000080">testthat:</span></span><span style="color: #990000">:</span>test_that<span style="color: #990000">(</span><span style="color: #FF0000">"Test on golden rectangle"</span><span style="color: #990000">,</span> {
                        b <span style="color: #990000">&lt;-</span> <span style="color: #993399">2</span>
                        expectation <span style="color: #990000">&lt;-</span> c<span style="color: #990000">(</span>a <span style="color: #990000">=</span> b <span style="color: #990000">*</span> golden_ratio<span style="color: #990000">(),</span> b <span style="color: #990000">=</span> b<span style="color: #990000">)</span>
                        result <span style="color: #990000">&lt;-</span> golden_rectangle<span style="color: #990000">(</span>b<span style="color: #990000">)</span>
<span style="font-weight: bold"><span style="color: #000080">                        testthat:</span></span><span style="color: #990000">:</span>expect_identical<span style="color: #990000">(</span>result<span style="color: #990000">,</span> expectation<span style="color: #990000">)</span>
}<span style="color: #990000">)</span></tt></pre></div></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.7
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="font-weight: bold"><span style="color: #000080">covr:</span></span><span style="color: #990000">:</span>file_coverage<span style="color: #990000">(</span>file<span style="color: #990000">.</span>path<span style="color: #990000">(</span><span style="color: #FF0000">"src"</span><span style="color: #990000">,</span> c<span style="color: #990000">(</span><span style="color: #FF0000">"golden_ratio.R"</span><span style="color: #990000">,</span> <span style="color: #FF0000">"golden_rectangle.R"</span><span style="color: #990000">)),</span>
                    file<span style="color: #990000">.</span>path<span style="color: #990000">(</span><span style="color: #FF0000">"src"</span><span style="color: #990000">,</span> <span style="color: #FF0000">"test_golden_rectangle.R"</span><span style="color: #990000">))</span></tt></pre></div></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.7
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt>## Coverage<span style="color: #990000">:</span> <span style="color: #993399">100.00</span><span style="color: #990000">%</span>
</tt></pre></div></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.7
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt>## src<span style="color: #990000">/</span>golden_ratio<span style="color: #990000">.</span>R<span style="color: #990000">:</span> <span style="color: #993399">100.00</span><span style="color: #990000">%</span>
</tt></pre></div></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.7
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt>## src<span style="color: #990000">/</span>golden_rectangle<span style="color: #990000">.</span>R<span style="color: #990000">:</span> <span style="color: #993399">100.00</span><span style="color: #990000">%</span>
</tt></pre></div></div>
<div class="paragraph"><p>Du benutzt die Funtktion &#8230;</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.7
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt>source<span style="color: #990000">(</span>file<span style="color: #990000">.</span>path<span style="color: #990000">(</span><span style="color: #FF0000">"src"</span><span style="color: #990000">,</span> <span style="color: #FF0000">"golden_ratio.R"</span><span style="color: #990000">))</span>
<span style="font-weight: bold"><span style="color: #0000FF">width</span></span> <span style="color: #990000">&lt;-</span> <span style="color: #993399">2</span>
png<span style="color: #990000">(</span><span style="color: #FF0000">"p1.png"</span><span style="color: #990000">,</span> units <span style="color: #990000">=</span> <span style="color: #FF0000">"cm"</span><span style="color: #990000">,</span> res <span style="color: #990000">=</span> <span style="color: #993399">400</span><span style="color: #990000">,</span>
    <span style="font-weight: bold"><span style="color: #0000FF">width</span></span> <span style="color: #990000">=</span> <span style="font-weight: bold"><span style="color: #0000FF">width</span></span><span style="color: #990000">,</span>
    height <span style="color: #990000">=</span> golden_rectangle<span style="color: #990000">(</span><span style="font-weight: bold"><span style="color: #0000FF">width</span></span><span style="color: #990000">)[[</span><span style="color: #FF0000">"a"</span><span style="color: #990000">]])</span>
par<span style="color: #990000">(</span>mar<span style="color: #990000">=</span>c<span style="color: #990000">(</span><span style="color: #993399">1</span><span style="color: #990000">,</span><span style="color: #993399">1</span><span style="color: #990000">,</span><span style="color: #993399">1</span><span style="color: #990000">,</span><span style="color: #993399">1</span><span style="color: #990000">))</span>
plot<span style="color: #990000">(</span>cars<span style="color: #990000">)</span>
dev<span style="color: #990000">.</span>off<span style="color: #990000">()</span></tt></pre></div></div>
<div class="listingblock">
<div class="content">
<pre><code>## pdf
##   2</code></pre>
</div></div>
<div class="paragraph"><p>und bist begeistert:</p></div>
<div class="imageblock">
<div class="content">
<img alt="p1.png"
src="data:image/png;base64,
iVBORw0KGgoAAAANSUhEUgAAAJ0AAAD+CAMAAAAXmPcQAAADAFBMVEUAAAABAQECAgIDAwMEBAQF
BQUGBgYHBwcICAgJCQkKCgoLCwsMDAwNDQ0ODg4PDw8QEBARERESEhITExMUFBQVFRUWFhYXFxcY
GBgZGRkaGhobGxscHBwdHR0eHh4fHx8gICAhISEiIiIjIyMkJCQlJSUmJiYnJycoKCgpKSkqKior
KyssLCwtLS0uLi4vLy8wMDAxMTEyMjIzMzM0NDQ1NTU2NjY3Nzc4ODg5OTk6Ojo7Ozs8PDw9PT0+
Pj4/Pz9AQEBBQUFCQkJDQ0NERERFRUVGRkZHR0dISEhJSUlKSkpLS0tMTExNTU1OTk5PT09QUFBR
UVFSUlJTU1NUVFRVVVVWVlZXV1dYWFhZWVlaWlpbW1tcXFxdXV1eXl5fX19gYGBhYWFiYmJjY2Nk
ZGRlZWVmZmZnZ2doaGhpaWlqampra2tsbGxtbW1ubm5vb29wcHBxcXFycnJzc3N0dHR1dXV2dnZ3
d3d4eHh5eXl6enp7e3t8fHx9fX1+fn5/f3+AgICBgYGCgoKDg4OEhISFhYWGhoaHh4eIiIiJiYmK
ioqLi4uMjIyNjY2Ojo6Pj4+QkJCRkZGSkpKTk5OUlJSVlZWWlpaXl5eYmJiZmZmampqbm5ucnJyd
nZ2enp6fn5+goKChoaGioqKjo6OkpKSlpaWmpqanp6eoqKipqamqqqqrq6usrKytra2urq6vr6+w
sLCxsbGysrKzs7O0tLS1tbW2tra3t7e4uLi5ubm6urq7u7u8vLy9vb2+vr6/v7/AwMDBwcHCwsLD
w8PExMTFxcXGxsbHx8fIyMjJycnKysrLy8vMzMzNzc3Ozs7Pz8/Q0NDR0dHS0tLT09PU1NTV1dXW
1tbX19fY2NjZ2dna2trb29vc3Nzd3d3e3t7f39/g4ODh4eHi4uLj4+Pk5OTl5eXm5ubn5+fo6Ojp
6enq6urr6+vs7Ozt7e3u7u7v7+/w8PDx8fHy8vLz8/P09PT19fX29vb39/f4+Pj5+fn6+vr7+/v8
/Pz9/f3+/v7////isF19AAAACXBIWXMAAB7CAAAewgFu0HU+AAAR+ElEQVR4nO2dCVQUx7rH/z0r
DIggKPvmgqIIuOAeBfQqmmjcQVHiFuMSfQnGuMToi1GjSdyNMS7EJQaXuCZGo4kIeXqJV9So8WlY
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" />
</div>
<div class="title">Figure 1. Oh, wie schön!</div>
</div>
<div class="paragraph"><p>Du benutzt die Funktion eine Weile weiter, merkst dann aber, dass Du ja auch querformatige
Abbildungen erstellen willst und daher
bei gegebener Länge der
langen Seite diese durch den Goldenen Schnitt dividieren musst, um die Länge
der kurzen Seite zu erhalten.</p></div>
<div class="paragraph"><p>Jetzt kannst Du entweder eine neue Funktion schreiben oder die alte erweitern.
Da die Funktionalitäten zum selben Thema passen und <code>golden_rectangle</code> bislang
recht simpel ist, schreibst Du Deine Funktion also um:</p></div>
<div class="listingblock">
<div class="title">src/golden_rectangle.R</div>
<div class="content"><!-- Generator: GNU source-highlight 3.1.7
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt>golden_rectangle  <span style="color: #990000">&lt;-</span> function<span style="color: #990000">(</span>value<span style="color: #990000">,</span> landscape <span style="color: #990000">=</span> TRUE<span style="color: #990000">)</span> {
    phi <span style="color: #990000">&lt;-</span> golden_ratio<span style="color: #990000">()</span>
    if <span style="color: #990000">(</span>isTRUE<span style="color: #990000">(</span>landscape<span style="color: #990000">))</span> {
        a  <span style="color: #990000">&lt;-</span> value
        b <span style="color: #990000">&lt;-</span> a <span style="color: #990000">/</span> phi
    } else {
        b <span style="color: #990000">&lt;-</span> value
        a <span style="color: #990000">&lt;-</span> b <span style="color: #990000">*</span> phi
    }
    return<span style="color: #990000">(</span>c<span style="color: #990000">(</span><span style="color: #FF0000">"a"</span> <span style="color: #990000">=</span> a<span style="color: #990000">,</span> <span style="color: #FF0000">"b"</span> <span style="color: #990000">=</span> b<span style="color: #990000">))</span>
}</tt></pre></div></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.7
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="font-weight: bold"><span style="color: #0000FF">width</span></span> <span style="color: #990000">&lt;-</span> <span style="color: #993399">4</span>
png<span style="color: #990000">(</span><span style="color: #FF0000">"p2.png"</span><span style="color: #990000">,</span> units <span style="color: #990000">=</span> <span style="color: #FF0000">"cm"</span><span style="color: #990000">,</span> res <span style="color: #990000">=</span> <span style="color: #993399">400</span><span style="color: #990000">,</span>
    <span style="font-weight: bold"><span style="color: #0000FF">width</span></span> <span style="color: #990000">=</span> <span style="font-weight: bold"><span style="color: #0000FF">width</span></span><span style="color: #990000">,</span>
    height <span style="color: #990000">=</span> golden_rectangle<span style="color: #990000">(</span><span style="font-weight: bold"><span style="color: #0000FF">width</span></span><span style="color: #990000">)[[</span><span style="color: #FF0000">"b"</span><span style="color: #990000">]])</span>
par<span style="color: #990000">(</span>mar<span style="color: #990000">=</span>c<span style="color: #990000">(</span><span style="color: #993399">1</span><span style="color: #990000">,</span><span style="color: #993399">1</span><span style="color: #990000">,</span><span style="color: #993399">1</span><span style="color: #990000">,</span><span style="color: #993399">1</span><span style="color: #990000">))</span>
plot<span style="color: #990000">(</span>cars<span style="color: #990000">)</span>
dev<span style="color: #990000">.</span>off<span style="color: #990000">()</span></tt></pre></div></div>
<div class="listingblock">
<div class="content">
<pre><code>## pdf
##   2</code></pre>
</div></div>
<div class="imageblock">
<div class="content">
<img alt="p2.png"
src="data:image/png;base64,
iVBORw0KGgoAAAANSUhEUgAAAToAAADCCAMAAADuKv6uAAADAFBMVEUAAAABAQECAgIDAwMEBAQF
BQUGBgYHBwcICAgJCQkKCgoLCwsMDAwNDQ0ODg4PDw8QEBARERESEhITExMUFBQVFRUWFhYXFxcY
GBgZGRkaGhobGxscHBwdHR0eHh4fHx8gICAhISEiIiIjIyMkJCQlJSUmJiYnJycoKCgpKSkqKior
KyssLCwtLS0uLi4vLy8wMDAxMTEyMjIzMzM0NDQ1NTU2NjY3Nzc4ODg5OTk6Ojo7Ozs8PDw9PT0+
Pj4/Pz9AQEBBQUFCQkJDQ0NERERFRUVGRkZHR0dISEhJSUlKSkpLS0tMTExNTU1OTk5PT09QUFBR
UVFSUlJTU1NUVFRVVVVWVlZXV1dYWFhZWVlaWlpbW1tcXFxdXV1eXl5fX19gYGBhYWFiYmJjY2Nk
ZGRlZWVmZmZnZ2doaGhpaWlqampra2tsbGxtbW1ubm5vb29wcHBxcXFycnJzc3N0dHR1dXV2dnZ3
d3d4eHh5eXl6enp7e3t8fHx9fX1+fn5/f3+AgICBgYGCgoKDg4OEhISFhYWGhoaHh4eIiIiJiYmK
ioqLi4uMjIyNjY2Ojo6Pj4+QkJCRkZGSkpKTk5OUlJSVlZWWlpaXl5eYmJiZmZmampqbm5ucnJyd
nZ2enp6fn5+goKChoaGioqKjo6OkpKSlpaWmpqanp6eoqKipqamqqqqrq6usrKytra2urq6vr6+w
sLCxsbGysrKzs7O0tLS1tbW2tra3t7e4uLi5ubm6urq7u7u8vLy9vb2+vr6/v7/AwMDBwcHCwsLD
w8PExMTFxcXGxsbHx8fIyMjJycnKysrLy8vMzMzNzc3Ozs7Pz8/Q0NDR0dHS0tLT09PU1NTV1dXW
1tbX19fY2NjZ2dna2trb29vc3Nzd3d3e3t7f39/g4ODh4eHi4uLj4+Pk5OTl5eXm5ubn5+fo6Ojp
6enq6urr6+vs7Ozt7e3u7u7v7+/w8PDx8fHy8vLz8/P09PT19fX29vb39/f4+Pj5+fn6+vr7+/v8
/Pz9/f3+/v7////isF19AAAACXBIWXMAAB7CAAAewgFu0HU+AAAZuUlEQVR4nO1dB1wUxxf+9u44
uhQRBQEVQRRErKDBgiVGRWONLfYWG0ajJnbUWBJLokn82zXGGo2JjaixaxJTbCHG3qMQFStSpNz+
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" />
</div>
<div class="title">Figure 2. Auch sehr schön!</div>
</div>
<div class="paragraph"><p>Herzlichen Glückwunsch, Du hast gerade die <a href="https://en.wikipedia.org/wiki/Application_programming_interface">Schnittstelle</a> Deiner Funktion zerschossen, indem Du ihr voreingestelltes Verhalten geändert hast.
Glücklicherweise hast Du einen Test, der Dir jetzt um die Ohren fliegt:</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.7
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="font-weight: bold"><span style="color: #000080">covr:</span></span><span style="color: #990000">:</span>file_coverage<span style="color: #990000">(</span>file<span style="color: #990000">.</span>path<span style="color: #990000">(</span><span style="color: #FF0000">"src"</span><span style="color: #990000">,</span> <span style="color: #FF0000">"golden_rectangle.R"</span><span style="color: #990000">),</span>
                    file<span style="color: #990000">.</span>path<span style="color: #990000">(</span><span style="color: #FF0000">"src"</span><span style="color: #990000">,</span> <span style="color: #FF0000">"test_golden_rectangle.R"</span><span style="color: #990000">))</span></tt></pre></div></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.7
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt>## Error<span style="color: #990000">:</span> <span style="font-weight: bold"><span style="color: #0000FF">Test</span></span> failed<span style="color: #990000">:</span> <span style="color: #FF0000">'Test on golden rectangle'</span>
## <span style="color: #990000">*</span> `result` <span style="font-weight: bold"><span style="color: #0000FF">not</span></span> identical to `expectation`<span style="color: #990000">.</span>
## <span style="color: #993399">2</span><span style="color: #990000">/</span><span style="color: #993399">2</span> mismatches <span style="color: #990000">(</span>average diff<span style="color: #990000">:</span> <span style="color: #993399">1</span><span style="color: #990000">)</span>
## <span style="color: #990000">[</span><span style="color: #993399">1</span><span style="color: #990000">]</span> <span style="color: #993399">2.00</span> <span style="color: #990000">-</span> <span style="color: #993399">3.24</span> <span style="color: #990000">==</span> <span style="color: #990000">-</span><span style="color: #993399">1.236</span>
## <span style="color: #990000">[</span><span style="color: #993399">2</span><span style="color: #990000">]</span> <span style="color: #993399">1.24</span> <span style="color: #990000">-</span> <span style="color: #993399">2.00</span> <span style="color: #990000">==</span> <span style="color: #990000">-</span><span style="color: #993399">0.764</span>
</tt></pre></div></div>
<div class="paragraph"><p>Was bedeutet das?
Du musst entweder</p></div>
<div class="ulist"><ul>
<li>
<p>
<strong>alle</strong> Aufrufe der Funktion, die Du vor der Veränderung ihrer Schnittstelle progammiert hast,
  anpassen (indem Du <code>, landscape = FALSE</code> einfügst) oder
</p>
</li>
<li>
<p>
die Funktion so ändern, dass die Schnittstelle stabil bleibt (und der Test weiterhin funktioniert).
</p>
</li>
</ul></div>
<div class="paragraph"><p>Du entscheidest Dich, die Funktion zu ändern:</p></div>
<div class="listingblock">
<div class="title">src/golden_rectangle.R</div>
<div class="content"><!-- Generator: GNU source-highlight 3.1.7
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt>golden_rectangle  <span style="color: #990000">&lt;-</span> function<span style="color: #990000">(</span>value<span style="color: #990000">,</span> landscape <span style="color: #990000">=</span> FALSE<span style="color: #990000">)</span> {
    phi <span style="color: #990000">&lt;-</span> golden_ratio<span style="color: #990000">()</span>
    if <span style="color: #990000">(</span>isTRUE<span style="color: #990000">(</span>landscape<span style="color: #990000">))</span> {
        a  <span style="color: #990000">&lt;-</span> value
        b <span style="color: #990000">&lt;-</span> a <span style="color: #990000">/</span> phi
    } else {
        b <span style="color: #990000">&lt;-</span> value
        a <span style="color: #990000">&lt;-</span> b <span style="color: #990000">*</span> phi
    }
    return<span style="color: #990000">(</span>c<span style="color: #990000">(</span><span style="color: #FF0000">"a"</span> <span style="color: #990000">=</span> a<span style="color: #990000">,</span> <span style="color: #FF0000">"b"</span> <span style="color: #990000">=</span> b<span style="color: #990000">))</span>
}</tt></pre></div></div>
<div class="paragraph"><p>Um Querformatige Proportionen zu erhalten musst Du nun aktiv Querformat einstellen:
<code>golden_rectangle(width, landscape = TRUE)</code></p></div>
<div class="paragraph"><p>Der Test funktioniert wieder, da Du aber die Funktion geändert hast, überdeckt
er sie nicht mehr vollständig:</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.7
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="font-weight: bold"><span style="color: #000080">covr:</span></span><span style="color: #990000">:</span>file_coverage<span style="color: #990000">(</span>file<span style="color: #990000">.</span>path<span style="color: #990000">(</span><span style="color: #FF0000">"src"</span><span style="color: #990000">,</span> <span style="color: #FF0000">"golden_rectangle.R"</span><span style="color: #990000">),</span>
                    file<span style="color: #990000">.</span>path<span style="color: #990000">(</span><span style="color: #FF0000">"src"</span><span style="color: #990000">,</span> <span style="color: #FF0000">"test_golden_rectangle.R"</span><span style="color: #990000">))</span></tt></pre></div></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.7
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt>## Coverage<span style="color: #990000">:</span> <span style="color: #993399">71.43</span><span style="color: #990000">%</span>
</tt></pre></div></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.7
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt>## src<span style="color: #990000">/</span>golden_rectangle<span style="color: #990000">.</span>R<span style="color: #990000">:</span> <span style="color: #993399">71.43</span><span style="color: #990000">%</span>
</tt></pre></div></div>
<div class="paragraph"><p>Du erweiterst also Deine Testdatei an:</p></div>
<div class="listingblock">
<div class="title">src/test_golden_rectangle.R</div>
<div class="content"><!-- Generator: GNU source-highlight 3.1.7
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt>golden_rectangle  <span style="color: #990000">&lt;-</span> function<span style="color: #990000">(</span>value<span style="color: #990000">,</span> landscape <span style="color: #990000">=</span> FALSE<span style="color: #990000">)</span> {
    phi <span style="color: #990000">&lt;-</span> golden_ratio<span style="color: #990000">()</span>
    if <span style="color: #990000">(</span>isTRUE<span style="color: #990000">(</span>landscape<span style="color: #990000">))</span> {
        a  <span style="color: #990000">&lt;-</span> value
        b <span style="color: #990000">&lt;-</span> a <span style="color: #990000">/</span> phi
    } else {
        b <span style="color: #990000">&lt;-</span> value
        a <span style="color: #990000">&lt;-</span> b <span style="color: #990000">*</span> phi
    }
    return<span style="color: #990000">(</span>c<span style="color: #990000">(</span><span style="color: #FF0000">"a"</span> <span style="color: #990000">=</span> a<span style="color: #990000">,</span> <span style="color: #FF0000">"b"</span> <span style="color: #990000">=</span> b<span style="color: #990000">))</span>
}</tt></pre></div></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.7
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="font-weight: bold"><span style="color: #000080">covr:</span></span><span style="color: #990000">:</span>file_coverage<span style="color: #990000">(</span>file<span style="color: #990000">.</span>path<span style="color: #990000">(</span><span style="color: #FF0000">"src"</span><span style="color: #990000">,</span> <span style="color: #FF0000">"golden_rectangle.R"</span><span style="color: #990000">),</span>
                    file<span style="color: #990000">.</span>path<span style="color: #990000">(</span><span style="color: #FF0000">"src"</span><span style="color: #990000">,</span> <span style="color: #FF0000">"test_golden_rectangle.R"</span><span style="color: #990000">))</span></tt></pre></div></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.7
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt>## Coverage<span style="color: #990000">:</span> <span style="color: #993399">100.00</span><span style="color: #990000">%</span>
</tt></pre></div></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.7
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt>## src<span style="color: #990000">/</span>golden_rectangle<span style="color: #990000">.</span>R<span style="color: #990000">:</span> <span style="color: #993399">100.00</span><span style="color: #990000">%</span>
</tt></pre></div></div>
<div class="paragraph"><p><code>golden_rectangle</code> habe ich mir nur ausgedacht, um Dir mein Vorgehen zu verdeutlichen. Aber:</p></div>
<div class="paragraph"><p><em>Ich teste fast alle meine Funktion nach genau dem Ablauf in diesem Abschnitt spätestens,
wenn ich sie in ein Paket verpacke.</em></p></div>
</div>
</div>
<div class="sect2">
<h3 id="_weniger_schlecht_programmieren">3.3. Weniger schlecht programmieren</h3>
<div class="paragraph"><p>Ich möchte Dir gerne noch drei Funktionen aus drei verschiedenen Paketen vorstellen,
die Dir helfen können, gut lesbare Funktionen zu schreiben.</p></div>
<div class="paragraph"><p><em>Ich nutze alle drei standardmäßig bei der Entwicklung von Paketen.</em></p></div>
<div class="paragraph"><p>Aber vorweg stelle ich Dir noch <a href="https://CRAN.R-project.org/package=codetools">codetools</a> vor, es gehört zur Gruppe der "<em>recommended</em> Packages" von <strong>R</strong> und kann Programmfehler finden.
Die drei anderen Pakete gibt es nur, weil <a href="https://CRAN.R-project.org/package=codetools">codetools</a> schon da war.</p></div>
<div class="paragraph"><p>Stell Dir vor, Du hättest in der Datei "src/code.R" folgende unschöne
und kaputte Funktion geschrieben:</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.7
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt>foo <span style="color: #990000">&lt;-</span> function<span style="color: #990000">(</span><span style="font-weight: bold"><span style="color: #0000FF">this</span></span><span style="color: #990000">,</span> func<span style="color: #990000">,</span> has<span style="color: #990000">,</span> way<span style="color: #990000">,</span> too<span style="color: #990000">,</span> many<span style="color: #990000">,</span>args<span style="color: #990000">)</span> {
    if <span style="color: #990000">(</span>TRUE<span style="color: #990000">)</span> { if <span style="color: #990000">(</span>TRUE<span style="color: #990000">)</span> {
            if <span style="color: #990000">(</span>TRUE<span style="color: #990000">)</span> {
                if <span style="color: #990000">(</span>TRUE<span style="color: #990000">)</span> {
                    if <span style="color: #990000">(</span>TRUE<span style="color: #990000">)</span> {
                        print<span style="color: #990000">(</span>this_is_not_defined<span style="color: #990000">)</span>
                    } else {
                        stop<span style="color: #990000">(</span><span style="color: #FF0000">"Foobar!"</span><span style="color: #990000">)</span>
                    }
                } else {
                    stop<span style="color: #990000">(</span><span style="color: #FF0000">"Foobar!"</span><span style="color: #990000">)</span>
                }
            } else {
                stop<span style="color: #990000">(</span><span style="color: #FF0000">"Foobar!"</span><span style="color: #990000">)</span>
            }
        } else {
            stop<span style="color: #990000">(</span><span style="color: #FF0000">"Foobar!"</span><span style="color: #990000">)</span>
        }
    } else {
        stop<span style="color: #990000">(</span><span style="color: #FF0000">"Foobar!"</span><span style="color: #990000">)</span>
    }
    return<span style="color: #990000">(</span>invisible<span style="color: #990000">(</span>NULL<span style="color: #990000">))</span>
}</tt></pre></div></div>
<div class="sect3">
<h4 id="_code_prüfen_mit_a_href_https_cran_r_project_org_package_codetools_codetools_a">3.3.1. Code prüfen mit <a href="https://CRAN.R-project.org/package=codetools">codetools</a></h4>
<div class="paragraph"><p>In Deiner Funktion findet <a href="https://CRAN.R-project.org/package=codetools">codetools</a>
die nicht benutzten Funktionsargumente und das nicht definierte Objekt <code>this_is_not_defined</code>:</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.7
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt>source<span style="color: #990000">(</span>file<span style="color: #990000">.</span>path<span style="color: #990000">(</span><span style="color: #FF0000">"src"</span><span style="color: #990000">,</span> <span style="color: #FF0000">"code.R"</span><span style="color: #990000">))</span>
<span style="font-weight: bold"><span style="color: #000080">codetools:</span></span><span style="color: #990000">:</span>checkUsage<span style="color: #990000">(</span>foo<span style="color: #990000">,</span> all <span style="color: #990000">=</span> TRUE<span style="color: #990000">)</span></tt></pre></div></div>
<div class="listingblock">
<div class="content">
<pre><code>## &lt;anonymous&gt;: no visible binding for global variable 'this_is_not_defined'
## &lt;anonymous&gt;: parameter 'args' may not be used
## &lt;anonymous&gt;: parameter 'func' may not be used
## &lt;anonymous&gt;: parameter 'has' may not be used
## &lt;anonymous&gt;: parameter 'many' may not be used
## &lt;anonymous&gt;: parameter 'this' may not be used
## &lt;anonymous&gt;: parameter 'too' may not be used
## &lt;anonymous&gt;: parameter 'way' may not be used</code></pre>
</div></div>
</div>
<div class="sect3">
<h4 id="_entflusen_mit_a_href_https_cran_r_project_org_package_lintr_lintr_a">3.3.2. Entflusen mit  <a href="https://CRAN.R-project.org/package=lintr">lintr</a></h4>
<div class="paragraph"><p>Das Paket <a href="https://CRAN.R-project.org/package=lintr">lintr</a> prüft Code auf Fussel,
das sind Abweichungen des Codes von Richtlinien zur übersichtlichen Formatierung.
Die Richtlinien (gegen die <a href="https://CRAN.R-project.org/package=lintr">lintr</a> prüft, und die sind gut, halte Dich an sie;
                 zu mehr über Progammierrichtlinien findest Du im <a href="https://fvafrcu.github.io/programmierleitfaden.ps">Programmierleitfaden an der Forstlichen Versuchs- und Forschungsanstalt Baden-Württemberg</a>)
sehen unter anderem vor,
dass auf Kommas immer ein Leerzeichen folgen sollte,
dass auf öffnende geschweifte Klammern immer ein Zeilenumbruch folgen sollte und
dass eine Datei keine Leerzeilen am Ende enthalten sollte:</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.7
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="font-weight: bold"><span style="color: #000080">lintr:</span></span><span style="color: #990000">:</span>lint<span style="color: #990000">(</span>file<span style="color: #990000">.</span>path<span style="color: #990000">(</span><span style="color: #FF0000">"src"</span><span style="color: #990000">,</span> <span style="color: #FF0000">"code.R"</span><span style="color: #990000">))</span></tt></pre></div></div>
<div class="listingblock">
<div class="content">
<pre><code>## src/code.R:1:49: style: Commas should always have a space after.
## foo &lt;- function(this, func, has, way, too, many,args) {
##                                                 ^
## src/code.R:2:15: style: Opening curly braces should never go on their own line and should always be followed by a new line.
##     if (TRUE) { if (TRUE) {
##               ^
## src/code.R:6:31: warning: no visible binding for global variable 'this_is_not_defined'
##                         print(this_is_not_defined)
##                               ^~~~~~~~~~~~~~~~~~~
## src/code.R:24:1: style: Trailing blank lines are superfluous.
##
## ^</code></pre>
</div></div>
<div class="paragraph"><p>Das Paket kennt viele Optionen, lies Dir die Hilfe durch!</p></div>
<div class="paragraph"><p>Seit Ende 2017 gibt es auch das Paket <a href="https://CRAN.R-project.org/package=styler">styler</a>,
welches Code (auch in Dateien) umformatiert und in meinen Augen deutlich bessere
Ergebnisse bringt als <a href="https://CRAN.R-project.org/package=formatR">formatR</a>.
Ich nutze <a href="https://CRAN.R-project.org/package=styler">styler</a>, wenn
ich richtig schlecht geschriebenen Code lesen muss.</p></div>
</div>
<div class="sect3">
<h4 id="_code_säubern_mit_a_href_https_cran_r_project_org_package_cleanr_cleanr_a">3.3.3. Code säubern mit  <a href="https://CRAN.R-project.org/package=cleanr">cleanr</a></h4>
<div class="paragraph"><p>Das Paket <a href="https://CRAN.R-project.org/package=cleanr">cleanr</a> prüft die Länge und (Zeilen-) Breite von Funktionen und Codedateien und
die Verschachtelungstiefe von Funktionen, ihre Argumentenanzahl und ob sie einen expliziten
Rückgabewert haben.</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.7
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt>print<span style="color: #990000">(</span>suppressWarnings<span style="color: #990000">(</span>cleanr<span style="color: #990000">::</span>check_file<span style="color: #990000">(</span>file<span style="color: #990000">.</span>path<span style="color: #990000">(</span><span style="color: #FF0000">"src"</span><span style="color: #990000">,</span> <span style="color: #FF0000">"code.R"</span><span style="color: #990000">))))</span></tt></pre></div></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.7
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt>## Error <span style="font-weight: bold"><span style="color: #0000FF">in</span></span> cleanr<span style="color: #990000">::</span>check_file<span style="color: #990000">(</span>file<span style="color: #990000">.</span>path<span style="color: #990000">(</span><span style="color: #FF0000">"src"</span><span style="color: #990000">,</span> <span style="color: #FF0000">"code.R"</span><span style="color: #990000">)):</span>  src<span style="color: #990000">/</span>code<span style="color: #990000">.</span>R  foo  found <span style="color: #993399">7</span> arguments<span style="color: #990000">,</span> max_num_arguments was <span style="color: #993399">5</span>
## foo  found nesting depth <span style="color: #993399">4</span><span style="color: #990000">,</span> max_nesting_depth was <span style="color: #993399">3</span>
</tt></pre></div></div>
<div class="paragraph"><p>Auch dieses Paket kennt viele Optionen, lies Dir die Hilfe durch!</p></div>
</div>
<div class="sect3">
<h4 id="_cyclomatic_complexity_prüfen_mit_a_href_https_cran_r_project_org_package_cyclocomp_cyclocomp_a">3.3.4. Cyclomatic Complexity prüfen mit <a href="https://CRAN.R-project.org/package=cyclocomp">cyclocomp</a></h4>
<div class="paragraph"><p>McCabes "cyclomatic complexity" (<a href="#cyc">[cyc]</a>) mißt die
Komplexität von Programmcode.
Mit ihr kannst Du prüfen, ob Deine Funktionen einfach genug sind.</p></div>
<div class="paragraph"><p>Insbesondere gibt Dir die "cyclomatic complexity" eine Idee davon, wie viele Testfälle Du
für eine Funktion schreiben solltest
(genau genommen ist sie eine obere Grenze für die Anzahl der für vollständige <a href="https://en.wikipedia.org/wiki/Code_coverage">branch coverage</a> benötigten Testfälle).
Für Deine hässliche Funktion bräuchtest Du also
6 Testfälle:</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.7
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="font-weight: bold"><span style="color: #000080">cyclocomp:</span></span><span style="color: #990000">:</span>cyclocomp<span style="color: #990000">(</span>parse<span style="color: #990000">(</span>text <span style="color: #990000">=</span> readLines<span style="color: #990000">(</span>file<span style="color: #990000">.</span>path<span style="color: #990000">(</span><span style="color: #FF0000">"src"</span><span style="color: #990000">,</span> <span style="color: #FF0000">"code.R"</span><span style="color: #990000">))))</span></tt></pre></div></div>
<div class="listingblock">
<div class="content">
<pre><code>## [1] 6</code></pre>
</div></div>
<div class="paragraph"><p>Allgemein gilt: je höher die "cyclomatic complexity", desto unverständlicher der Code.
McCabe empfiehlt eine "cyclomatic complexity" von nicht mehr als 10 für eine Funktion. Und der war professioneller Programmierer des Departement of Defense der National Security Agency. Bei einer "cyclomatic complexity"  von 20 dürfte es selbst für professionelle Programmiererinnen langsam schwierig werden, die Absicht hinter Deinem Code zu verstehen. Wenn Du eine "cyclomatic complexity" von mehr als 40 schaffst, hast Du vielleicht eine Funktion geschrieben, die tut, was sie soll, aber ziemlich sicher eine, die kaum ein Mensch mehr versteht.</p></div>
<div class="paragraph"><p>Natürlich gibt es immer Ausnahmen von der Regel. Die Funktion <code>devtools::release</code> beispielsweise
hat eine ganze Reihe von interaktiven Abfragen des Typs</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.7
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt>if <span style="color: #990000">(</span>yesno<span style="color: #990000">(</span><span style="color: #FF0000">"Were devtool's checks successful?"</span><span style="color: #990000">))</span>
  return<span style="color: #990000">(</span>invisible<span style="color: #990000">())</span></tt></pre></div></div>
<div class="paragraph"><p>Diese treiben die "cyclomatic complexity" in die Höhe (weil die <code>return</code>-Anweisungen
                                                        viele verschiedene mögliche Endpunkte der Funktion definieren. Eine wohlstrukturierte Funktion hat <em>genau einen</em> <a href="https://en.wikipedia.org/wiki/Structured_programming#Early_exit">"exit node"</a>):</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.7
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt>source<span style="color: #990000">(</span>file<span style="color: #990000">.</span>path<span style="color: #990000">(</span><span style="color: #FF0000">"src"</span><span style="color: #990000">,</span> <span style="color: #FF0000">"release.R"</span><span style="color: #990000">))</span>
<span style="font-weight: bold"><span style="color: #000080">cyclocomp:</span></span><span style="color: #990000">:</span>cyclocomp<span style="color: #990000">(</span>release<span style="color: #990000">)</span></tt></pre></div></div>
<div class="listingblock">
<div class="content">
<pre><code>## [1] 44</code></pre>
</div></div>
<div class="paragraph"><p>Dabei ist die Funktion lediglich schwer verdaulich und nicht völlig unlesbar.
Dennoch sollte Hadley Wickham die Funktion dringend entrümpeln:</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.7
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt>linters <span style="color: #990000">&lt;-</span> lintr<span style="color: #990000">::</span>default_linters<span style="color: #990000">[</span>names<span style="color: #990000">(</span>lintr<span style="color: #990000">::</span>default_linters <span style="color: #990000">)!=</span> <span style="color: #FF0000">"object_usage_linter"</span><span style="color: #990000">]</span>
<span style="font-weight: bold"><span style="color: #000080">lintr:</span></span><span style="color: #990000">:</span>lint<span style="color: #990000">(</span>file<span style="color: #990000">.</span>path<span style="color: #990000">(</span><span style="color: #FF0000">"src"</span><span style="color: #990000">,</span> <span style="color: #FF0000">"release.R"</span><span style="color: #990000">),</span> linters <span style="color: #990000">=</span> linters<span style="color: #990000">)</span></tt></pre></div></div>
<div class="listingblock">
<div class="content">
<pre><code>## src/release.R:70:1: style: lines should not be more than 80 characters.
##     if (yesno("Is documentation free of spelling errors? (you can ignore false positives)"))
## ^~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
## src/release.R:87:40: warning: Do not use absolute paths.
##     cran_url &lt;- paste0(cran_mirror(), "/web/checks/check_results_",
##                                        ^~~~
## src/release.R:100:49: style: Commas should never have a space before.
##     msg &lt;- paste0("Have you checked the ", deps ," packages that depend on ",
##                                                ~^
## src/release.R:100:50: style: Commas should always have a space after.
##     msg &lt;- paste0("Have you checked the ", deps ," packages that depend on ",
##                                                  ^
## src/release.R:166:1: style: lines should not be more than 80 characters.
##   yeses &lt;- c("Yes", "Definitely", "For sure", "Yup", "Yeah", "I agree", "Absolutely")
## ^~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
## src/release.R:187:53: style: Closing curly-braces should always be on their own line, unless it's followed by an else.
##     utils::browseURL(url, browser = email_browser())},
##                                                     ^
## src/release.R:301:17: style: Variable and function names should be all lowercase.
##   new_url$query$strErr
##                 ^~~~~~</code></pre>
</div></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.7
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt>suppressWarnings<span style="color: #990000">(</span>cleanr<span style="color: #990000">::</span>check_file<span style="color: #990000">(</span>file<span style="color: #990000">.</span>path<span style="color: #990000">(</span><span style="color: #FF0000">"src"</span><span style="color: #990000">,</span> <span style="color: #FF0000">"release.R"</span><span style="color: #990000">)))</span></tt></pre></div></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.7
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt>## Error <span style="font-weight: bold"><span style="color: #0000FF">in</span></span> cleanr<span style="color: #990000">::</span>check_file<span style="color: #990000">(</span>file<span style="color: #990000">.</span>path<span style="color: #990000">(</span><span style="color: #FF0000">"src"</span><span style="color: #990000">,</span> <span style="color: #FF0000">"release.R"</span><span style="color: #990000">)):</span>  src<span style="color: #990000">/</span>release<span style="color: #990000">.</span>R<span style="color: #990000">:</span> line <span style="color: #993399">70</span> counts <span style="color: #993399">92</span> characters<span style="color: #990000">.</span>
## src<span style="color: #990000">/</span>release<span style="color: #990000">.</span>R<span style="color: #990000">:</span> line <span style="color: #993399">166</span> counts <span style="color: #993399">85</span> characters<span style="color: #990000">.</span>
## src<span style="color: #990000">/</span>release<span style="color: #990000">.</span>R<span style="color: #990000">:</span> <span style="color: #993399">325</span> lines <span style="font-weight: bold"><span style="color: #0000FF">in</span></span> file<span style="color: #990000">.</span>
##  src<span style="color: #990000">/</span>release<span style="color: #990000">.</span>R  as<span style="color: #990000">.</span>object_size  found no return<span style="color: #990000">()</span> statement at all<span style="color: #990000">.</span>
## src<span style="color: #990000">/</span>release<span style="color: #990000">.</span>R  build_cran  found no return<span style="color: #990000">()</span> statement at all<span style="color: #990000">.</span>
## src<span style="color: #990000">/</span>release<span style="color: #990000">.</span>R  cran_comments  found no return<span style="color: #990000">()</span> statement at all<span style="color: #990000">.</span>
## src<span style="color: #990000">/</span>release<span style="color: #990000">.</span>R  email  found no return<span style="color: #990000">()</span> statement at all<span style="color: #990000">.</span>
## src<span style="color: #990000">/</span>release<span style="color: #990000">.</span>R  email_browser  found no return<span style="color: #990000">()</span> statement at all<span style="color: #990000">.</span>
## src<span style="color: #990000">/</span>release<span style="color: #990000">.</span>R  maintainer  found no return<span style="color: #990000">()</span> statement at all<span style="color: #990000">.</span>
## src<span style="color: #990000">/</span>release<span style="color: #990000">.</span>R  release  line <span style="color: #993399">24</span><span style="color: #990000">:</span> found <span style="font-weight: bold"><span style="color: #0000FF">width</span></span> <span style="color: #993399">92</span> max_line_width was <span style="color: #993399">80</span>
## release  found <span style="color: #993399">98</span> lines<span style="color: #990000">,</span> max_lines was <span style="color: #993399">65</span>
## release  found <span style="color: #993399">97</span> lines of code<span style="color: #990000">,</span> max_lines_of_code was <span style="color: #993399">50</span>
## release  found no return<span style="color: #990000">()</span> statement at all<span style="color: #990000">.</span>
## src<span style="color: #990000">/</span>release<span style="color: #990000">.</span>R  release_email  found no return<span style="color: #990000">()</span> statement at all<span style="color: #990000">.</span>
## src<span style="color: #990000">/</span>release<span style="color: #990000">.</span>R  submit_cran  found no return<span style="color: #990000">()</span> statement at all<span style="color: #990000">.</span>
## src<span style="color: #990000">/</span>release<span style="color: #990000">.</span>R  upload_cran  found no return<span style="color: #990000">()</span> statement at all<span style="color: #990000">.</span>
## src<span style="color: #990000">/</span>release<span style="color: #990000">.</span>R  yesno  line <span style="color: #993399">1</span><span style="color: #990000">:</span> found <span style="font-weight: bold"><span style="color: #0000FF">width</span></span> <span style="color: #993399">85</span> max_line_width was <span style="color: #993399">80</span>
## yesno  found no return<span style="color: #990000">()</span> statement at all<span style="color: #990000">.</span>
</tt></pre></div></div>
</div>
</div>
<div class="sect2">
<h3 id="_funktionen_dokumentieren">3.4. Funktionen dokumentieren</h3>
<div class="paragraph"><p>Wenn Du Hilfe zu einer Funktion in <strong>R</strong> suchst, kannst Du unter anderem die
<strong>R</strong>-Hilfe mit <code>help(topic)</code> oder der Kurzform <code>?topic</code> aufrufen, bei Paketen findest Du
die selbe Information auch immer als pdf beigelegt.</p></div>
<div class="paragraph"><p>Solche Hilfeformate kannst Du für Deine Funktionen auch schreiben.</p></div>
<div class="sect3">
<h4 id="_warum_solltest_du_deine_funktionen_dokumentieren">3.4.1. Warum solltest Du Deine Funktionen dokumentieren?</h4>
<div class="paragraph"><p>Wenn Du Funktionen dokumentierst, erklärst Du einer anderen Person, was die Funktion
tun sollte. Wenn Du das schaffst, kannst Du Dir einigermaßen sicher sein,
dass Du weißt, was die Funktion tut und dass es richtig war,
sie (und nicht eine etwas andere) zu schreiben.</p></div>
<div class="paragraph"><p>Außerdem ist es von dokumentierten Funktionen zu Paketen nicht mehr weit,
was ihre <a href="#_als_paket">Verwaltung</a> deutlich erleichtert.</p></div>
<div class="paragraph"><p>Nehmen wir unser <a href="#_was_soll_die_ganze_testerei">Beispiel zum Goldenen Schnitt</a>:</p></div>
<div class="paragraph"><p>Du merkst, dass Du die Funktion <code>golden_ratio</code> eigentlich nur innerhalb
von <code>golden_rectangle</code> benutzt und letzteres kein glücklicher Name ist, weil
Du die Funktion zwar zum Errechnen von Seitenlängen von Graphiken nutzt, sie
ja aber ganz allgemein den Goldenen Schnitt ausrechnet.
Du entschließt Dich daher, die interne Funktion in
<code>.golden_ratio</code> (der führende Punkt ist eine Konvention, die aus der UNIX-Welt stammt,
                 dort werden (vorwiegend Konfigurations-) Dateien mit einem führenden Punkt
                 aus dem directory listing ausgeschlossen (unter Windows heißen diese Dateien "versteckt")
                &#8201;&#8212;&#8201;in <strong>R</strong> kennzeichnet die Konvention interne Funktionen, die gewöhnlich
                 nicht direkt aufgerufen werden (sollten))
                 und <code>golden_rectangle</code> in <code>golden_ratio</code> umzubenennen.
Dazu musst Du</p></div>
<div class="ulist"><ul>
<li>
<p>
die Funktionsdateien und die zugehörigen Testdateien umbenennen,
</p>
</li>
<li>
<p>
die Namen in den Funktionsdefinitionen ändern und
</p>
</li>
<li>
<p>
die Namen in den Funktionsaufrufen ändern.
</p>
</li>
</ul></div>
<div class="paragraph"><p>Das kannst Du von Hand machen, oder Du schreibst folgende Funktionen:</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.7
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt>substitute_function <span style="color: #990000">&lt;-</span> function<span style="color: #990000">(</span>from<span style="color: #990000">,</span> to<span style="color: #990000">,</span> file_name<span style="color: #990000">)</span> {
        patterns <span style="color: #990000">&lt;-</span> c<span style="color: #990000">(</span>definition_pattern <span style="color: #990000">=</span> paste<span style="color: #993399">0</span><span style="color: #990000">(</span>from<span style="color: #990000">,</span> <span style="color: #FF0000">"( *&lt;-)"</span><span style="color: #990000">),</span>
                      call_pattern <span style="color: #990000">=</span> paste<span style="color: #993399">0</span><span style="color: #990000">(</span>from<span style="color: #990000">,</span> <span style="color: #FF0000">"(</span><span style="color: #CC33CC">\\</span><span style="color: #FF0000">()"</span><span style="color: #990000">))</span>
        x <span style="color: #990000">&lt;-</span> readLines<span style="color: #990000">(</span>file_name<span style="color: #990000">)</span>
        for <span style="color: #990000">(</span>pattern <span style="font-weight: bold"><span style="color: #0000FF">in</span></span> patterns<span style="color: #990000">)</span>
            x <span style="color: #990000">&lt;-</span> <span style="font-weight: bold"><span style="color: #0000FF">sub</span></span><span style="color: #990000">(</span>pattern<span style="color: #990000">,</span> paste<span style="color: #993399">0</span><span style="color: #990000">(</span>to<span style="color: #990000">,</span> <span style="color: #FF0000">"</span><span style="color: #CC33CC">\\</span><span style="color: #FF0000">1"</span><span style="color: #990000">),</span> x<span style="color: #990000">)</span>

        writeLines<span style="color: #990000">(</span>x<span style="color: #990000">,</span> con <span style="color: #990000">=</span> file_name<span style="color: #990000">)</span>

}

rename_function <span style="color: #990000">&lt;-</span> function<span style="color: #990000">(</span>from<span style="color: #990000">,</span> to<span style="color: #990000">,</span> directory <span style="color: #990000">=</span> <span style="color: #FF0000">"."</span><span style="color: #990000">)</span> {
    file_names <span style="color: #990000">&lt;-</span> list<span style="color: #990000">.</span>files<span style="color: #990000">(</span>directory<span style="color: #990000">,</span> full<span style="color: #990000">.</span>names <span style="color: #990000">=</span> TRUE<span style="color: #990000">,</span>
                             pattern <span style="color: #990000">=</span> paste<span style="color: #993399">0</span><span style="color: #990000">(</span><span style="color: #FF0000">"^(test_|)"</span><span style="color: #990000">,</span> from<span style="color: #990000">,</span> <span style="color: #FF0000">"</span><span style="color: #CC33CC">\\</span><span style="color: #FF0000">.[rR]$"</span><span style="color: #990000">)</span>
                             <span style="color: #990000">)</span>
    new_file_names <span style="color: #990000">&lt;-</span> NULL

    for <span style="color: #990000">(</span>file_name <span style="font-weight: bold"><span style="color: #0000FF">in</span></span> file_names<span style="color: #990000">)</span> {

        substitute_function<span style="color: #990000">(</span>from <span style="color: #990000">=</span> from<span style="color: #990000">,</span> to <span style="color: #990000">=</span> to<span style="color: #990000">,</span> file_name <span style="color: #990000">=</span> file_name<span style="color: #990000">)</span>
        new_file_name <span style="color: #990000">&lt;-</span> file<span style="color: #990000">.</span>path<span style="color: #990000">(</span>dirname<span style="color: #990000">(</span>file_name<span style="color: #990000">),</span>
                                   <span style="font-weight: bold"><span style="color: #0000FF">sub</span></span><span style="color: #990000">(</span>from<span style="color: #990000">,</span> to<span style="color: #990000">,</span> basename<span style="color: #990000">(</span>file_name<span style="color: #990000">)))</span>
        file<span style="color: #990000">.</span>rename<span style="color: #990000">(</span>file_name<span style="color: #990000">,</span> new_file_name<span style="color: #990000">)</span>
        new_file_names <span style="color: #990000">&lt;-</span> c<span style="color: #990000">(</span>new_file_names<span style="color: #990000">,</span> new_file_name<span style="color: #990000">)</span>
    }
    return<span style="color: #990000">(</span>new_file_names<span style="color: #990000">)</span>
}</tt></pre></div></div>
<div class="paragraph"><p>Diese Funktionen leben ja von Nebenwirkungen, sie sind schwer zu testen und wir hoffen also, dass Du keine Fehler gemachst hast.</p></div>
<div class="paragraph"><p>Funktionieren tut das so:</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.7
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt>rename_function<span style="color: #990000">(</span>from <span style="color: #990000">=</span> <span style="color: #FF0000">"golden_ratio"</span><span style="color: #990000">,</span> to <span style="color: #990000">=</span> <span style="color: #FF0000">".golden_ratio"</span><span style="color: #990000">,</span>
                 directory <span style="color: #990000">=</span> <span style="color: #FF0000">"src"</span><span style="color: #990000">)</span></tt></pre></div></div>
<div class="listingblock">
<div class="content">
<pre><code>## [1] "src/.golden_ratio.R"      "src/test_.golden_ratio.R"</code></pre>
</div></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.7
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt># replace calls to golden_ratio<span style="color: #990000">()!</span>
substitute_function<span style="color: #990000">(</span>from <span style="color: #990000">=</span> <span style="color: #FF0000">"golden_ratio"</span><span style="color: #990000">,</span> to <span style="color: #990000">=</span> <span style="color: #FF0000">".golden_ratio"</span><span style="color: #990000">,</span>
                 file_name <span style="color: #990000">=</span> file<span style="color: #990000">.</span>path<span style="color: #990000">(</span><span style="color: #FF0000">"src"</span><span style="color: #990000">,</span> <span style="color: #FF0000">"test_golden_rectangle.R"</span><span style="color: #990000">))</span>
substitute_function<span style="color: #990000">(</span>from <span style="color: #990000">=</span> <span style="color: #FF0000">"golden_ratio"</span><span style="color: #990000">,</span> to <span style="color: #990000">=</span> <span style="color: #FF0000">".golden_ratio"</span><span style="color: #990000">,</span>
                 file_name <span style="color: #990000">=</span> file<span style="color: #990000">.</span>path<span style="color: #990000">(</span><span style="color: #FF0000">"src"</span><span style="color: #990000">,</span> <span style="color: #FF0000">"golden_rectangle.R"</span><span style="color: #990000">))</span>
rename_function<span style="color: #990000">(</span>from <span style="color: #990000">=</span> <span style="color: #FF0000">"golden_rectangle"</span><span style="color: #990000">,</span> to <span style="color: #990000">=</span> <span style="color: #FF0000">"golden_ratio"</span><span style="color: #990000">,</span>
                 directory <span style="color: #990000">=</span> <span style="color: #FF0000">"src"</span><span style="color: #990000">)</span></tt></pre></div></div>
<div class="listingblock">
<div class="content">
<pre><code>## [1] "src/golden_ratio.R"      "src/test_golden_ratio.R"</code></pre>
</div></div>
<div class="paragraph"><p>Du testest natürlich Deine neuen Dateien:</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.7
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="font-weight: bold"><span style="color: #000080">covr:</span></span><span style="color: #990000">:</span>file_coverage<span style="color: #990000">(</span>file<span style="color: #990000">.</span>path<span style="color: #990000">(</span><span style="color: #FF0000">"src"</span><span style="color: #990000">,</span> <span style="color: #FF0000">".golden_ratio.R"</span><span style="color: #990000">),</span>
                    file<span style="color: #990000">.</span>path<span style="color: #990000">(</span><span style="color: #FF0000">"src"</span><span style="color: #990000">,</span> <span style="color: #FF0000">"test_.golden_ratio.R"</span><span style="color: #990000">))</span></tt></pre></div></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.7
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="font-weight: bold"><span style="color: #000080">covr:</span></span><span style="color: #990000">:</span>file_coverage<span style="color: #990000">(</span>file<span style="color: #990000">.</span>path<span style="color: #990000">(</span><span style="color: #FF0000">"src"</span><span style="color: #990000">,</span> c<span style="color: #990000">(</span><span style="color: #FF0000">"golden_ratio.R"</span><span style="color: #990000">,</span> <span style="color: #FF0000">".golden_ratio.R"</span><span style="color: #990000">)),</span>
                    file<span style="color: #990000">.</span>path<span style="color: #990000">(</span><span style="color: #FF0000">"src"</span><span style="color: #990000">,</span> <span style="color: #FF0000">"test_golden_ratio.R"</span><span style="color: #990000">))</span></tt></pre></div></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.7
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt>## Coverage<span style="color: #990000">:</span> <span style="color: #993399">100.00</span><span style="color: #990000">%</span>
</tt></pre></div></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.7
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt>## src<span style="color: #990000">/</span>golden_ratio<span style="color: #990000">.</span>R<span style="color: #990000">:</span> <span style="color: #993399">100.00</span><span style="color: #990000">%</span>
</tt></pre></div></div>
<div class="paragraph"><p>Scheint geklappt zu haben.</p></div>
<div class="paragraph"><p>Du siehst also, dass Du Deine Funktionen verändert hast, <em>weil</em> Du sie dokumentieren
willst.</p></div>
</div>
<div class="sect3">
<h4 id="_wie_kannst_du_funktionen_dokumentieren">3.4.2. Wie kannst Du Funktionen dokumentieren?</h4>
<div class="paragraph"><p>Das <strong>R</strong>-Hilfeformat wird <a href="https://cran.r-project.org/doc/manuals/r-release/R-exts.html#Writing-R-documentation-files">hier</a>
beschrieben, ich rate Dir aber, <a href="https://cran.r-project.org/web/packages/roxygen2/index.html">roxygen2</a> zu
benutzen (<a href="http://r-pkgs.had.co.nz/man.html">hier</a> gibt Hadley Wickham eine druckreife Einführung).</p></div>
<div class="paragraph"><p>Du veränderst also Deine Funktionsdatei, in dem Du Dokumentationskommentare einfügst:</p></div>
<div class="listingblock">
<div class="title">src/golden_ratio.R</div>
<div class="content"><!-- Generator: GNU source-highlight 3.1.7
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt>#<span style="color: #FF0000">' Compute the Other Quantity in Golden Ratio</span>
<span style="color: #FF0000">#'</span>
#<span style="color: #FF0000">' See </span><span style="color: #CC33CC">\u</span><span style="color: #FF0000">rl{https://en.wikipedia.org/wiki/Golden_ratio} for an introduction to</span>
<span style="color: #FF0000">#'</span> the Golden Ratio<span style="color: #990000">.</span>
#<span style="color: #FF0000">'</span>
<span style="color: #FF0000">#'</span> Specify <span style="color: #990000">\</span>code{value <span style="color: #990000">=</span> <span style="color: #993399">1</span>} to obtain the Golden Ratio itself <span style="font-weight: bold"><span style="color: #0000FF">in</span></span> element <span style="color: #FF0000">"a"</span> of
#<span style="color: #FF0000">' the return value.</span>
<span style="color: #FF0000">#'</span> @param value A Quantity<span style="color: #990000">.</span>
#<span style="color: #FF0000">' @param landscape Is the quantity given by </span><span style="color: #CC33CC">\c</span><span style="color: #FF0000">ode{value} the larger one ("a")?</span>
<span style="color: #FF0000">#'</span> @return A vector giving the quantities <span style="color: #FF0000">"a"</span> <span style="font-weight: bold"><span style="color: #0000FF">and</span></span> <span style="color: #FF0000">"b"</span><span style="color: #990000">.</span>
#<span style="color: #FF0000">' @export</span>
<span style="color: #FF0000">#'</span> @examples
#<span style="color: #FF0000">' print(golden_ratio(value = 1)[["a"]])</span>
<span style="color: #FF0000">golden_ratio  &lt;- function(value, landscape = FALSE) {</span>
<span style="color: #FF0000">    phi &lt;- .golden_ratio()</span>
<span style="color: #FF0000">    if (isTRUE(landscape)) {</span>
<span style="color: #FF0000">        a  &lt;- value</span>
<span style="color: #FF0000">        b &lt;- a / phi</span>
<span style="color: #FF0000">    } else {</span>
<span style="color: #FF0000">        b &lt;- value</span>
<span style="color: #FF0000">        a &lt;- b * phi</span>
<span style="color: #FF0000">    }</span>
<span style="color: #FF0000">    return(c("a" = a, "b" = b))</span>
<span style="color: #FF0000">}</span></tt></pre></div></div>
<div class="paragraph"><p>und weil dokumentieren Dir so viel Spaß bereit, dokumentierst Du gleich auch
die interne Funktion (interne Funktionen zu dokumentieren ist ein wenig umstritten,
                      ich finde es gut).</p></div>
<div class="listingblock">
<div class="title">src/.golden_ratio.R</div>
<div class="content"><!-- Generator: GNU source-highlight 3.1.7
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt>#<span style="color: #FF0000">' Compute the Golden Ratio</span>
<span style="color: #FF0000">#'</span>
#<span style="color: #FF0000">' See </span><span style="color: #CC33CC">\u</span><span style="color: #FF0000">rl{https://en.wikipedia.org/wiki/Golden_ratio} for an introduction to</span>
<span style="color: #FF0000">#'</span> the Golden Ratio<span style="color: #990000">.</span>
#<span style="color: #FF0000">'</span>
<span style="color: #FF0000">#'</span> @return The Golden Ratio
#<span style="color: #FF0000">' @keywords internal</span>
<span style="color: #FF0000">.golden_ratio  &lt;- function() {</span>
<span style="color: #FF0000">    phi &lt;- (1 + sqrt(5)) / 2</span>
<span style="color: #FF0000">    return(phi)</span>
<span style="color: #FF0000">}</span></tt></pre></div></div>
<div class="paragraph"><p>Was hast Du davon, außer Arbeit?</p></div>
<div class="paragraph"><p>Wenn Du Deine beiden Funktionen in eine Datei schreibst</p></div>
<div class="listingblock">
<div class="title">src/golden_ratios.R</div>
<div class="content"><!-- Generator: GNU source-highlight 3.1.7
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt>#<span style="color: #FF0000">' Compute the Golden Ratio</span>
<span style="color: #FF0000">#'</span>
#<span style="color: #FF0000">' See </span><span style="color: #CC33CC">\u</span><span style="color: #FF0000">rl{https://en.wikipedia.org/wiki/Golden_ratio} for an introduction to</span>
<span style="color: #FF0000">#'</span> the Golden Ratio<span style="color: #990000">.</span>
#<span style="color: #FF0000">'</span>
<span style="color: #FF0000">#'</span> @return The Golden Ratio
#<span style="color: #FF0000">' @keywords internal</span>
<span style="color: #FF0000">.golden_ratio  &lt;- function() {</span>
<span style="color: #FF0000">    phi &lt;- (1 + sqrt(5)) / 2</span>
<span style="color: #FF0000">    return(phi)</span>
<span style="color: #FF0000">}</span>

<span style="color: #FF0000">#'</span> Compute the Other Quantity <span style="font-weight: bold"><span style="color: #0000FF">in</span></span> Golden Ratio
#<span style="color: #FF0000">'</span>
<span style="color: #FF0000">#'</span> See <span style="color: #990000">\</span>url{https<span style="color: #990000">://</span>en<span style="color: #990000">.</span>wikipedia<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #0000FF">org</span></span><span style="color: #990000">/</span>wiki<span style="color: #990000">/</span>Golden_ratio} for an introduction to
#<span style="color: #FF0000">' the Golden Ratio.</span>
<span style="color: #FF0000">#'</span>
#<span style="color: #FF0000">' Specify </span><span style="color: #CC33CC">\c</span><span style="color: #FF0000">ode{value = 1} to obtain the Golden Ratio itself in element "a" of</span>
<span style="color: #FF0000">#'</span> the return value<span style="color: #990000">.</span>
#<span style="color: #FF0000">' @param value A Quantity.</span>
<span style="color: #FF0000">#'</span> @param landscape Is the quantity given by <span style="color: #990000">\</span>code{value} the larger one <span style="color: #990000">(</span><span style="color: #FF0000">"a"</span><span style="color: #990000">)?</span>
#<span style="color: #FF0000">' @return A vector giving the quantities "a" and "b".</span>
<span style="color: #FF0000">#'</span> @export
#<span style="color: #FF0000">' @examples</span>
<span style="color: #FF0000">#'</span> print<span style="color: #990000">(</span>golden_ratio<span style="color: #990000">(</span>value <span style="color: #990000">=</span> <span style="color: #993399">1</span><span style="color: #990000">)[[</span><span style="color: #FF0000">"a"</span><span style="color: #990000">]])</span>
golden_ratio  <span style="color: #990000">&lt;-</span> function<span style="color: #990000">(</span>value<span style="color: #990000">,</span> landscape <span style="color: #990000">=</span> FALSE<span style="color: #990000">)</span> {
    phi <span style="color: #990000">&lt;-</span> <span style="color: #990000">.</span>golden_ratio<span style="color: #990000">()</span>
    if <span style="color: #990000">(</span>isTRUE<span style="color: #990000">(</span>landscape<span style="color: #990000">))</span> {
        a  <span style="color: #990000">&lt;-</span> value
        b <span style="color: #990000">&lt;-</span> a <span style="color: #990000">/</span> phi
    } else {
        b <span style="color: #990000">&lt;-</span> value
        a <span style="color: #990000">&lt;-</span> b <span style="color: #990000">*</span> phi
    }
    return<span style="color: #990000">(</span>c<span style="color: #990000">(</span><span style="color: #FF0000">"a"</span> <span style="color: #990000">=</span> a<span style="color: #990000">,</span> <span style="color: #FF0000">"b"</span> <span style="color: #990000">=</span> b<span style="color: #990000">))</span>
}</tt></pre></div></div>
<div class="paragraph"><p>kannst Du mit dem Paket <a href="https://CRAN.R-project.org/package=document">document</a> Hilfe-Dateien erstellen,
wie Du sie aus <strong>R</strong> kennst:</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.7
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="font-weight: bold"><span style="color: #000080">document:</span></span><span style="color: #990000">:</span>document<span style="color: #990000">(</span>file<span style="color: #990000">.</span>path<span style="color: #990000">(</span><span style="color: #FF0000">"src"</span><span style="color: #990000">,</span> <span style="color: #FF0000">"golden_ratios.R"</span><span style="color: #990000">),</span> output_directory <span style="color: #990000">=</span> <span style="color: #FF0000">"."</span><span style="color: #990000">)</span></tt></pre></div></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.7
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt>list<span style="color: #990000">.</span>files<span style="color: #990000">(</span>pattern <span style="color: #990000">=</span> <span style="color: #FF0000">"^golden.*"</span><span style="color: #990000">,</span> full<span style="color: #990000">.</span>names <span style="color: #990000">=</span> TRUE<span style="color: #990000">)</span></tt></pre></div></div>
<div class="listingblock">
<div class="content">
<pre><code>## [1] "./golden_ratio.html"  "./golden_ratio.pdf"   "./golden_ratios.html"
## [4] "./golden_ratios.pdf"  "./golden_ratios.txt"  "./golden_ratio.txt"</code></pre>
</div></div>
<div class="paragraph"><p>Außerdem kannst Du mit <a href="https://CRAN.R-project.org/package=document">document</a> nach der Erstellung der Hilfe-Dateien
in einer laufenden <strong>R</strong>-Sitzung die Hilfe zu Deiner Funktion ansehen:</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.7
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="font-weight: bold"><span style="color: #000080">document:</span></span><span style="color: #990000">:</span>man<span style="color: #990000">(</span><span style="color: #FF0000">"golden_ratio"</span><span style="color: #990000">)</span></tt></pre></div></div>
<div class="listingblock">
<div class="content">
<pre><code>Compute the Other Quantity in Golden Ratio

Description:

     See &lt;URL: https://en.wikipedia.org/wiki/Golden_ratio&gt; for an
     introduction to the Golden Ratio.

Usage:

     golden_ratio(value, landscape = FALSE)

Arguments:

   value: A Quantity.

landscape: Is the quantity given by ‘value’ the larger one ("a")?

Details:

     Specify ‘value = 1’ to obtain the Golden Ratio itself in element
     "a" of the return value.

Value:

     A vector giving the quantities "a" and "b".

Examples:

     print(golden_ratio(value = 1)[["a"]])</code></pre>
</div></div>
<div class="paragraph"><p>Und zum Dritten und Wichtigsten: Du hast Deine Funktionen dokumentiert und ihre
Schnittstellen beschrieben. Sie sind jetzt <a href="#_paketieren">paketierungsreif</a>.</p></div>
</div>
</div>
<div class="sect2">
<h3 id="_paketieren">3.5. Paketieren</h3>
<div class="paragraph"><p>Zum Paketieren nimmst Du wieder die getrennten Funktionsdateien,
<code>src/golden_ratio.R</code> und <code>src/.golden_ratio.R</code> und ihre zugehörigen Testdateien.</p></div>
<div class="paragraph"><p>Damit sie den Paketanforderungen genügen, musst Du noch zwei kleine
Änderungen vornehmen: <code>golden_ratio.R</code> braucht noch einen
Verweis darauf, dass interne Funktionen in <code>golden_ratio_internals.R</code> stehen</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.7
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt>code <span style="color: #990000">&lt;-</span> c<span style="color: #990000">(</span><span style="color: #FF0000">"#' @include golden_ratio_internals.R"</span><span style="color: #990000">,</span> <span style="color: #FF0000">"NULL"</span><span style="color: #990000">,</span> <span style="color: #FF0000">""</span><span style="color: #990000">,</span>
          readLines<span style="color: #990000">(</span>file<span style="color: #990000">.</span>path<span style="color: #990000">(</span><span style="color: #FF0000">"src"</span><span style="color: #990000">,</span> <span style="color: #FF0000">"golden_ratio.R"</span><span style="color: #990000">)))</span>
writeLines<span style="color: #990000">(</span>code<span style="color: #990000">,</span> file<span style="color: #990000">.</span>path<span style="color: #990000">(</span><span style="color: #FF0000">"src"</span><span style="color: #990000">,</span> <span style="color: #FF0000">"golden_ratio.R"</span><span style="color: #990000">))</span></tt></pre></div></div>
<div class="listingblock">
<div class="title">src/golden_ratio.R</div>
<div class="content"><!-- Generator: GNU source-highlight 3.1.7
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt>#<span style="color: #FF0000">' @include golden_ratio_internals.R</span>
<span style="color: #FF0000">NULL</span>

<span style="color: #FF0000">#'</span> Compute the Other Quantity <span style="font-weight: bold"><span style="color: #0000FF">in</span></span> Golden Ratio
#<span style="color: #FF0000">'</span>
<span style="color: #FF0000">#'</span> See <span style="color: #990000">\</span>url{https<span style="color: #990000">://</span>en<span style="color: #990000">.</span>wikipedia<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #0000FF">org</span></span><span style="color: #990000">/</span>wiki<span style="color: #990000">/</span>Golden_ratio} for an introduction to
#<span style="color: #FF0000">' the Golden Ratio.</span>
<span style="color: #FF0000">#'</span>
#<span style="color: #FF0000">' Specify </span><span style="color: #CC33CC">\c</span><span style="color: #FF0000">ode{value = 1} to obtain the Golden Ratio itself in element "a" of</span>
<span style="color: #FF0000">#'</span> the return value<span style="color: #990000">.</span>
#<span style="color: #FF0000">' @param value A Quantity.</span>
<span style="color: #FF0000">#'</span> @param landscape Is the quantity given by <span style="color: #990000">\</span>code{value} the larger one <span style="color: #990000">(</span><span style="color: #FF0000">"a"</span><span style="color: #990000">)?</span>
#<span style="color: #FF0000">' @return A vector giving the quantities "a" and "b".</span>
<span style="color: #FF0000">#'</span> @export
#<span style="color: #FF0000">' @examples</span>
<span style="color: #FF0000">#'</span> print<span style="color: #990000">(</span>golden_ratio<span style="color: #990000">(</span>value <span style="color: #990000">=</span> <span style="color: #993399">1</span><span style="color: #990000">)[[</span><span style="color: #FF0000">"a"</span><span style="color: #990000">]])</span>
golden_ratio  <span style="color: #990000">&lt;-</span> function<span style="color: #990000">(</span>value<span style="color: #990000">,</span> landscape <span style="color: #990000">=</span> FALSE<span style="color: #990000">)</span> {
    phi <span style="color: #990000">&lt;-</span> <span style="color: #990000">.</span>golden_ratio<span style="color: #990000">()</span>
    if <span style="color: #990000">(</span>isTRUE<span style="color: #990000">(</span>landscape<span style="color: #990000">))</span> {
        a  <span style="color: #990000">&lt;-</span> value
        b <span style="color: #990000">&lt;-</span> a <span style="color: #990000">/</span> phi
    } else {
        b <span style="color: #990000">&lt;-</span> value
        a <span style="color: #990000">&lt;-</span> b <span style="color: #990000">*</span> phi
    }
    return<span style="color: #990000">(</span>c<span style="color: #990000">(</span><span style="color: #FF0000">"a"</span> <span style="color: #990000">=</span> a<span style="color: #990000">,</span> <span style="color: #FF0000">"b"</span> <span style="color: #990000">=</span> b<span style="color: #990000">))</span>
}</tt></pre></div></div>
<div class="paragraph"><p>und die Dokumentation für <code>.golden_ratio</code> sollte in eine Datei geschrieben
werden, deren Name nicht mit einem Punkt beginnt
(der Name der Hilfedatei wird, wenn Du ihn nicht explizit angibst, aus dem der
dokumentierten Funktion abgeleitet)</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.7
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt>code <span style="color: #990000">&lt;-</span> readLines<span style="color: #990000">(</span>file<span style="color: #990000">.</span>path<span style="color: #990000">(</span><span style="color: #FF0000">"src"</span><span style="color: #990000">,</span> <span style="color: #FF0000">".golden_ratio.R"</span><span style="color: #990000">))</span>
return_line <span style="color: #990000">&lt;-</span> grep<span style="color: #990000">(</span><span style="color: #FF0000">"@return"</span><span style="color: #990000">,</span> code<span style="color: #990000">)</span>
code_upper <span style="color: #990000">&lt;-</span> code<span style="color: #990000">[</span><span style="color: #993399">1</span><span style="color: #990000">:</span>return_line<span style="color: #990000">]</span>
code_lower <span style="color: #990000">&lt;-</span> code<span style="color: #990000">[(</span>return_line <span style="color: #990000">+</span> <span style="color: #993399">1</span><span style="color: #990000">):</span><span style="font-weight: bold"><span style="color: #0000FF">length</span></span><span style="color: #990000">(</span>code<span style="color: #990000">)]</span>
code <span style="color: #990000">&lt;-</span> c<span style="color: #990000">(</span>code_upper<span style="color: #990000">,</span> <span style="color: #FF0000">"#' @rdname internals"</span><span style="color: #990000">,</span> code_lower<span style="color: #990000">)</span>
writeLines<span style="color: #990000">(</span>code<span style="color: #990000">,</span> file<span style="color: #990000">.</span>path<span style="color: #990000">(</span><span style="color: #FF0000">"src"</span><span style="color: #990000">,</span> <span style="color: #FF0000">".golden_ratio.R"</span><span style="color: #990000">))</span></tt></pre></div></div>
<div class="listingblock">
<div class="title">src/.golden_ratio.R</div>
<div class="content"><!-- Generator: GNU source-highlight 3.1.7
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt>#<span style="color: #FF0000">' Compute the Golden Ratio</span>
<span style="color: #FF0000">#'</span>
#<span style="color: #FF0000">' See </span><span style="color: #CC33CC">\u</span><span style="color: #FF0000">rl{https://en.wikipedia.org/wiki/Golden_ratio} for an introduction to</span>
<span style="color: #FF0000">#'</span> the Golden Ratio<span style="color: #990000">.</span>
#<span style="color: #FF0000">'</span>
<span style="color: #FF0000">#'</span> @return The Golden Ratio
#<span style="color: #FF0000">' @rdname internals</span>
<span style="color: #FF0000">#'</span> @keywords internal
<span style="font-weight: bold"><span style="color: #000080">.golden</span></span>_ratio  <span style="color: #990000">&lt;-</span> function<span style="color: #990000">()</span> {
    phi <span style="color: #990000">&lt;-</span> <span style="color: #990000">(</span><span style="color: #993399">1</span> <span style="color: #990000">+</span> sqrt<span style="color: #990000">(</span><span style="color: #993399">5</span><span style="color: #990000">))</span> <span style="color: #990000">/</span> <span style="color: #993399">2</span>
    return<span style="color: #990000">(</span>phi<span style="color: #990000">)</span>
}</tt></pre></div></div>
<div class="paragraph"><p>Du erstellst eine Paketvorlage und kopierst die Dateien hinein:</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.7
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt># Create package skeleton
package_name <span style="color: #990000">&lt;-</span> <span style="color: #FF0000">"mytools"</span>
package_dir <span style="color: #990000">&lt;-</span> file<span style="color: #990000">.</span>path<span style="color: #990000">(</span>dirname<span style="color: #990000">(</span>tempdir<span style="color: #990000">()),</span> package_name<span style="color: #990000">)</span>
unlink<span style="color: #990000">(</span>package_dir<span style="color: #990000">,</span> recursive <span style="color: #990000">=</span> TRUE<span style="color: #990000">)</span> # make sure it<span style="color: #FF0000">'s not there</span>
<span style="color: #FF0000">devtools::create(package_dir)</span>
<span style="color: #FF0000"># add source files</span>
<span style="color: #FF0000">file.copy(from = file.path("src", c("golden_ratio.R", ".golden_ratio.R")),</span>
<span style="color: #FF0000">          to = file.path(package_dir, "R"))</span>
<span style="color: #FF0000"># rename the hidden file, package will not build otherwise:</span>
<span style="color: #FF0000">file.rename(file.path(package_dir, "R", ".golden_ratio.R"),</span>
<span style="color: #FF0000">            file.path(package_dir, "R", "golden_ratio_internals.R"))</span>
<span style="color: #FF0000"># create package'</span>s testing skeleton
<span style="font-weight: bold"><span style="color: #000080">devtools:</span></span><span style="color: #990000">:</span>use_testthat<span style="color: #990000">(</span>package_dir<span style="color: #990000">)</span>
# <span style="font-weight: bold"><span style="color: #0000FF">add</span></span> <span style="font-weight: bold"><span style="color: #0000FF">test</span></span> files
file<span style="color: #990000">.</span>copy<span style="color: #990000">(</span>from <span style="color: #990000">=</span> file<span style="color: #990000">.</span>path<span style="color: #990000">(</span><span style="color: #FF0000">"src"</span><span style="color: #990000">,</span> c<span style="color: #990000">(</span><span style="color: #FF0000">"test_golden_ratio.R"</span><span style="color: #990000">,</span>
                                    <span style="color: #FF0000">"test_.golden_ratio.R"</span><span style="color: #990000">)),</span>
                           file<span style="color: #990000">.</span>path<span style="color: #990000">(</span>package_dir<span style="color: #990000">,</span> <span style="color: #FF0000">"tests"</span><span style="color: #990000">,</span> <span style="color: #FF0000">"testthat"</span><span style="color: #990000">))</span>
# build the docs
<span style="font-weight: bold"><span style="color: #000080">roxygen2:</span></span><span style="color: #990000">:</span>roxygenize<span style="color: #990000">(</span>package_dir<span style="color: #990000">)</span>
# Set package Metadata
<span style="font-weight: bold"><span style="color: #000080">desc:</span></span><span style="color: #990000">:</span>desc_set_authors<span style="color: #990000">(</span>person<span style="color: #990000">(</span>given <span style="color: #990000">=</span> <span style="color: #FF0000">"Your"</span><span style="color: #990000">,</span> family <span style="color: #990000">=</span> <span style="color: #FF0000">"Name"</span><span style="color: #990000">,</span>
                              role <span style="color: #990000">=</span> c<span style="color: #990000">(</span><span style="color: #FF0000">"aut"</span><span style="color: #990000">,</span> <span style="color: #FF0000">"cre"</span><span style="color: #990000">),</span>
                              email <span style="color: #990000">=</span> <span style="color: #FF0000">"your.name@somewhe.re"</span><span style="color: #990000">),</span>
                       file <span style="color: #990000">=</span> package_dir<span style="color: #990000">,</span> normalize <span style="color: #990000">=</span> TRUE<span style="color: #990000">)</span>
<span style="font-weight: bold"><span style="color: #000080">desc:</span></span><span style="color: #990000">:</span>desc_bump_version<span style="color: #990000">(</span><span style="color: #FF0000">"minor"</span><span style="color: #990000">,</span> package_dir<span style="color: #990000">)</span>
## Fix some more metadata
d <span style="color: #990000">&lt;-</span> desc<span style="color: #990000">::</span>desc<span style="color: #990000">(</span>package_dir<span style="color: #990000">)</span>
### Use <span style="font-weight: bold"><span style="color: #0000FF">title</span></span> case
d$set<span style="color: #990000">(</span><span style="font-weight: bold"><span style="color: #0000FF">Title</span></span> <span style="color: #990000">=</span> tools<span style="color: #990000">::</span>toTitleCase<span style="color: #990000">(</span>d$get<span style="color: #990000">(</span><span style="color: #FF0000">"Title"</span><span style="color: #990000">)))</span>
### Set package License
d$set<span style="color: #990000">(</span>License <span style="color: #990000">=</span> <span style="color: #FF0000">"GPL"</span><span style="color: #990000">)</span>
d$write<span style="color: #990000">()</span></tt></pre></div></div>
<div class="paragraph"><p>Nun kannst Du das Paket prüfen:</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.7
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt>check <span style="color: #990000">&lt;-</span> rcmdcheck<span style="color: #990000">::</span>rcmdcheck<span style="color: #990000">(</span>package_dir<span style="color: #990000">,</span> args <span style="color: #990000">=</span> <span style="color: #FF0000">"--as-cran"</span><span style="color: #990000">)</span></tt></pre></div></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.7
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt>print<span style="color: #990000">(</span>check<span style="color: #990000">)</span></tt></pre></div></div>
<div class="listingblock">
<div class="content">
<pre><code>##
## ── R CMD check results ───────────────────────────────── mytools 0.1.0 ────
##
## ❯ checking CRAN incoming feasibility ... NOTE
##   Maintainer: ‘Your Name &lt;your.name@somewhe.re&gt;’
##
##   New submission
##
## ── 0 errors ✔ | 0 warnings ✔ | 1 note ✖</code></pre>
</div></div>
<div class="paragraph"><p>Nun ja, Du hast die Metadaten noch nicht angepasst. Solltest Du noch tun.</p></div>
<div class="paragraph"><p>Du kannst Dein Paket auch testen:</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.7
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="font-weight: bold"><span style="color: #000080">covr:</span></span><span style="color: #990000">:</span>package_coverage<span style="color: #990000">(</span>package_dir<span style="color: #990000">)</span></tt></pre></div></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.7
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt>## mytools Coverage<span style="color: #990000">:</span> <span style="color: #993399">100.00</span><span style="color: #990000">%</span>
</tt></pre></div></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.7
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt>## R<span style="color: #990000">/</span>golden_ratio_internals<span style="color: #990000">.</span>R<span style="color: #990000">:</span> <span style="color: #993399">100.00</span><span style="color: #990000">%</span>
</tt></pre></div></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.7
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt>## R<span style="color: #990000">/</span>golden_ratio<span style="color: #990000">.</span>R<span style="color: #990000">:</span> <span style="color: #993399">100.00</span><span style="color: #990000">%</span>
</tt></pre></div></div>
<div class="paragraph"><p>Und Du solltest immer auch die Deine <a href="#_weniger_schlecht_programmieren">drei Freunde</a>  <a href="https://CRAN.R-project.org/package=lintr">lintr</a>, <a href="https://CRAN.R-project.org/package=cleanr">cleanr</a> und <a href="https://CRAN.R-project.org/package=cyclocomp">cyclocomp</a>
fragen (wobei <a href="https://CRAN.R-project.org/package=lintr">lintr</a> hier die vorhandene Funktion
        <code>.golden_ratio()</code> <em>nicht</em> erkennt
        <span class="footnote"><br />[Das ist ein altes Problem, siehe <a href="https://github.com/jimhester/lintr/issues/27">https://github.com/jimhester/lintr/issues/27</a>. Wenn Du mit <code>devtools::install(package_dir)</code> das Paket installierst, verschwindet die falsch positive Warnung.]<br /></span> und <a href="https://CRAN.R-project.org/package=cyclocomp">cyclocomp</a>
        ebenfalls nicht
        <span class="footnote"><br />[In Version 1.1.0 des Pakets ruft <code>cyclocomp::cyclocomp_package_dir</code> die Funktion <code>cyclocomp::cyclocomp_package</code> und diese <code>ls(asNamespace(package))</code>, wobei <code>package</code> das aktuelle Paket, hier also "mytools", ist und <code>ls</code> mit der Voreinstellung <code>all.names = FALSE</code> Objekte mit einem führenden Punkt nicht auflistet.]<br /></span>
        und daher keine <code>cyclomatic complexity</code> für sie berechnet):</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.7
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt>print<span style="color: #990000">(</span>lintr<span style="color: #990000">::</span>lint_package<span style="color: #990000">(</span>package_dir<span style="color: #990000">))</span></tt></pre></div></div>
<div class="listingblock">
<div class="content">
<pre><code>## R/golden_ratio.R:18:12: warning: no visible global function definition for '.golden_ratio', Did you mean 'golden_ratio'?
##     phi &lt;- .golden_ratio()
##            ^~~~~~~~~~~~~</code></pre>
</div></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.7
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt>print<span style="color: #990000">(</span>suppressWarnings<span style="color: #990000">(</span>cleanr<span style="color: #990000">::</span>check_directory<span style="color: #990000">(</span>package_dir<span style="color: #990000">)))</span></tt></pre></div></div>
<div class="listingblock">
<div class="content">
<pre><code>## [1] TRUE</code></pre>
</div></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.7
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt>print<span style="color: #990000">(</span>cyclocomp<span style="color: #990000">::</span>cyclocomp_package_dir<span style="color: #990000">(</span>package_dir<span style="color: #990000">))</span></tt></pre></div></div>
<div class="listingblock">
<div class="content">
<pre><code>##           name cyclocomp
## 1 golden_ratio         2</code></pre>
</div></div>
<div class="paragraph"><p>Gut! Das wird jetzt verpackt:</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.7
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="font-weight: bold"><span style="color: #000080">withr:</span></span><span style="color: #990000">:</span>with_dir<span style="color: #990000">(</span>dirname<span style="color: #990000">(</span>package_dir<span style="color: #990000">),</span>
<span style="font-weight: bold"><span style="color: #000080">                callr:</span></span><span style="color: #990000">:</span>rcmd_safe<span style="color: #990000">(</span><span style="color: #FF0000">"build"</span><span style="color: #990000">,</span> basename<span style="color: #990000">(</span>package_dir<span style="color: #990000">)))</span></tt></pre></div></div>
<div class="listingblock">
<div class="content">
<pre><code>## $status
## [1] 0
##
## $stdout
## [1] "* checking for file ‘mytools/DESCRIPTION’ ... OK\n* preparing ‘mytools’:\n* checking DESCRIPTION meta-information ... OK\n* checking for LF line-endings in source and make files and shell scripts\n* checking for empty or unneeded directories\n* building ‘mytools_0.1.0.tar.gz’\n"
##
## $stderr
## [1] "\n"
##
## $timeout
## [1] FALSE
##
## $command
## [1] "/home/qwer/svn/R/r-devel/build/bin/R"
## [2] "CMD"
## [3] "build"
## [4] "mytools"</code></pre>
</div></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.7
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt>package_path <span style="color: #990000">&lt;-</span> paste<span style="color: #993399">0</span><span style="color: #990000">(</span>package_dir<span style="color: #990000">,</span> <span style="color: #FF0000">"_0.1.0.tar.gz"</span><span style="color: #990000">)</span>
if <span style="color: #990000">(</span>file<span style="color: #990000">.</span>exists<span style="color: #990000">(</span>package_path<span style="color: #990000">))</span> print<span style="color: #990000">(</span>package_path<span style="color: #990000">)</span></tt></pre></div></div>
<div class="listingblock">
<div class="content">
<pre><code>## [1] "/tmp/mytools_0.1.0.tar.gz"</code></pre>
</div></div>
<div class="paragraph"><p>Paket fertig. Die Metadaten sind natürlich gelogen (Du solltest die Datei <code>DESCRIPTION</code> anpassen, Du solltest eine Datei <code>NEWS.md</code> pflegen, Du solltest ein <a href="https://de.wikipedia.org/wiki/Versionsverwaltung">version control system</a> benutzten), aber funktional ist es korrekt.</p></div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_bibliographie">4. Bibliographie</h2>
<div class="sectionbody">
<div class="ulist bibliography"><ul>
<li>
<p>
<a id="cc"></a>[cc] R.C. Martin. 2008. <em>Clean Code: A Handbook of Agile Software Craftsmanship</em>.
    Pearson Education.
</p>
</li>
<li>
<p>
<a id="cyc"></a>[cyc]  T. J. McCabe, 1976. <em>A Complexity Measure</em>
   IEEE Transactions on Software Engineering archive.
   Volume 2, Issue 4, Pages 308-320
</p>
</li>
</ul></div>
</div>
</div>
</div>
<div id="footnotes"><hr /></div>
<div id="footer">
<div id="footer-text">
Last updated
 2018-06-08 10:45:29 CEST
</div>
</div>
</body>
</html>
